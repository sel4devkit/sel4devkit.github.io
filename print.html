<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>seL4 Developer Kit</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="A developer kit for the seL4 microkernel on the Avnet MaaXBoard SBC (Single Board Computer).">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction/main.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="introduction/audience.html"><strong aria-hidden="true">1.1.</strong> Audience</a></li><li class="chapter-item expanded "><a href="introduction/overview.html"><strong aria-hidden="true">1.2.</strong> Overview</a></li><li class="chapter-item expanded "><a href="introduction/structure.html"><strong aria-hidden="true">1.3.</strong> Structure</a></li></ol></li><li class="chapter-item expanded "><a href="resources/main.html"><strong aria-hidden="true">2.</strong> Resources</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="resources/sel4_microkernel.html"><strong aria-hidden="true">2.1.</strong> seL4 Microkernel</a></li><li class="chapter-item expanded "><a href="resources/avent_maaxboard.html"><strong aria-hidden="true">2.2.</strong> Avent MaaXBoard</a></li><li class="chapter-item expanded "><a href="resources/glossary.html"><strong aria-hidden="true">2.3.</strong> Glossary</a></li></ol></li><li class="chapter-item expanded "><a href="development_platform/main.html"><strong aria-hidden="true">3.</strong> Development Platform</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="development_platform/hardware_requirements.html"><strong aria-hidden="true">3.1.</strong> Hardware Requirements</a></li><li class="chapter-item expanded "><a href="development_platform/software_requirements.html"><strong aria-hidden="true">3.2.</strong> Software Requirements</a></li></ol></li><li class="chapter-item expanded "><a href="install_and_configure/main.html"><strong aria-hidden="true">4.</strong> Install and Configure</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="install_and_configure/host_setup.html"><strong aria-hidden="true">4.1.</strong> Host Setup</a></li><li class="chapter-item expanded "><a href="install_and_configure/build_environment_setup.html"><strong aria-hidden="true">4.2.</strong> Build Environment Setup</a></li><li class="chapter-item expanded "><a href="install_and_configure/target_setup.html"><strong aria-hidden="true">4.3.</strong> Target Setup</a></li><li class="chapter-item expanded "><a href="install_and_configure/bootloader_setup.html"><strong aria-hidden="true">4.4.</strong> Bootloader Setup</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="install_and_configure/using_the_prebuilt_image.html"><strong aria-hidden="true">4.4.1.</strong> Using the Prebuilt Image</a></li><li class="chapter-item expanded "><a href="install_and_configure/building_uboot_manually.html"><strong aria-hidden="true">4.4.2.</strong> Building U-boot Manually</a></li><li class="chapter-item expanded "><a href="install_and_configure/configure_uboot.html"><strong aria-hidden="true">4.4.3.</strong> Setting Up the U-Boot Configuration File</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="first_boot/main.html"><strong aria-hidden="true">5.</strong> First Boot</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="first_boot/bootloader.html"><strong aria-hidden="true">5.1.</strong> Bootloader</a></li><li class="chapter-item expanded "><a href="first_boot/sel4test.html"><strong aria-hidden="true">5.2.</strong> seL4Test</a></li><li class="chapter-item expanded "><a href="first_boot/camkes_adder.html"><strong aria-hidden="true">5.3.</strong> CAmkES Adder</a></li><li class="chapter-item expanded "><a href="first_boot/microkit_hello_world.html"><strong aria-hidden="true">5.4.</strong> Microkit Hello World</a></li></ol></li><li class="chapter-item expanded "><a href="activity/main.html"><strong aria-hidden="true">6.</strong> Activities</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="activity/microkit_memory_probe/main.html"><strong aria-hidden="true">6.1.</strong> Activity: Microkit Memory Probe</a></li><li class="chapter-item expanded "><a href="activity/remote_power_cycle/main.html"><strong aria-hidden="true">6.2.</strong> Activity: Remote Power Cycle</a></li><li class="chapter-item expanded "><a href="activity/device_drivers/main.html"><strong aria-hidden="true">6.3.</strong> Activity: Use U-Boot Device Drivers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="activity/device_drivers/uboot_driver_library.html"><strong aria-hidden="true">6.3.1.</strong> U-Boot Driver Library Overview</a></li><li class="chapter-item expanded "><a href="activity/device_drivers/uboot_driver_usage.html"><strong aria-hidden="true">6.3.2.</strong> Using the U-Boot Driver Library</a></li><li class="chapter-item expanded "><a href="activity/device_drivers/instructions_for_running_camkes.html"><strong aria-hidden="true">6.3.3.</strong> Instructions for running uboot-driver-example: CAmkES</a></li><li class="chapter-item expanded "><a href="activity/device_drivers/instructions_for_running_microkit.html"><strong aria-hidden="true">6.3.4.</strong> Instructions for running the uboot-driver-example: Microkit</a></li></ol></li><li class="chapter-item expanded "><a href="activity/picoserver_uboot/main.html"><strong aria-hidden="true">6.4.</strong> Activity: Picoserver U-Boot</a></li><li class="chapter-item expanded "><a href="activity/new_platform/main.html"><strong aria-hidden="true">6.5.</strong> Activity: Porting Device Drivers to a New Platform</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="activity/new_platform/add_odroidc2.html"><strong aria-hidden="true">6.5.1.</strong> Add Odroid C2</a></li></ol></li><li class="chapter-item expanded "><a href="activity/new_driver/main.html"><strong aria-hidden="true">6.6.</strong> Activity: Adding a New U-Boot Device Driver</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="activity/new_driver/add_driver_worked_example.html"><strong aria-hidden="true">6.6.1.</strong> Add Driver Worked Example</a></li><li class="chapter-item expanded "><a href="activity/new_driver/driver_troubleshooting.html"><strong aria-hidden="true">6.6.2.</strong> Driver Troubleshooting</a></li></ol></li><li class="chapter-item expanded "><a href="activity/guide_to_porting_seL4/main.html"><strong aria-hidden="true">6.7.</strong> Activity: Guide to Porting seL4</a></li><li class="chapter-item expanded "><a href="activity/spi_bus_bmp280_pressure_sensor/main.html"><strong aria-hidden="true">6.8.</strong> Activity: SPI Bus BMP280 Pressure Sensor</a></li><li class="chapter-item expanded "><a href="activity/camkes_case_study_application/main.html"><strong aria-hidden="true">6.9.</strong> Activity: CAmkES Case Study Application</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="activity/camkes_case_study_application/architecture.html"><strong aria-hidden="true">6.9.1.</strong> Architecture</a></li><li class="chapter-item expanded "><a href="activity/camkes_case_study_application/detail.html"><strong aria-hidden="true">6.9.2.</strong> Design</a></li><li class="chapter-item expanded "><a href="activity/camkes_case_study_application/build.html"><strong aria-hidden="true">6.9.3.</strong> Build</a></li></ol></li><li class="chapter-item expanded "><a href="activity/microkit_case_study_application/main.html"><strong aria-hidden="true">6.10.</strong> Activity: Microkit Case Study Application</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="activity/microkit_case_study_application/architecture.html"><strong aria-hidden="true">6.10.1.</strong> Architecture</a></li><li class="chapter-item expanded "><a href="activity/microkit_case_study_application/detail.html"><strong aria-hidden="true">6.10.2.</strong> Design</a></li><li class="chapter-item expanded "><a href="activity/microkit_case_study_application/build.html"><strong aria-hidden="true">6.10.3.</strong> Build</a></li></ol></li><li class="chapter-item expanded "><a href="activity/microkit_usb_driver/main.html"><strong aria-hidden="true">6.11.</strong> Activity: Microkit USB Driver</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="activity/microkit_usb_driver/adding_a_new_device.html"><strong aria-hidden="true">6.11.1.</strong> Adding a New Device</a></li><li class="chapter-item expanded "><a href="activity/microkit_usb_driver/common_errors.html"><strong aria-hidden="true">6.11.2.</strong> Common Errors</a></li><li class="chapter-item expanded "><a href="activity/microkit_usb_driver/flattened_device_tree.html"><strong aria-hidden="true">6.11.3.</strong> Flattened Device Tree</a></li><li class="chapter-item expanded "><a href="activity/microkit_usb_driver/memory_sharing.html"><strong aria-hidden="true">6.11.4.</strong> Memory Sharing</a></li><li class="chapter-item expanded "><a href="activity/microkit_usb_driver/microkit_monitor_errors.html"><strong aria-hidden="true">6.11.5.</strong> Microkit Monitor Errors</a></li><li class="chapter-item expanded "><a href="activity/microkit_usb_driver/extra_notes.html"><strong aria-hidden="true">6.11.6.</strong> Extra Notes</a></li></ol></li><li class="chapter-item expanded "><a href="activity/microkit_hdmi_driver/main.html"><strong aria-hidden="true">6.12.</strong> Activity: Microkit HDMI Driver</a></li><li class="chapter-item expanded "><a href="activity/microkit_vmm_single_linux_guest/main.html"><strong aria-hidden="true">6.13.</strong> Activity: Microkit VMM Single Linux Guest</a></li><li class="chapter-item expanded "><a href="activity/microkit_vmm_dual_linux_guest_tty_multiplex/main.html"><strong aria-hidden="true">6.14.</strong> Activity: Microkit VMM Dual Linux Guest TTY Multiplex</a></li><li class="chapter-item expanded "><a href="activity/microkit_vmm_dual_linux_guest_usb_routing/main.html"><strong aria-hidden="true">6.15.</strong> Activity: Microkit VMM Dual Linux Guest USB Routing</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded affix "><a href="licensing.html">Licensing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">seL4 Developer Kit</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/sel4devkit/sel4devkit-manual" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>The <a href="https://sel4.systems">seL4® Microkernel</a> is a technology of
increasing interest. It delivers specific capabilities and assurances, which
make it particularly suitable for applications that demand a trusted execution
environment and strong separation of concerns.</p>
<p>The seL4 Microkernel is engineered to deliver both high-assurance and
high-performance (<a href="https://sel4.systems/About/seL4-whitepaper.pdf">The seL4 Microkernel: An
Introduction</a>). High-assurance
is achieved through comprehensive formal verification. High-performance is
achieved through deliberate design and profiling, potentially accepting
greater complexity in the formal verification where this achieves higher
performance.</p>
<p>The development of the seL4 Microkernel is overseen by the <a href="https://sel4.systems/Foundation/">seL4
Foundation</a>, operating as a project under
The <a href="https://www.linuxfoundation.org/">Linux Foundation</a>. The entirety of the
seL4 Microkernel, and its associated components, are made available as Open
Source, on Git Hub (<a href="https://github.com/seL4">seL4 Microkernel and associated
components</a>).</p>
<p>In common with all Microkernels, the seL4 Microkernel provides a minimum set
of essential features as needed to frame a viable OS (Operating System). There
is an expectation that further components will be introduced atop this OS, in
developing useful applications (such as drivers, libraries, and services).</p>
<p>As a consequence, developing on top of the seL4 microkernel is currently
complex and time-consuming, and the expertise is limited to a small number of
individuals and organisations. Thus, this seL4 Developer Kit is created to
reduce the barrier to entry for developing on top of seL4 Microkernel. The
overall intention is to encourage and support more organisations in adopting
seL4 in their projects and products.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="audience"><a class="header" href="#audience">Audience</a></h1>
<p>The intended audience is an application developer:</p>
<ul>
<li>Experienced in programming within a Linux, macOS, or Windows environment.</li>
<li>Already familiar with seL4 concepts and benefits.</li>
<li>Looking for practical guidance in getting started with seL4.</li>
</ul>
<h2 id="complementary-approach"><a class="header" href="#complementary-approach">Complementary Approach</a></h2>
<p>This seL4 Developer Kit does not intend to cover or replace any of the
extensive material as maintained by the <a href="https://sel4.systems">seL4
Foundation</a> and associated organisations.</p>
<p>Instead, the purpose is to complement this existing material with practical
guidance about getting started with seL4. Throughout the seL4 Developer Kit,
reference is made to externally maintained material where appropriate.</p>
<h2 id="focus-on-sel4-details"><a class="header" href="#focus-on-sel4-details">Focus on seL4 Details</a></h2>
<p>Whilst the seL4 Developer Kit aims to cover all the important configuration
steps, it does assume a reasonable level of developer knowledge. In general,
priority and prominence is given to seL4 specific details, while more routine
aspects are explained at a higher level or through external reference (such as
installing software or interacting with configuration management).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<p>The seL4 Developer Kit supports developers in gaining familiarity with seL4
Microkernel, and ultimately to encourage more use of seL4 within projects and
products. It does this by:</p>
<ul>
<li>
<p>Selecting a readily available low-cost SBC (Single Board Computer) as the
target platform (The <a href="introduction/../avent_maaxboard/main.html">Avnet MaaXBoard</a>).</p>
</li>
<li>
<p>Identifying the minimum needed to create a viable development platform, and
detailing specific hardware and software requirements to achieve this.</p>
</li>
<li>
<p>Supplying preconfigured build environments, plus associated examples, with
all the content required to generate seL4 executable programs.</p>
</li>
<li>
<p>Demonstrating how an seL4 executable program can be loaded and executed on
the chosen target platform.</p>
</li>
<li>
<p>Documenting the specific steps needed, along with more general guidance.</p>
</li>
</ul>
<p>Once the fundamentals of building and executing an seL4 program are
established, the seL4 Developer Kit seeks to explain and encourage further
development through the presentation of a diverse series of technical
<a href="introduction/../activities/main.html">Activities</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="structure"><a class="header" href="#structure">Structure</a></h1>
<p>The seL4 Developer Kit is structured into the following sections to provide a
step-by-step guide:</p>
<ul>
<li>
<p><strong>Introduction</strong>: Introduce the potential benefits that the seL4 Microkernel
offers, acknowledge its steep learning curve, and position the seL4
Developer Kit as a means to help facilitate and encourage wider adoption.</p>
</li>
<li>
<p><strong>Resources</strong>: Provides an overview of the fundamental aspects of both the
seL4 Microkernel and our chosen SBC (Single Board Computer), the the Avent
MaaXBoard, highlighting relevant supporting material from other sources. Also
presents a consolidated glossary of key terms for easy reference.</p>
</li>
<li>
<p><strong>Development Platform</strong>: Identify and explain the minimum hardware and
software requirements needed to assemble a viable development platform for
using the seL4 Developer Kit. It is expected that, to meet these requirements,
some equipment will need to be purchased (for example, an Avent MaaXBoard).</p>
</li>
<li>
<p><strong>Install and Configure</strong>: Provides guidance, and explores options, in
installing and configuring the development platform. Once complete, the
development platform will be ready for building sel4 programs, loading such
programs onto the target, and executing these programs on the target, with
terminal (text) input and output available.</p>
</li>
<li>
<p><strong>First Boot</strong>: Utilising a previously prepared development platform, walk
through the steps in powering up the target (Avnet MaaXBoard), interacting
with the bootloader, and building and executing a small number of example
programs. On completion of this step, the development platform is prepared and
proven to operate.</p>
</li>
<li>
<p><strong>Activities</strong>: With the development platform established, a series of
distinct technical activities are undertaken. Each Activity describes both
its approach, and the eventual outcome, seeking to illustrate how sel4
development may be practically progressed.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="resources"><a class="header" href="#resources">Resources</a></h1>
<p>This section presents a high level overview of the main resources associated
with the seL4 Developer Kit. The majority of this section is framed in terms
of references to external content. The intention is that developers will refer
to, and return to, this section to find further avenues of information to help
with their efforts.</p>
<p>The section is structured as follows:</p>
<ul>
<li><a href="resources/../resources/sel4_microkernel.html">seL4 Microkernel</a>: Provide an overview of the
seL4 Microkernel, focusing on its capabilities and infrastructure as relates
to the seL4 Developer Kit.</li>
<li><a href="resources/../resources/avent_maaxboard.html">Avent MaaXBoard</a>: Describe the rationale
behind the selection of our chosen SBC, the Avent MaaXBoard. Further,
summarise and reference entry points into its available resources.</li>
<li><a href="resources/../resources/glossary.html">Glossary</a>: A consolidated glossary of key terms
for subsequent reference.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sel4-microkernel"><a class="header" href="#sel4-microkernel">seL4 Microkernel</a></h1>
<p>The <a href="https://sel4.systems">seL4 Microkernel</a>, and its closely associated
components, is managed by the <a href="https://sel4.systems/Foundation">seL4
Foundation</a>, operating as a project under the
<a href="https://www.linuxfoundation.org">Linux Foundation</a>. The entirety of the seL4
Foundation contribution is made publicly available. More so, there are several
related efforts that provide further relevant contributions.</p>
<h2 id="community"><a class="header" href="#community">Community</a></h2>
<p>The main entry points to the seL4 community are as follows:</p>
<ul>
<li>
<p><a href="https://sel4.systems">seL4 Microkernel</a>: The primary landing page for seL4,
as maintained by the seL4 Foundation. This provides the latest information
and news related to seL4.</p>
</li>
<li>
<p><a href="https://docs.sel4.systems">seL4 Microkernel Community Documentation</a>: Large
corpus of community maintained documentation associated with the seL4
Microkernel itself, many of its associated components, and projects
incorporating seL4 aspects.</p>
</li>
<li>
<p><a href="https://github.com/sel4">seL4 Foundation Git Hub</a>: The primary location for
all seL4 content as maintained by the seL4 Foundation.</p>
</li>
<li>
<p><a href="https://trustworthy.systems">Trustworthy Systems</a>: A research group, based
at the School of CSE (Computer Science and Engineering) of UNSW (University
of New South Wales) Sydney. The original developers of seL4, still very active
in the community, with various ongoing seL4 related research and projects.</p>
</li>
<li>
<p><a href="https://trustworthy.systems/projects/microkit/tutorial/welcome.html">seL4 Microkit Tutorial</a>:
A tutorial, prepared by Trustworthy Systems, for getting started with the seL4
Microkit, principally focusing on an emulated target (via the QEMU simulator).</p>
</li>
<li>
<p><a href="https://github.com/au-ts">Trustworthy Systems Git Hub</a>: The primary
location for all seL4 content as maintained by Trustworthy Systems.</p>
</li>
</ul>
<h2 id="components"><a class="header" href="#components">Components</a></h2>
<p>Several significant seL4 components are highlighted below. Many of these
components are directly utilised within this seL4 Developer Kit:</p>
<ul>
<li>
<p><a href="https://github.com/seL4/seL4">seL4 Microkernel</a>: The seL4 Microkernel.</p>
</li>
<li>
<p><a href="https://github.com/seL4/camkes-manifest">CAmkES</a>: The entry point to CAmkES
(component architecture for microkernel-based embedded systems).</p>
</li>
<li>
<p><a href="https://github.com/seL4/microkit">Microkit</a>: Retains Microkit, a simple and
small framework for building and running applications atop the seL4
Microkernel.</p>
</li>
<li>
<p><a href="https://github.com/au-ts/sddf">sDDF</a>: The sDDF (seL4 Device Driver
Framework). Provides a suite of generic capabilities (interfaces and
protocols) and also specific deployments (drivers and examples). The
contribution is geared for easing the deployment of device drivers atop the
seL4 Microkernel.</p>
</li>
<li>
<p><a href="https://github.com/au-ts/libvmm">libvmm</a>: A VMM (Virtual Machine Monitor)
library, permitting the execution of virtualised guest hosts, atop the seL4
Microkernel.</p>
</li>
<li>
<p><a href="https://lionsos.org">Lions OS</a>: Trustworthy Systems are developing the
Lions OS (Operating System), building atop both the principles and
technology associated with the seL4 Microkernel.</p>
</li>
</ul>
<h2 id="context"><a class="header" href="#context">Context</a></h2>
<p>The seL4 Microkernel may be reasonably characterised as a technology of
increasing relevance and interest.</p>
<p>Historically, it is relatively ordinary for an academic system to deliver
novel advancements in high-assurance, while sacrificing the algorithmic
complexity associated with achieving high-performance. Or, conversely, for a
platform to offer high-performance, while sacrificing the controls and
constraints associated with achieving high-assurances.  Thus, a key
differentiator of the seL4 Microkernel is its <em>simultaneous</em> focus, and
evidenced achievement, of both high-assurance and high-performance.</p>
<p>In particular, in the current modern climate, it is straight forward to
identify numerous security critical applications which could immediately
benefit from building atop an existing high-assurance and high-performance
platform.</p>
<p>The formation the seL4 Foundation (07 April 2020) (<a href="https://www.linuxfoundation.org/press/press-release/sel4-microkernel-optimized-for-security-gets-support-of-linux-foundation">press
release</a>)
is a key indicator of the growing importance of the seL4 Microkernel, and the
explicit intention to enhance and mature its associated contributions.</p>
<p>The two main frameworks for developing seL4 applications are:</p>
<ul>
<li><a href="https://github.com/seL4/camkes-manifest">CAmkES</a>: Introduced in 2015.</li>
<li><a href="https://github.com/seL4/microkit">Microkit</a>: Introduced in 2020.</li>
</ul>
<p>These two frameworks adopt very contrasting approaches. CAmkES provides a rich
feature set, but has greater complexity. Microkit provides a very minimum
feature set, but has greater simplicity.</p>
<p>Both frameworks remain supported by the seL4 Foundation, and are accommodated
in this seL4 developer kit. However, in many respects, Microkit may be
regarded as a response to the lessons learned from CAmkES, and is gradually
emerging as the logical default choice for any new development. Perhaps,
fundamentally, Microkit is closer in spirit to Microkernels, in providing
essential behaviours only, and thus provides a more compelling fit as a seL4
Microkernel component. A guide for translating CAmkES applications into
Microkit is available externally (<a href="https://github.com/au-ts/camkes_to_microkit_guide/blob/main/guide.md">CAmkES to
Microkit</a>).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="avnet-maaxboard"><a class="header" href="#avnet-maaxboard">Avnet MaaxBoard</a></h1>
<p>The Avnet MaaXBoard SBC (Single Board Computer) has been selected as the
target platform for developing and investigating this seL4 Developer Kit.</p>
<p>The following high level features of the Avnet MaaXBoard SBC make it
particularly suitable for use with the seL4 Developer Kit:</p>
<ul>
<li>
<p><strong>Inexpensive</strong>: The Avnet MaaXBoard SBC is relatively inexpensive,
minimising the cost of getting started with the seL4 Developer Kit.</p>
</li>
<li>
<p><strong>Available</strong>: While not a routine product, it is straight forward to identify
suppliers with multiple instances of the Avnet MaaXBoard in stock.</p>
</li>
<li>
<p><strong>Devices</strong>: The Avnet MaaXBoard incorporates a wide collection of input and
output devices, simplifying its practical usage, and permitting some
flexibility in the activities that may be explored with the seL4 Developer
Kit.</p>
</li>
<li>
<p><strong>Architecture</strong>: The Avnet MaaXBoard supports an ARM architecture (AArch32
and AArch64). In general, the ARM architecture, in contrast to the x86
architecture, is much simpler, which is particularly suitable for security
focused applications. More so, because of this intrinsic suitability, the seL4
Microkernel and its associated components, tend to offer greater support and
capabilities for the ARM architecture.</p>
</li>
<li>
<p><strong>Open</strong>: The detailed technical aspects of the Avnet MaaXBoard, its
resident devices, and the ARM architecture, are well documented and freely
publicly available.</p>
</li>
</ul>
<h2 id="specifications"><a class="header" href="#specifications">Specifications</a></h2>
<p>The Avnet MaaXBoard SBC is part of a family of SBCs. For clarity, we are using
the "Avnet MaaXBoard" with part number "AES-MC-SBC-IMX8M-G".</p>
<p>The Avnet MaaxBoard uses the i.MX 8M Quad processor developed by NXP. The
application processor reference manual is a very useful document for
developing atop this processor. The manual is freely available through NXP,
once an account is created with them: <a href="https://www.nxp.com">NXP</a>. Search for
"Documentation" for the "i.MX 8M Family" with keyword "IMX8MDQLQRM".</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="glossary"><a class="header" href="#glossary">Glossary</a></h1>
<div class="table-wrapper"><table><thead><tr><th>Term</th><th>Definition</th></tr></thead><tbody>
<tr><td><a href="https://en.wikipedia.org/wiki/ARM_architecture_family#AArch32">AArch32</a></td><td>Execution state of <a href="https://en.wikipedia.org/wiki/ARM_architecture_family#64/32-bit_architecture">ARMv8</a> architecture using 32-bit wide general-purpose registers.</td></tr>
<tr><td><a href="https://en.wikipedia.org/wiki/AArch64">AArch64</a></td><td>Execution state of <a href="https://en.wikipedia.org/wiki/ARM_architecture_family#64/32-bit_architecture">ARMv8</a> architecture using 64-bit wide general-purpose registers.</td></tr>
<tr><td><a href="https://www.avnet.com">Avnet</a></td><td>The manufacturer of the MaaXBoard SBC.</td></tr>
<tr><td><a href="https://en.wikipedia.org/wiki/Bootloader">Bootloader</a></td><td>The tool responsible for booting a computer. Responsible for initialisation of software following by loading and execution of software.</td></tr>
<tr><td><a href="https://docs.sel4.systems/projects/camkes">CAmkES</a></td><td>Component Architecture for microkernel-based Embedded Systems. An abstraction layer on top of seL4 providing a software development and runtime framework for quickly and reliably building microkernel-based multiserver (operating) systems.</td></tr>
<tr><td><a href="https://en.wikipedia.org/wiki/Devicetree">Device Tree</a></td><td>A <a href="https://www.devicetree.org/specifications">standardised data structure</a> with nodes that describe the hardware components of a computer system. Associated with device trees are DTS files (Device Tree Source - a textual representation of a device tree), DTB files (Device Tree Blob - a binary representation of a device tree), and DTC (Device Tree Compiler - a tool used to convert between device tree formats, e.g. DTS to DTB).</td></tr>
<tr><td><a href="https://en.wikipedia.org/wiki/Direct_memory_access">DMA</a></td><td>Direct Memory Access. A feature that allows certain hardware subsystems to access main system memory independently of the central processing unit (CPU), typically used by devices that need to transfer bulk data (e.g. USB).</td></tr>
<tr><td><a href="https://www.docker.com">Docker</a></td><td>A tool that allows packaging of an application and its dependencies within a container, with fewer overheads than a virtual machine. It is used in this developer kit to provide a standardised build environment.</td></tr>
<tr><td><a href="https://en.wikipedia.org/wiki/General-purpose_input/output#Board-level_GPIOs">GPIO</a></td><td>General-Purpose Input/Output. A digital signal pin on an integrated circuit or electronic circuit board which may be used as an input or output, or both, and is controllable by software.</td></tr>
<tr><td><a href="https://www.ncsc.gov.uk/whitepaper/security-architecture-anti-patterns">High-side</a></td><td>In a security context, 'more trusted' or 'high-side' refers to a system in which there is more confidence of its integrity.</td></tr>
<tr><td><a href="https://www.ncsc.gov.uk/whitepaper/security-architecture-anti-patterns">Low-side</a></td><td>In a security context, 'less trusted' or 'low-side' refers to a system in which there is less confidence of its integrity.</td></tr>
<tr><td><a href="https://www.avnet.com/wps/portal/us/products/avnet-boards/avnet-board-families/maaxboard/maaxboard">MaaXBoard</a></td><td>An <a href="https://www.nxp.com/products/processors-and-microcontrollers/arm-processors/i-mx-applications-processors/i-mx-8-applications-processors/i-mx-8m-family-armcortex-a53-cortex-m4-audio-voice-video:i.MX8M">NXP i.MX 8M SoC</a> based SBC. Selected as the target platform for this developer kit.</td></tr>
<tr><td><a href="https://docs.sel4.systems/projects/microkit">Microkit</a></td><td>Operating system framework on top of seL4 that provides a small set of simple abstractions that ease the design and implementation of statically structured systems on seL4, while still leveraging the kernel’s benefits of security and performance</td></tr>
<tr><td><a href="https://en.wikipedia.org/wiki/Single-board_computer">SBC</a></td><td>Single Board Computer. A complete computer on a single circuit board. The Avnet MaaXBoard is an example of a SBC.</td></tr>
<tr><td><a href="https://docs.sel4.systems/projects/sel4test">seL4Test</a></td><td>Test suite for seL4 developed and maintained by the seL4 Foundation.</td></tr>
<tr><td><a href="https://en.wikipedia.org/wiki/System_on_a_chip">SoC</a></td><td>System on chip. A chip that integrates all or most components of a computer. The SoC on the MaaXBoard is the <a href="https://www.nxp.com/products/processors-and-microcontrollers/arm-processors/i-mx-applications-processors/i-mx-8-applications-processors/i-mx-8m-family-armcortex-a53-cortex-m4-audio-voice-video:i.MX8M">NXP i.MX 8M</a>.</td></tr>
<tr><td><a href="https://en.wikipedia.org/wiki/Trivial_File_Transfer_Protocol">TFTP</a></td><td>Trivial File Transfer Protocol. A simple file transfer protocol commonly used in the early stages of bootloading from a local area network.</td></tr>
<tr><td><a href="https://www.denx.de/wiki/U-Boot">U-Boot</a></td><td>Das U-Boot (known as "the Universal Boot Loader" and often shortened to U-Boot) is an open-source bootloader commonly used in embedded devices.</td></tr>
<tr><td><a href="https://en.wikipedia.org/wiki/Universal_asynchronous_receiver-transmitter">UART</a></td><td>Universal Asynchronous Receiver-Transmitter. A simple serial communication device commonly used by SBCs.</td></tr>
<tr><td><a href="https://en.wikipedia.org/wiki/Single-board_computer">SBC</a></td><td>Single Board Computer. A complete computer on a single circuit board. The Avnet MaaXBoard is an example of a SBC.</td></tr>
<tr><td><a href="https://docs.sel4.systems/projects/sel4test">seL4Test</a></td><td>Test suite for seL4 developed and maintained by the seL4 Foundation.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="development-platform"><a class="header" href="#development-platform">Development Platform</a></h1>
<p>This section details the minimum <a href="development_platform/hardware_requirements.html">hardware</a> and <a href="development_platform/software_requirements.html">software</a> requirements necessary to follow the guide.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hardware-requirements"><a class="header" href="#hardware-requirements">Hardware Requirements</a></h1>
<p>This section details the hardware related to the target platform that the guide assumes is available to the developer. Before following the guide the developer will need to have access to all items marked as mandatory.</p>
<p>As detailed in the <a href="development_platform/../first_boot/bootloader.html">Bootloader</a> section, there are multiple methods of transferring a compiled seL4 binary from the host machine to the target platform. Where a hardware item is required to support only one potential transfer method it is marked as 'optional'. The developer should decide which transfer method(s) are to be used to determine which items need to be available.</p>
<p>For convenience, the following table includes order codes and hyperlinks for the <a href="https://uk.farnell.com">Farnell UK store</a> correct as of 16th August 2024; clearly, equivalent items are available from many other sources.</p>
<div class="table-wrapper"><table><thead><tr><th>Item</th><th>Notes</th><th>Order Code</th></tr></thead><tbody>
<tr><td>Avnet MaaXBoard (AES-MC-SBC-IMX8M-G)</td><td>Mandatory</td><td><a href="https://uk.farnell.com/avnet/aes-mc-sbc-imx8m-g/sbc-quad-arm-cortex-a53-cortex/dp/3436577?ost=3436577">3436577</a></td></tr>
<tr><td>USB-to-TTL Serial UART Cable</td><td>Mandatory</td><td><a href="https://uk.farnell.com/ftdi/ttl-232r-rpi/cable-debug-ttl-232-usb-rpi/dp/2147356">2147356</a></td></tr>
<tr><td>16GB Micro SD Card</td><td>Mandatory</td><td><a href="https://uk.farnell.com/integral/inmsdh16g10-90u1/16gb-ultimapro-microsd-c10-90/dp/3498607?ost=3498607">3498607</a></td></tr>
<tr><td>USB Micro SD Card Reader/Writer</td><td>Mandatory</td><td><a href="https://uk.farnell.com/tripp-lite/u452-000-sd-a/usb-c-memory-card-reader-sd-micro/dp/3493850?ost=3493850">3493850</a></td></tr>
<tr><td>15W USB-C Power Adapter</td><td>Mandatory</td><td><a href="https://uk.farnell.com/stontronics/t7725dv/adapter-ac-dc-1-o-p-5-1v-3a/dp/3106255?ost=3106255">3106255</a></td></tr>
<tr><td>USB Flash Drive</td><td>Optional - USB transfer only</td><td>General<sup class="footnote-reference"><a href="#1">1</a></sup></td></tr>
<tr><td>Ethernet Cable</td><td>Optional - TFTP transfer and some of the test applications</td><td>General<sup class="footnote-reference"><a href="#1">1</a></sup></td></tr>
<tr><td>USB Keyboard</td><td>Optional - some of the test applications</td><td><a href="https://uk.farnell.com/logitech/920-002524/keyboard-k120-business-logitech/dp/1848111">1848111</a><sup class="footnote-reference"><a href="#2">2</a></sup></td></tr>
<tr><td>SPI Bus Pressure Sensor</td><td>Optional - test application only</td><td><a href="development_platform/appendices/spi_bmp280.html">See SPI sensor appendix</a></td></tr>
</tbody></table>
</div>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Where items are considered to be ubiquitous with no special requirements, no example order code is given.</p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p>Although USB keyboards are fairly ubiquitous, experience leads us to recommend a 'basic' model such as this, which works with our keyboard driver; the driver may not work with more feature-rich models (e.g. a keyboard with an integral USB hub; nor does it work with <a href="https://uk.farnell.com/a4-tech/rp011/keyboard-mini-slim-black-uk/dp/2113614">this compact keyboard</a>).</p>
</div>
<p>This guide assumes the following basic hardware capabilities of the user's development environment:</p>
<ol>
<li>
<p>The ability to connect the MaaXBoard to a wired network to which the host machine is also connected. This is required if the user wishes to perform TFTP transfer of executables from the host environment to the target platform (see the <a href="development_platform/../first_boot/bootloader.html#loading-via-tftp">Bootloader</a> section).</p>
</li>
<li>
<p>The ability to connect USB devices (i.e. the USB flash drive and USB SD card reader / writer) to the host machine.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="software-requirements"><a class="header" href="#software-requirements">Software Requirements</a></h1>
<p>This developer kit is intended to have minimal software requirements on the host machine by using Docker containment as much as possible. The applications that follow are either needed or assumed on the host machine.</p>
<p>Installation instructions are not reproduced here; please follow the instructions given by the application providers. Configuration of the applications is considered in the <a href="development_platform/../install_and_configure/host_setup.html">Host Setup</a> section.</p>
<p>This guide assumes that the user has sufficiently elevated privileges on the host machine to install and configure the applications; for example on macOS and Linux it is assumed that the user has <code>sudo</code> privileges.</p>
<h2 id="mandatory-requirements"><a class="header" href="#mandatory-requirements">Mandatory Requirements</a></h2>
<p>The following mandatory applications are assumed on the host machine:</p>
<ul>
<li>
<p><strong>Container toolset</strong>: Used to provide the build environment. This guide assumes use of <a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a> for macOS or Windows host environments or <a href="https://hub.docker.com/search?offering=community&amp;operating_system=linux&amp;q=&amp;type=edition">Docker Engine</a> for Linux-based host environments.</p>
<p>Docker Engine is licensed under the Apache License Version 2.0, see <a href="https://docs.docker.com/engine/">here</a> for more information. Docker Desktop is free to use for small companies, education and non-commercial open source projects, see <a href="https://www.docker.com/pricing/faq/">here</a> for details and pricing.</p>
</li>
<li>
<p><strong>SD card writer application</strong>: Used to write the SD card from which the MaaXBoard boots. <a href="https://www.balena.io/etcher/">Balena Etcher</a> has been selected due to its availability on macOS, Windows and Linux environments. Alternative means of writing SD cards are available but not supported by this document.</p>
<p>Balena Etcher is licensed under the Apache License Version 2.0, see <a href="https://github.com/balena-io/etcher/blob/master/LICENSE">here</a> for more information.</p>
</li>
<li>
<p><strong>Serial terminal application</strong>: Used for serial communication with the target platform. <a href="https://freeware.the-meiers.org/">CoolTerm</a> has been selected due to its availability on macOS and Windows. For Linux environments <a href="https://wiki.emacinc.com/wiki/Getting_Started_With_Minicom">Minicom</a> can be used. Alternative applications are available but not supported by this document.</p>
<p>CoolTerm and Minicom is distributed as freeware with no documented limitations on use.</p>
</li>
</ul>
<h2 id="optional-requirements"><a class="header" href="#optional-requirements">Optional Requirements</a></h2>
<p>If the user wishes to perform TFTP transfer of executables from the host environment to the target platform (see the <a href="development_platform/../first_boot/bootloader.html">Bootloader</a> section) then installation of a TFTP server is required.</p>
<p>Full details of the installation and configuration of a TFTP server is considered to be outside the scope of this developer kit, however the following guidance is offered:</p>
<ul>
<li>
<p><strong>macOS</strong>: A TFTP server is included in macOS by default. The <a href="https://www.macupdate.com/app/mac/11116/tftpserver">TftpServer</a> application provides a graphical user interface to simplify use of the in-built server.</p>
</li>
<li>
<p><strong>Linux</strong>: TFTP servers are available for all major Linux distributions. On Fedora and CentOS a server can be installed via <code>yum -y install tftp-server</code>; on Debian and Ubuntu a server can be installed via <code>apt-get install tftpd-hpa</code>.</p>
</li>
<li>
<p><strong>Windows</strong>: Multiple free TFTP server applications are available, e.g. <a href="https://www.solarwinds.com/free-tools/free-tftp-server">SolarWinds TFTP Server</a> (distributed as "100% free" with no documented limitations on use) and <a href="https://pjo2.github.io/tftpd64">Tftpd64</a> (licensed under GNU General Public License, version 2).</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="install-and-configure"><a class="header" href="#install-and-configure">Install and Configure</a></h1>
<p>This section details how to configure a build environment with all tools required to generate seL4 executable images.</p>
<p>Development is conducted across three different environments:</p>
<ol>
<li>
<p><strong>Host Machine</strong>: The developer's host machine. This can be running macOS, Linux, or Windows.</p>
</li>
<li>
<p><strong>Build environment</strong>: The environment within which all binaries for the target environment are built. This is a Linux-based development environment running within a <a href="https://www.docker.com">Docker</a> container on the host machine. The use of a Docker container to provide all of the tooling required to build seL4 applications for the target platform greatly simplifies the requirements of the host machine.</p>
</li>
<li>
<p><strong>Target Platform</strong>: The <a href="https://www.avnet.com/wps/portal/us/products/avnet-boards/avnet-board-families/maaxboard/maaxboard">Avnet MaaXBoard</a>, a single board computer based around the <a href="https://www.nxp.com/products/processors-and-microcontrollers/arm-processors/i-mx-applications-processors/i-mx-8-processors/i-mx-8m-family-armcortex-a53-cortex-m4-audio-voice-video:i.MX8M">NXP i.MX 8M SoC (system on chip)</a>. This is the environment upon which seL4 binaries are executed. User interaction with the target platform is performed via a serial console from the host machine.</p>
</li>
</ol>
<p>The required configuration of the host and target environments are detailed in
the <a href="install_and_configure/host_setup.html">Host Setup</a> and <a href="install_and_configure/target_setup.html">Target Setup</a> sections.
A preconfigured build environment is supplied as part of this developer kit as
detailed in the <a href="install_and_configure/build_environment_setup.html">Build Environment Setup</a> section.
<a href="install_and_configure/bootloader_setup.html">Bootloader setup</a> describes how to install and the
bootloader U-Boot.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="host-setup"><a class="header" href="#host-setup">Host Setup</a></h1>
<p>The previous <a href="install_and_configure/../development_platform/software_requirements.html">Software Requirements</a> section listed the applications required on the host machine. Installation links provided there should be followed, where applicable. This section covers any necessary configuration.</p>
<h2 id="docker-desktop--docker-engine"><a class="header" href="#docker-desktop--docker-engine">Docker Desktop / Docker Engine</a></h2>
<p>Docker Desktop is a widely used platform for developing, packaging, and running applications. If you are a new Docker user, you will have to sign up for an account. Depending on your situation, a subscription fee may be applicable (typically if you are acting as a member of a large commercial organisation), but in many cases there is no cost. This development kit documentation does not attempt to guide you about this; please refer to the licensing conditions on <a href="https://www.docker.com/pricing">Docker's website</a>.</p>
<p>Little configuration of the default setup for Docker is required. Using the Docker Desktop application available for macOS and Windows, the following <em>Settings &gt; Preferences</em> have been found to be sufficient where the RAM setting was increased from a lower default:</p>
<p><img src="install_and_configure/../install_and_configure/figures/docker-preferences.png" alt="Docker Preferences" /></p>
<p>When using Linux, the user running the Docker Engine needs to be made a member of the <code>docker</code> group by issuing the following command, substituting your username for <code>&lt;username&gt;</code>:</p>
<pre><code class="language-bash">sudo usermod -aG docker &lt;username&gt;
</code></pre>
<h2 id="etcher"><a class="header" href="#etcher">Etcher</a></h2>
<p>Although <a href="https://www.balena.io/etcher/">Etcher</a> is assumed and used in some of this developer kit documentation, its core functionality is available at the macOS, Linux, or Windows command line, so it is not strictly necessary if you prefer other methods.</p>
<p>No special configuration is necessary for Etcher.</p>
<h2 id="coolterm"><a class="header" href="#coolterm">CoolTerm</a></h2>
<p>CoolTerm enables the host machine to communicate with the MaaXBoard over the serial interface using the UART pins on the board's GPIO connector (see <a href="install_and_configure/target_setup.html">Target Platform Setup</a> section for more details of the necessary connections). Alternative applications are available, but this documentation will use CoolTerm, which is freely available and multi-platform.</p>
<p>The configuration parameters are accessible via the <em>Connection &gt; Options</em> menu. The following serial port parameters are required (i.e. 115200 baud, 8 data bits, no parity, 1 stop bit):</p>
<p><img src="install_and_configure/../install_and_configure/figures/coolTerm-serialport.png" alt="CoolTerm serial port configuration" /></p>
<p>Note: within the <em>Port</em> field, an appropriate USB port on the host machine should be selected; it may differ from the example shown above in the screenshot.</p>
<p>The following terminal parameters are suggested:</p>
<p><img src="install_and_configure/../install_and_configure/figures/coolTerm-terminal.png" alt="CoolTerm terminal configuration" /></p>
<p>Users may also wish to extend the size of the <em>Receive Buffer</em> to be able to scroll back through a longer history. This is accessible via the <em>Receive</em> sub-option within the <em>Connection &gt; Options</em> menu.</p>
<p>All these settings may be saved for convenience as a CoolTerm configuration file.</p>
<h2 id="minicom"><a class="header" href="#minicom">Minicom</a></h2>
<p>Minicom can also be used to communicate with the maaxboard over the serial interface using the UART pins on the board's GPIO connector (see <a href="install_and_configure/target_setup.html">Target Platform Setup</a> section for more details of the necessary connections). Minicom can be used on linux machines or on Windows with the PuTTY application. Instructions for installing and running minicom are <a href="https://wiki.emacinc.com/wiki/Getting_Started_With_Minicom">here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="build-environment-setup"><a class="header" href="#build-environment-setup">Build Environment Setup</a></h1>
<p>The build environment is the environment within which all binaries for the
target environment are built; i.e. the environment that provides the required
compilation toolchain.</p>
<p>To simplify the requirements on the host environment and to enable rapid
setup, the build environment is provided as a pre-built Docker image.</p>
<h2 id="environment-details"><a class="header" href="#environment-details">Environment Details</a></h2>
<p>The build environment is a Debian Linux system pre-installed with all of the
required development tools. The primary tools supplied are:</p>
<ul>
<li><a href="https://git-scm.com">Git</a> version control system.</li>
<li><a href="https://gerrit.googlesource.com/git-repo/+/refs/heads/master/README.md">Repo</a> Git repository management tool.</li>
<li><a href="https://gcc.gnu.org">aarch64-linux-gnu</a> cross compiler toolchain targeting the ARM AArch64 instruction set.</li>
<li><a href="https://www.gnu.org/software/make/">Make</a>, <a href="https://cmake.org">CMake</a>, <a href="https://ninja-build.org">Ninja</a> and <a href="https://mesonbuild.com/">MESON</a> build automation tools.</li>
</ul>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<p><a href="install_and_configure/host_setup.html">Host machine setup</a> must be completed, specifically
installation of Docker, and the Docker tools must be active prior to
installation of the build environment.</p>
<p>At this stage, the pre-built Docker image may be incorporated into the Docker
tools. Different approaches are recommended for Windows and Linux, to provide
a more effective integration into those different host Operating Systems.</p>
<h3 id="docker-usage"><a class="header" href="#docker-usage">Docker Usage</a></h3>
<p>Given their considerably different technical dependencies, separate Docker
Images are provided for CAmkES and Microkit. Normal usage involves acquiring
and running the appropriate Docker Image, optionally mapping in a local
development area (HOST_PATH), and (for Linux) a local home area (HOME_PATH).</p>
<p>Note that, apart from any mapped areas, the entirety of the Docker Image will
be lost when the Docker Image is exited. This is deliberate and desirable,
ensuring a consistent starting environment for each session.</p>
<h3 id="windows"><a class="header" href="#windows">Windows</a></h3>
<p>Given the limited shell provided by Windows, usage of its Docker Images are
best coordinated directly.</p>
<h4 id="windows-camkes"><a class="header" href="#windows-camkes">Windows CAmkES</a></h4>
<p>Pulling Docker Image (user-dev):</p>
<pre><code>docker pull ghcr.io/sel4devkit/sel4devkit-maaxboard-camkes-docker-dev-env/user-dev:latest
</code></pre>
<p>Running Docker Image (user-dev):</p>
<pre><code>docker run --rm --interactive --tty --hostname "sel4devkit-maaxboard-camkes" \
    ghcr.io/sel4devkit/sel4devkit-maaxboard-camkes-docker-dev-env/user-dev:latest \
    --mount type=bind,source="&lt;HOST_PATH&gt;",target="/host"
    /bin/bash --login
</code></pre>
<h4 id="windows-microkit"><a class="header" href="#windows-microkit">Windows Microkit</a></h4>
<p>Pulling Docker Image (user-dev):</p>
<pre><code>docker pull ghcr.io/sel4devkit/sel4devkit-maaxboard-microkit-docker-dev-env/user-dev:latest
</code></pre>
<p>Running Docker Image (user-dev):</p>
<pre><code>docker run --rm --interactive --tty --hostname "sel4devkit-maaxboard-microkit" \
    ghcr.io/sel4devkit/sel4devkit-maaxboard-microkit-docker-dev-env/user-dev:latest \
    --mount type=bind,source="&lt;HOST_PATH&gt;",target="/host"
    /bin/bash --login
</code></pre>
<h3 id="linux"><a class="header" href="#linux">Linux</a></h3>
<p>Usage of the Linux Docker Images are coordinated indirectly via a separate
helper repository as follows:</p>
<ul>
<li><strong>CAmkES</strong>: <code>git clone "git@github.com:sel4devkit/sel4devkit-maaxboard-camkes-docker-dev-env.git"</code></li>
<li><strong>Microkit</strong>: <code>git clone "git@github.com:sel4devkit/sel4devkit-maaxboard-camkes-docker-dev-env.git"</code></li>
</ul>
<p>Within this repository, show usage instructions:</p>
<pre><code>make
</code></pre>
<p>Two different entry points are provided, as "user-dev" and "user-me":</p>
<ul>
<li>The "user-dev" operates with a fixed user name "developer", granted password
free access to root, via sudo. This configuration is fully defined, and thus
may be prepared in advance. This property permits a very simple deployment,
and is particularly suited to Windows.</li>
<li>The "user-me" is intended to be built, and then deployed, for a specific
invoking user. It operates with the username of the invoking user, granted
password free access to root, via sudo. This configuration can not be prepared
in advance, but does provide a smoother integration for the invoking user. It
is particularly suited to Linux.</li>
</ul>
<h4 id="user-me"><a class="header" href="#user-me">User Me</a></h4>
<p>Pulling pre-built Docker Image (dep):</p>
<pre><code>make pull IMAGE=dep
</code></pre>
<p>Building Docker Image (user-me):</p>
<pre><code>make build IMAGE=user-me
</code></pre>
<p>Running Docker Image (user-me):</p>
<pre><code>make run IMAGE=user-me HOST_PATH=&lt;HOST_PATH&gt; HOME_PATH=&lt;HOME_PATH&gt;
</code></pre>
<h4 id="user-developer"><a class="header" href="#user-developer">User Developer</a></h4>
<p>Pulling Docker Image (user-dev):</p>
<pre><code>make pull IMAGE=user-dev
</code></pre>
<p>Running Docker Image (user-dev):</p>
<pre><code>make run IMAGE=user-dev HOST_PATH=&lt;HOST_PATH&gt; HOME_PATH=&lt;HOME_PATH&gt;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="target-platform-setup"><a class="header" href="#target-platform-setup">Target Platform Setup</a></h1>
<p>The Avnet MaaXBoard is packaged in a small box with listed kit contents of:</p>
<ul>
<li>1 x MaaXBoard; and</li>
<li>1 x Heat Sink Kit.</li>
</ul>
<p>Our boards came with the heat sink already attached; however, sales photographs of the board are often shown without the heat sink and it is conceivable that you may have to attach it yourself.</p>
<p>The following shows a plan view of the MaaXBoard with heat sink attached:</p>
<p><img src="install_and_configure/../install_and_configure/figures/avnet-maaxboard-plan.png" alt="Avnet MaaXBoard plan view" /></p>
<p>For clarity, not all of the components have been labelled, only those to which we are going to refer. Full hardware details are given in the <a href="https://www.avnet.com/wps/wcm/connect/onesite/1e83cac7-ebe8-4be4-8776-6781e3833d11/MaaXBoard-Hardware_UserManual-V1.2-EN.pdf?MOD=AJPERES&amp;CACHEID=ROOTWORKSPACE.Z18_NA5A1I41L0ICD0ABNDMDDG0000-1e83cac7-ebe8-4be4-8776-6781e3833d11-nVsEcIl">MaaXBoard Hardware User Manual</a>, including the full pin-out for the 40-pin GPIO connector, but we only use the three pins that are labelled in red in the photograph. For reference, pin 1 is also labelled in blue and the numbering is as follows:</p>
<p><img src="install_and_configure/../install_and_configure/figures/GPIO-pin-out.png" alt="GPIO pin numbering" /></p>
<h2 id="connecting-to-the-maaxboard"><a class="header" href="#connecting-to-the-maaxboard">Connecting to the MaaXBoard</a></h2>
<p>Communications with the MaaXBoard from the host machine are via the USB-to-TTL serial UART cable. This converts between the voltage levels and protocols of the board's UART and the host machine's USB port. The USB end plugs into the host machine, and the flying leads are connected to the GPIO pins on the MaaXBoard.</p>
<p>The USB-to-TTL serial UART cable that we used has 3 flying lead connectors, but some cables have more connectors. The leads shown below in our photographs adhere to the following colour convention, but this should not necessarily be assumed for your cable and should be confirmed before connecting:</p>
<ul>
<li>Black = Ground;</li>
<li>Yellow = Transmit;</li>
<li>Orange = Receive.</li>
</ul>
<p><img src="install_and_configure/../install_and_configure/figures/uart-connector-side1.png" alt="UART connector side 1" /></p>
<p><img src="install_and_configure/../install_and_configure/figures/uart-connector-side2.png" alt="UART connector side 2" /></p>
<p>The final photograph shows the MaaXBoard (anti-clockwise from the top):</p>
<ul>
<li>populated with a Micro SD card;</li>
<li>connected to a power supply (USB-C);</li>
<li>connected to a USB flash drive (may not be necessary if loading via Ethernet);</li>
<li>connected to an Ethernet cable (may not be necessary if loading from USB);</li>
<li>connected to a USB-to-TTL serial UART cable.</li>
</ul>
<p><img src="install_and_configure/../install_and_configure/figures/maaxboard-populated.png" alt="Avnet MaaXBoard populated" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bootloader-setup"><a class="header" href="#bootloader-setup">Bootloader Setup</a></h1>
<p>When a computer is turned off, its software remains stored in non-volatile memory. When the computer is powered on, a bootstrap loader is required: a small, low-level program to configure the computer's memory and devices sufficient to then be able to load further software, such as a bare-metal application or operating system, into RAM and then call it.</p>
<p><strong>Das U-Boot</strong> (known as "the Universal Boot Loader" and often shortened to U-Boot) is an open-source bootloader commonly used in embedded devices. For such low-level operations, it has to be customized for the hardware on which it is running.</p>
<p>There are two options for configuring and installing U-Boot:</p>
<ul>
<li><a href="install_and_configure/using_the_prebuilt_image.html">Using the prebuilt image</a></li>
<li><a href="install_and_configure/building_uboot_manually.html">Building U-Boot manually</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-the-prebuilt-image"><a class="header" href="#using-the-prebuilt-image">Using the prebuilt image</a></h1>
<p>Instructions for using the prebuilt U-Boot image are as follows: <em>Note: the disk images have been created for a 16GB SD card; please use a card that is 16GB or larger.</em></p>
<ol>
<li>
<p>Get the prebuilt disk image from the <a href="https://github.com/sel4devkit/maaxboard-prebuilt">maaxboard-prebuilt</a> repository, either by cloning the entire repository, or by using the direct link <a href="https://github.com/sel4devkit/maaxboard-prebuilt/blob/main/disk_images/maaxboard-uboot.img.zip">here</a>.</p>
<p><em>Note: the images are compressed as zip files in order to reduce their size (compressed size ~15MB, uncompressed size ~15GB), and will need to be uncompressed using a suitable utility before use.</em></p>
</li>
<li>
<p>Once you have downloaded the image you will need to use a utility for flashing images to external drives. The rest of this section assumes that you will use Etcher; see the <a href="install_and_configure/host_setup.html">Host Setup</a> section for more details.</p>
</li>
<li>
<p>Insert the SD card you wish to flash, and open Etcher.
<img src="install_and_configure/../install_and_configure/figures/etcher-default.png" alt="etcher-default" /></p>
</li>
<li>
<p>Select Flash from file, and navigate to and select the image file you wish to flash. Then click open.
<img src="install_and_configure/../install_and_configure/figures/etcher-img-select.png" alt="etcher-img-select" /></p>
</li>
<li>
<p>Click select target and select the drive you wish to flash, taking care to choose the right drive.
<img src="install_and_configure/../install_and_configure/figures/etcher-drive-select.png" alt="etcher-drive-select" /></p>
</li>
<li>
<p>Then finally click ‘Flash!’ to flash the image. This may take a significant time (e.g. 25 minutes).
<img src="install_and_configure/../install_and_configure/figures/etcher-ready-to-flash.png" alt="etcher-ready-to-flash" />
<em>Flashing in progress:</em>
<img src="install_and_configure/../install_and_configure/figures/etcher-flashing.png" alt="etcher-flashing" />
<em>After Etcher has flashed the disk, it will validate the disk:</em>
<img src="install_and_configure/../install_and_configure/figures/etcher-validation.png" alt="etcher-validation" /></p>
</li>
<li>
<p>Once flashing is complete, the SD card is ready for use in the MaaXBoard for booting as far as the U-Boot bootloader.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="building-u-boot-manually"><a class="header" href="#building-u-boot-manually">Building U-Boot manually</a></h1>
<p>The instructions for <a href="install_and_configure/building_uboot_manually.html#partitioning-the-sd-card">formatting the SD card</a>, <a href="install_and_configure/building_uboot_manually.html#building-u-boot">building U-Boot</a> and <a href="install_and_configure/building_uboot_manually.html#writing-u-boot-to-the-sd-card">flashing the image</a> are as follows:</p>
<h2 id="partitioning-the-sd-card"><a class="header" href="#partitioning-the-sd-card">Partitioning the SD Card</a></h2>
<p>The SD card must be partitioned correctly in order to contain U-Boot, seL4 and space for a filesystem. This can be done as follows.</p>
<p>The intention of this section is provide instructions on how to create three partitions on the disk:</p>
<ul>
<li>
<p>a 10 megabyte bootloader partition for U-Boot;</p>
</li>
<li>
<p>a 256 megabyte partition to hold the seL4 image; and,</p>
</li>
<li>
<p>the remainder of the disk is provided for the file system.</p>
</li>
</ul>
<h3 id="macos-instructions"><a class="header" href="#macos-instructions">macOS Instructions</a></h3>
<ol>
<li>
<p>Connect your SD card reader to your host machine and insert your SD card.</p>
</li>
<li>
<p>Find the disk identifier (e.g <code>/dev/disk6</code> ) for your SD card, on macOS this can be done by running <code>diskutil list</code> . This command should present a list of disks and their partitions, <code>/dev/disk0</code> and <code>/dev/disk1</code> are usually used for the internal SSD/HDD on your Mac, so the SD card will usually be at the bottom, assuming it was the last storage device attached to your machine.</p>
</li>
<li>
<p>On macOS, you may need to unmount any volumes associated with the SD card. You can do this either from Disk Utility or by using <code>diskutil unmount /dev/diskXsY</code> where <code>X</code> is the disk identifier and <code>Y</code> is the volume identifier.</p>
</li>
<li>
<p>From terminal run the following command, replacing X in <code>/dev/diskX</code> with your disk identifier as found earlier. <em>Note: the <code>15GB</code> size mentioned for the <code>FILESYS</code> partition can be changed to <code>R</code> which will use the remainder of the disk. The instructions here use <code>15GB</code> to reflect what was used to create the prebuilt images in the <a href="https://github.com/sel4devkit/maaxboard-prebuilt">maaxboard-prebuilt</a> repo. <code>15GB</code> is used as "16GB" SD cards/flash drives are not all truly "16GB" due to formatting, so this is done to account for minor differences in size.</em></p>
<pre><code class="language-sh">sudo diskutil partitionDisk /dev/diskX 3 MBR \
   FREE Bootloader 10M \
   FAT32 BOOT 256M \
   FAT32 FILESYS 15GB
</code></pre>
</li>
</ol>
<h3 id="linux-instructions"><a class="header" href="#linux-instructions">Linux Instructions</a></h3>
<ol>
<li>
<p>Connect your SD card reader to your host machine and insert your SD card.</p>
</li>
<li>
<p>Find the disk identifier (e.g <code>/dev/sdb</code> ) for your SD card, on Linux this can be done by examining the kernel ring buffer following insertion of the SD card by running <code>dmesg | tail</code> . For example, the following <code>dmesg</code> output shows the inserted card using identifier <code>sdb</code> and having two volumes <code>sdb1</code> and <code>sdb2</code>.</p>
<pre><code class="language-text">[0.711] scsi host6: usb-storage 2-1.5:1.0
[0.728] scsi 6:0:0:0: Direct-Access   SD/MMC   Card  Reader   1.00 PQ: 0 ANSI: 0
[0.735] sd 6:0:0:0: Attached scsi generic sg2 type 0
[1.020] sd 6:0:0:0: [sdb] 30883840 512-byte logical blocks: (15.8 GB/14.7 GiB)
[1.022] sd 6:0:0:0: [sdb] Write Protect is off
[1.022] sd 6:0:0:0: [sdb] Mode Sense: 03 00 00 00
[1.025] sd 6:0:0:0: [sdb] No Caching mode page found
[1.025] sd 6:0:0:0: [sdb] Assuming drive cache: write through
[1.076]  sdb: sdb1 sdb2
[1.084] sd 6:0:0:0: [sdb] Attached SCSI removable disk
</code></pre>
</li>
<li>
<p>On Linux, you may need to unmount any volumes associated with the SD card. You can do this using the <code>umount</code> command. If two volumes named <code>sdb1</code> abd <code>sdb2</code> were detected on insertion of the SD card these would be unmounted with the following commands:</p>
<pre><code class="language-sh">sudo umount /dev/sdb1
sudo umount /dev/sdb2
</code></pre>
</li>
<li>
<p>From terminal run the following commands, replacing <code>&lt;disk&gt;</code> in <code>/dev/&lt;disk&gt;</code> with your disk identifier as found earlier. <em>Note: the <code>14602MiB</code> size mentioned for the final partition can be changed to <code>100%</code> which will use the remainder of the disk. <code>14602MiB</code> is used as "16GB" SD cards/flash drives are not all truly "16GB" due to formatting, so this is done to account for minor differences in size.</em></p>
<pre><code class="language-sh">sudo parted /dev/&lt;disk&gt; mklabel msdos
sudo parted /dev/&lt;disk&gt; mkpart primary fat32 10MiB 266MiB
sudo parted /dev/&lt;disk&gt; mkpart primary fat32 266MiB 14602MiB
sudo mkfs.vfat /dev/&lt;disk&gt;1 -F 32 -n BOOT
sudo mkfs.vfat /dev/&lt;disk&gt;2 -F 32 -n FILESYS
</code></pre>
</li>
</ol>
<h2 id="building-u-boot"><a class="header" href="#building-u-boot">Building U-Boot</a></h2>
<p>In order to build U-Boot, the seL4devkit Docker build environment is required, please see <a href="install_and_configure/build_environment_setup.html">Build Environment Setup</a> to setup this up if you haven't already done so.</p>
<ol>
<li>Clone the repository:</li>
</ol>
<pre><code>git clone git@github.com:sel4devkit/sel4devkit-maaxboard-bootloader-u-boot.git
</code></pre>
<ol start="2">
<li>Clone dependencies</li>
</ol>
<pre><code>cd sel4devkit-maaxboard-bootloader-u-boot
make get
</code></pre>
<ol start="3">
<li>Build</li>
</ol>
<pre><code>make all
</code></pre>
<ol start="4">
<li>The generated file <code>flash.bin</code> is located in the <code>/out</code> folder and can be written to storage media.</li>
</ol>
<h2 id="writing-u-boot-to-the-sd-card"><a class="header" href="#writing-u-boot-to-the-sd-card">Writing U-Boot to the SD card</a></h2>
<ol>
<li>
<p>Navigate to the folder containing your U-Boot <code>flash.bin</code> file.</p>
<blockquote>
<p><strong>WARNING: The next step uses the <code>dd</code> command line utility, which is used for writing images to disks. IT WILL OVERWRITE ANY DATA ON THE DISK IT IS SPECIFIED TO WRITE TO! Improper usage WILL cause data loss, corruption and potentially render your system inoperable. Please ensure you are familiar with the use of the command, as well as the disk identifiers on your system, and that you are writing to the disk you intend to, and not your system drive!</strong></p>
</blockquote>
</li>
<li>
<p>From that folder run the following command, replacing <code>/dev/diskX</code> with the disk identifier of your SD card. You may be asked to enter your password.</p>
<pre><code class="language-sh">sudo dd if=flash.bin of=/dev/diskX bs=1k seek=33
</code></pre>
</li>
<li>
<p>The image should now be written to your SD card and should be bootable by the MaaXBoard.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setting-up-the-u-boot-config-file"><a class="header" href="#setting-up-the-u-boot-config-file">Setting up the U-Boot config file</a></h1>
<p>A U-Boot configuration file (uEnv.txt) is contained within the provided image. It is placed in the root of the <code>BOOT</code> partition and is named <code>uEnv.txt</code>. It contains 3 main configurable items:</p>
<ol>
<li>
<p>U-Boot network configuration (<code>ipaddr</code> and <code>netmask</code>): use this to manually configure the IP address and subnet for U-Boot to use, or comment them out to have them assigned by DHCP/BootP.</p>
</li>
<li>
<p>TFTP server IP address (<code>serverip</code>): use this to configure the IP address of the TFTP server to contact, or comment out to disable boot via TFTP.</p>
</li>
<li>
<p>ELF binary name (<code>elf_binary_file</code>): the name of the ELF binary the U-Boot will try to load, first from a USB device, then from a SD card, and finally via the configured TFTP server.</p>
</li>
</ol>
<p>Different commands are needed to load each type of image. Microkit generates .img file which is loaded using the "go" instruction and CAmkES generates a .elf file which is loaded using the "bootelf" command. To see different U-Boot configuration options see: <a href="https://github.com/sel4devkit/sel4devkit-maaxboard-bootloader-u-boot/tree/main/uenv">sel4devkit-maaxboard-bootloader-u-boot</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="first-boot"><a class="header" href="#first-boot">First Boot</a></h1>
<p>First boot aims to demonstrate correct operation of the prepared SD card and communication over the serial interface. This ensures all steps have been followed correctly prior to proceeding with compilation and execution of an seL4 binary.</p>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<p>Prior to powering the MaaXBoard ensure the following setup is in place, building on previous sections:</p>
<ol>
<li>
<p>The SD card has been prepared as per the instructions in the <a href="first_boot/../install_and_configure/bootloader_setup.html">Bootloader Setup</a> section.</p>
</li>
<li>
<p>The MaaXBoard has been set up as per the <a href="first_boot/../install_and_configure/target_setup.html">Target Setup</a> section with only the USB-to-TTL cable connected and the SD card inserted.</p>
</li>
<li>
<p>The USB-to-TTL cable is connected to the host machine with CoolTerm/Minicom configured as per the <a href="first_boot/../install_and_configure/host_setup.html">Host Setup</a> section.</p>
</li>
</ol>
<h2 id="boot-to-u-boot-prompt"><a class="header" href="#boot-to-u-boot-prompt">Boot to U-Boot Prompt</a></h2>
<p>At this stage power should be supplied to the MaaXBoard by connecting the USB-C power adapter. On supply of power the user should see the output of the bootloader displayed in CoolTerm/Minicom. As no <code>sel4_image</code> binary has been supplied the user should be dropped to the U-Boot command prompt.</p>
<p>The log below shows the serial terminal output on the host machine when the MaaXBoard boots with no access to a binary to execute.</p>
<p>Note that the serial terminal output does not include the line numbers shown in the example logs shown below; those line numbers have only been added afterwards for ease of reference in this documentation.</p>
<pre><code class="language-text">     1  U-Boot SPL 2021.04-00002-gf752480a4c (Jan 20 2022 - 10:32:23 +0000)
     2  power_bd71837_init
     3  set buck8 to 1.2v for DDR4
     4  DDRINFO: start DRAM init
     5  DDRINFO: DRAM rate 2400MTS
     6  DDRINFO:ddrphy calibration done
     7  DDRINFO: ddrmix config done
     8  Normal Boot
     9  Trying to boot from MMC1
    10  
    11  
    12  U-Boot 2021.04-00002-gf752480a4c (Jan 20 2022 - 10:32:23 +0000)
    13  
    14  CPU:   i.MX8MQ rev2.1 1500 MHz (running at 1000 MHz)
    15  CPU:   Commercial temperature grade (0C to 95C) at 24C
    16  Reset cause: POR
    17  Model: Avnet Maaxboard
    18  DRAM:  2 GiB
    19  MMC:   FSL_SDHC: 0
    20  Loading Environment from MMC... *** Warning - bad CRC, using default environment
    21  
    22  In:    serial
    23  Out:   serial
    24  Err:   serial
    25  
    26   BuildInfo:
    27    - ATF d801fd9
    28  
    29  switch to partitions #0, OK
    30  mmc0 is current device
    31  flash target is MMC:0
    32  Net:   
    33  Warning: ethernet@30be0000 (eth0) using random MAC address - 5a:15:1f:fd:43:19
    34  eth0: ethernet@30be0000
    35  Fastboot: Normal
    36  Normal Boot
    37  Hit any key to stop autoboot:  2 ... 1 ... 0 
    38  starting USB...
    39  Bus usb@38100000: Register 2000140 NbrPorts 2
    40  Starting the controller
    41  USB XHCI 1.10
    42  Bus usb@38200000: Register 2000140 NbrPorts 2
    43  Starting the controller
    44  USB XHCI 1.10
    45  scanning bus usb@38100000 for devices... 1 USB Device(s) found
    46  scanning bus usb@38200000 for devices... 1 USB Device(s) found
    47         scanning usb for storage devices... 0 Storage Device(s) found
    48  
    49  Device 0: unknown device
    50  MMC Device 1 not found
    51  no mmc device at slot 1
    52  MMC Device 2 not found
    53  no mmc device at slot 2
    54  switch to partitions #0, OK
    55  mmc0 is current device
    56  SD/MMC found on device 0
    57  1493 bytes read in 1 ms (1.4 MiB/s)
    58  Loaded env from uEnv.txt
    59  Importing environment from mmc0 ...
    60  Running uenvcmd ...
    61
    62  Device 0: unknown device
    63
    64  Device 1: unknown device
    65  switch to partitions #0, OK
    66  mmc0 is current device
    67  Booting ELF binary from mmc 0 ...
    68  Failed to load 'sel4_image'
    69  ## No elf image at address 0x40480000
    70  MMC Device 1 not found
    71  no mmc device at slot 1
    72  Using statically defined IP address
    73  Booting ELF binary from TFTP ...
    74  ethernet@30be0000 Waiting for PHY auto negotiation to
        complete......................................... TIMEOUT !
    75  Could not initialize PHY ethernet@30be0000
    76  Using ethernet@30be0000 device
    77  TFTP from server 192.168.100.3; our IP address is 192.168.100.50
    78  Filename 'sel4_image'.
    79  Load address: 0x40480000
    80  Loading: *.
    81  ARP Retry count exceeded; starting again
    82  ## No elf image at address 0x40480000
    83  switch to partitions #0, OK
    84  mmc0 is current device
    85  Failed to load 'boot.scr'
    86  Failed to load 'Image'
    87  Booting from net ...
    88  ethernet@30be0000 Waiting for PHY auto negotiation to
      complete......................................... TIMEOUT !
    89  Could not initialize PHY ethernet@30be0000
    90  BOOTP broadcast 1
    91  BOOTP broadcast 2
    92  BOOTP broadcast 3
    93  BOOTP broadcast 4
    94  BOOTP broadcast 5
    95  BOOTP broadcast 6
    96  BOOTP broadcast 7
    97  BOOTP broadcast 8
    98  BOOTP broadcast 9
    99  BOOTP broadcast 10
   100  BOOTP broadcast 11
   101  BOOTP broadcast 12
   102  BOOTP broadcast 13
   103  BOOTP broadcast 14
   104  BOOTP broadcast 15
   105  BOOTP broadcast 16
   106  BOOTP broadcast 17
   107  
   108  Retry time exceeded; starting again
   109  ethernet@30be0000 Waiting for PHY auto negotiation to
      complete......................................... TIMEOUT !
   110  Could not initialize PHY ethernet@30be0000
   111  BOOTP broadcast 1
   112  BOOTP broadcast 2
   113  BOOTP broadcast 3
   114  BOOTP broadcast 4
   115  BOOTP broadcast 5
   116  BOOTP broadcast 6
   117  BOOTP broadcast 7
   118  BOOTP broadcast 8
   119  BOOTP broadcast 9
   120  BOOTP broadcast 10
   121  BOOTP broadcast 11
   122  BOOTP broadcast 12
   123  BOOTP broadcast 13
   124  BOOTP broadcast 14
   125  BOOTP broadcast 15
   126  BOOTP broadcast 16
   127  BOOTP broadcast 17
   128  
   129  Retry time exceeded; starting again
   130  WARN: Cannot load the DT
   131  u-boot=&gt; 
</code></pre>
<p><em>Note: The CRC warning at line 20 is not an important issue; it is just an artefact from the basic U-Boot image, and the default environment variables are sufficient.</em></p>
<p>Once at the U-Boot prompt, the user can enter interactive U-Boot commands. For example:</p>
<ul>
<li><code>help</code> to display the available commands;</li>
<li><code>printenv</code> to display the environment variables;</li>
<li><code>setenv</code> to set environment variables;</li>
<li><code>reset</code> to reset the CPU instead of physically cycling the power.</li>
</ul>
<p>A full reference to U-Boot commands can be found <a href="https://u-boot.readthedocs.io/en/latest/usage/index.html?highlight=shell">here</a> but we only use a few of them directly in this developer kit.</p>
<p>The following sections build upon this step by demonstrating the building and execution of an seL4 application on the MaaXBoard.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bootloader"><a class="header" href="#bootloader">Bootloader</a></h1>
<p>After U-Boot has configured the MaaXBoard's memory and devices, it is able to load an application into RAM and then execute it. It is possible for a user to do this interactively using U-Boot commands via the serial terminal on the host machine. It is also possible and convenient to provide a U-Boot configuration file <code>uEnv.txt</code> that runs automatically; both options are documented below.</p>
<h3 id="methods-of-loading"><a class="header" href="#methods-of-loading">Methods of Loading</a></h3>
<p>We cover three primary mechanisms for loading the application into RAM by U-Boot:</p>
<ul>
<li>from SD card;</li>
<li>from USB flash drive;</li>
<li>via TFTP.</li>
</ul>
<p>Additional mechanisms are available, such as downloading over the serial cable; however, this would be much slower compared with the options above and is not considered further here. Downloading from on-board flash memory is another possible mechanism, but that is not applicable to the MaaXBoard.</p>
<p>The remainder of this section assumes that you have an application in the form of an executable ELF file called <code>sel4_image</code>. We will create this as our test application <a href="first_boot/sel4test.html">later in this documentation</a>, but this section is concerned with the loading mechanisms rather than the executable itself.</p>
<h4 id="loading-from-sd-card"><a class="header" href="#loading-from-sd-card">Loading from SD Card</a></h4>
<p>The SD card is used to store the bootloader, U-Boot. The SD card may also be used to store the application's ELF file that is to be loaded into RAM by the bootloader. If the SD card is partitioned as described in the <a href="first_boot/../install_and_configure/bootloader_setup.html">Bootloader setup</a> section, the <code>BOOT</code> partition is used for this by placing the <code>sel4_image</code> file in the root of the partition.</p>
<p>An advantage of this approach is that it makes use of a single medium that (a) is already being used to store U-Boot and (b) generally has a much larger capacity than is required by U-Boot alone.</p>
<p>A disadvantage is that while U-Boot is likely to be a relatively unchanging artefact (once it has been configured for a particular board), during development the application is likely to be modified repeatedly, and removing, reprogramming, and replacing the SD card is inconvenient and physically stresses the card and its mountings.</p>
<h4 id="loading-from-usb-flash-drive"><a class="header" href="#loading-from-usb-flash-drive">Loading from USB Flash Drive</a></h4>
<p>The MaaXBoard has two USB 3.0 connectors that U-Boot is able to access, so the application file may be stored on a removable USB flash drive (i.e. thumb/pen drive) and loaded into RAM by U-Boot. To load the <code>sel4_image</code> binary from a USB flash drive the file needs to be placed in the root of a FAT formatted drive.</p>
<p>Compared with loading from SD card, this approach has the advantage of leaving the SD card and its U-Boot image undisturbed, although it still involves physical insertion and removal of the flash drive on both the development board and the host machine whenever a new version is to be tested.</p>
<h4 id="loading-via-tftp"><a class="header" href="#loading-via-tftp">Loading via TFTP</a></h4>
<p>The MaaXBoard has an Ethernet port that U-Boot is able to access, and the application file may be downloaded from the host machine over TFTP (Trivial File Transfer Protocol), a convenient and popular method for booting.</p>
<p>Connection options include either a direct wired Ethernet connection between the host machine and the MaaXBoard:</p>
<p><img src="first_boot/../install_and_configure/figures/TFTP-option-direct.png" alt="TFTP option direct connection" /></p>
<p>Or a network connection via a hub / router:</p>
<p><img src="first_boot/../install_and_configure/figures/TFTP-option-router.png" alt="TFTP option router connection" /></p>
<p>Loading via TFTP is considered to be the most convenient method within an application development environment as there is no need to keep plugging and unplugging anything from the board. To load the <code>sel4_image</code> binary via TFTP, the file needs to be made available for download from the TFTP server.</p>
<p>Below are the instructions for setting up TFTP on linux:</p>
<h4 id="setting-up-a-netboot-server-using-tftp"><a class="header" href="#setting-up-a-netboot-server-using-tftp">Setting up a netboot server using TFTP</a></h4>
<ol>
<li><a href="https://thekelleys.org.uk/dnsmasq/doc.html">Dnsmasq</a> is the application used to provide a network infrastructure. The program can be installed using your provided package manager (for Debian, this would be <code>apt</code>).</li>
</ol>
<pre><code>sudo apt install dnsmasq
</code></pre>
<ol start="2">
<li>
<p>Create the root folder where the image will be stored. In this example, the path will be <code>/var/lib/tftpboot</code>.</p>
</li>
<li>
<p>Identify the ethernet interface you will be connecting the board to using <code>ip addr</code> command from the terminal.</p>
</li>
</ol>
<pre><code>$ ip addr
1. eno2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP gruop default qlen 1000
    link/ether [IPv4 ADDRESS] brd ff:ff:ff:ff:ff:ff
    altname enp2s0
    inet 10.0.0.253/24 scope global eno2
        valid_lft forever preferred_lft forever
    inet6 [IPv6 ADDRESS] scope link
        valid_lft forever preferred_lft forever
</code></pre>
<p>From this command, the necessary information is the <em>mac address</em> of the interface (01:23:45:67:89:0a in this case), and the <em>inet address</em> (10.0.0.253).</p>
<ol start="4">
<li>Edit the file <code>/etc/dnsmasq.conf</code> with the output of the ip addr command. The dnsmasq.conf file takes this format:</li>
</ol>
<pre><code>interface=&lt;interface_name&gt;
dhcp-range=&lt;start_ip&gt;,&lt;end_ip&gt;,&lt;lease_time&gt;
dhcp-host=&lt;mac_address&gt;,&lt;hostname&gt;,infinite
dhcp-boot=&lt;image_name&gt;
enable-tftp
tftp-root=&lt;root_folder&gt;
</code></pre>
<ul>
<li>interface -&gt; Specifies which network interface dnsmasq will listen on for DHCP and TFTP requests</li>
<li>dhcp-range -&gt; Defines the range of IP addresses that dnsmasq can allocate to devices on the network via DHCP.</li>
<li>dhcp-host -&gt; Maps a specific MAC address to a hostname and optionally assigns a permanent IP address (infinite lease time)</li>
<li>dhcp-boot -&gt; Specifies the boot file that should be served to clients requesting a network boot via TFTP</li>
<li>enable-tftp -&gt; Enables the TFTP (Trivial File Transfer Protocol) server functionality within dnsmasq.</li>
<li>tftp-root -&gt; Specifies the directory where the TFTP server will look for files to serve.</li>
</ul>
<p>For the output listed in step 3, the file will look like this:</p>
<pre><code>interface=eno2
dhcp-range=10.0.0.101,10.0.0.200,12h
dhcp-host=01:23:45:67:89:0a,svr1,infinite
dhcp-boot=sel4_image
enable-tftp
tftp-root=/var/lib/tftpboot
</code></pre>
<ol start="5">
<li>With the setup complete for dnsmasq, the service can be started and enabled. To ensure the service has properly started, the <code>status</code> command can be used.</li>
</ol>
<pre><code>systemctl start dnsmasq
systemctl enable dnsmasq
systemctl status dnsmasq
</code></pre>
<p>If, at any point, any of the configuration files need to be changed, the service will need to be restarted with <code>systemctl restart dnsmasq</code> to see these changes reflected.</p>
<ol start="6">
<li>If a firewall is enabled, rules will need to be added to allow requests to pass to the dnsmasq server. The following commands will permit requests:</li>
</ol>
<pre><code>iptables -A INPUT -i eno2 --dport 69 -j ACCEPT
iptables -A INPUT -i eno2 -p tcp --dport 67:68 -j accept
</code></pre>
<ol start="7">
<li>
<p>The board is now ready to use the tftp server. The bootloader will try to boot using <code>sel4_image</code> stored in <code>/var/lib/tftpboot</code>.</p>
</li>
<li>
<p>If an error occurs and U-Boot drops to a prompt, the image can still be booted using U-Boot commands. Using <code>bootp sel4_image</code> will load the file to a memory address (usually <code>50000000</code>), where it can then be booted using <code>bootelf 50000000</code> for .elf files or <code>go 50000000</code> for .img files. This method can also be used to boot different images. By using <code>bootp</code>, any file contained within <code>/var/lib/tftpboot</code> can be loaded and then booted.</p>
</li>
</ol>
<pre><code>u-boot=&gt; bootp sel4_image
BOOTP broadcast 1
DHCP client bound to address 10.0.0.115 (6ms)
Using ethernet@30be0000 device
TFTP from server 10.0.0.253 our IP address is 10.0.0.115
Filename 'sel4_image'.
Load address 0x40480000
Loading: ###############################################################################
         ###############################################################################
         ###############################################################################
         ###############################################################################
         ###############################################################################
         ###############################################################################
         ###############################################################################
         ###############################################################################
         ###############################################################################
         ###############################################################################
         ###########################################################################
         11.9 MiB/s
done
Bytes transferred = 15217072 (e831b0)
u-boot=&gt; bootelf 40480000
</code></pre>
<h3 id="u-boot-configuration-file"><a class="header" href="#u-boot-configuration-file">U-Boot Configuration File</a></h3>
<p>Booting via U-Boot can be configured via commands stored in a file named <code>uEnv.txt</code> and placed in the <code>BOOT</code> partition of the SD card.</p>
<p>The example file below (stored on the SD card prepared via the instructions in the <a href="first_boot/../install_and_configure/bootloader_setup.html">Bootloader Setup</a> section) automatically searches for, loads and then executes the binary file named <code>sel4_image</code>. The following potential locations for the <code>sel4_image</code> are searched in order:</p>
<ol>
<li>USB flash drive with a FAT filesystem.</li>
<li>SD Card / eMMC device with a FAT filesystem.</li>
<li>TFTP server.</li>
</ol>
<pre><code class="language-text">### Uncomment and define the 'ipaddr' and 'netmask' variables to statically set
### the device IP address. If no static IP address is provided one will attempt to
### assigned using DHCP / BOOTP.

### ipaddr=192.168.100.50
### netmask=255.255.255.0

### Uncomment and define the 'serverip' address to set the IP address of the
### TFTP server. If no server IP address is defined then no attempt to boot
### from TFTP will be made.

serverip=192.168.0.11

### Define the name of the ELF binary to boot.

elf_binary_file=sel4_image

### Attempt to boot the ELF binary. The following locations will be searched in
### priority order:
### 1. USB mass storage devices with a FAT filesystem.
### 2. SD Card / eMMC devices with a FAT filesystem.
### 3. TFTP server.

elf_dev_boot=if ${devtype} dev ${devnum}; then echo Booting ELF binary from ${devtype} ${devnum} ...; fatload ${devtype} ${devnum} ${loadaddr} ${elf_binary_file}; bootelf ${loadaddr}; fi
elf_tftp_boot_0=if test -n ${serverip}; then run elf_tftp_boot_1; else echo Skipping booting ELF binary from TFTP, serverip not defined; fi
elf_tftp_boot_1=if test -n ${ipaddr}; then echo Using statically defined IP address; else echo Setting IP address from DHCP / BOOTP; setenv autoload no; dhcp; fi; run elf_tftp_boot_2
elf_tftp_boot_2=echo Booting ELF binary from TFTP ...; tftp ${loadaddr} ${elf_binary_file}; bootelf ${loadaddr}
uenvcmd=usb start; for devtype in usb mmc; do for devnum in 0 1; do run elf_dev_boot; done; done; run elf_tftp_boot_0
</code></pre>
<p>Some configuration of the <code>uEnv.txt</code> file is required, e.g. to set IP addresses relevant to the user's network. This is covered in more detail in the <a href="first_boot/../install_and_configure/bootloader_setup.html">Bootloader Setup</a> and <a href="first_boot/main.html">First Boot</a> sections.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sel4test"><a class="header" href="#sel4test">sel4test</a></h1>
<p>As a worked example throughout this section the <a href="https://docs.sel4.systems/projects/sel4test">seL4Test</a> project will be used. seL4Test is a test suite for seL4 developed and maintained by the seL4 Foundation.</p>
<p>This section of the document assumes the <a href="first_boot/../install_and_configure/build_environment_setup.html">build environment setup</a> has been completed and the user is using the <a href="first_boot/../install_and_configure/build_environment_setup.html#camkes">CAmkES docker environment</a>. All commands provided within this section are to be executed within the build environment; i.e. please ensure that you have followed the instructions in the <a href="first_boot/../install_and_configure/build_environment_setup.html#usage">build environment setup's usage</a> section and that you execute the following commands from inside the Docker container.</p>
<h2 id="context-1"><a class="header" href="#context-1">Context</a></h2>
<p>The seL4Test example that is built in this section is a result of an seL4 port for the Avnet MaaXBoard that we created for this developer kit. Whilst our seL4 port is not documented here in detail, there is some guidance on this in the <a href="first_boot/sel4test.html#appendices">Guide to Porting seL4</a> appendix, which includes links to the Git commits that added the MaaXBoard port to the main seL4 repositories.</p>
<h2 id="getting-the-code"><a class="header" href="#getting-the-code">Getting the Code</a></h2>
<p>Clone the repository:</p>
<pre><code class="language-bash">git clone git@github.com:sel4devkit/sel4devkit-maaxboard-first-boot-sel4test.git
</code></pre>
<h2 id="building"><a class="header" href="#building">Building</a></h2>
<p>The sel4test example uses the make build system therefore make needs to be run in the repository:</p>
<pre><code>cd sel4devkit-maaxboard-first-boot-sel4test
</code></pre>
<pre><code>make get
make all
</code></pre>
<p>On completion of the compilation, the resulting executable is available at <code>/host/sel4devkit-maaxboard-first-boot-sel4test/out/program.elf</code> on the build environment, or available at <code>/&lt;host_directory&gt;/sel4devkit-maaxboard-first-boot-sel4test/out/program.elf</code> on the host machine, where <code>/&lt;host_directory&gt;</code> was the directory on the host mapped to the build environment.</p>
<h2 id="example-output"><a class="header" href="#example-output">Example Output</a></h2>
<p>The example output when executed on the target (as described in <a href="first_boot/bootloader.html">bootloader</a>) is demonstrated below:</p>
<pre><code>u-boot=&gt; bootelf 0x50000000
## Starting application at 0x40a39000 ...

ELF-loader started on CPU: ARM Ltd. Cortex-A53 r0p4
  paddr=[40a39000..40f21137]
No DTB passed in from boot loader.
Looking for DTB in CPIO archive...found at 40b7b8e8.
Loaded DTB from 40b7b8e8.
   paddr=[4023f000..40249fff]
ELF-loading image 'kernel' to 40000000
  paddr=[40000000..4023efff]
  vaddr=[ffffff8040000000..ffffff804023efff]
  virt_entry=ffffff8040000000
ELF-loading image 'sel4test-driver' to 4024a000
  paddr=[4024a000..4063ffff]
  vaddr=[400000..7f5fff]
  virt_entry=40ef18
Enabling MMU and paging
Jumping to kernel-image entry point...

Warning:  gpt_cntfrq 8333333, expected 8000000
Bootstrapping kernel
available phys memory regions: 1
  [40000000..c0000000]
reserved virt address space regions: 3
  [ffffff8040000000..ffffff804023f000]
  [ffffff804023f000..ffffff80402492c7]
  [ffffff804024a000..ffffff8040640000]
Booting all finished, dropped to user space
Node 0 of 1
IOPT levels:     0
IPC buffer:      0x7f6000
Empty slots:     [1100 --&gt; 8192)
sharedFrames:    [0 --&gt; 0)
userImageFrames: [32 --&gt; 1046)
userImagePaging: [16 --&gt; 21)
untypeds:        [1046 --&gt; 1100)
Initial thread domain: 0
Initial thread cnode size: 13
List of untypeds
------------------
Paddr    | Size   | Device
0 | 29 | 1
0x20000000 | 28 | 1
0x30000000 | 27 | 1
0x38000000 | 23 | 1
0x38810000 | 16 | 1
0x38820000 | 17 | 1
0x38840000 | 18 | 1
0x38940000 | 18 | 1
0x38980000 | 19 | 1
0x38a00000 | 21 | 1
0x38c00000 | 22 | 1
0x39000000 | 24 | 1
0x3a000000 | 25 | 1
0x3c000000 | 26 | 1
0xc0000000 | 30 | 1
0x100000000 | 32 | 1
0x200000000 | 33 | 1
0x400000000 | 34 | 1
0x800000000 | 35 | 1
0x1000000000 | 36 | 1
0x2000000000 | 37 | 1
0x4000000000 | 38 | 1
0x8000000000 | 39 | 1
0x40000000 | 16 | 0
0x402492d0 | 4 | 0
0x402492e0 | 5 | 0
0x40249300 | 8 | 0
0x40249400 | 10 | 0
0x40249800 | 11 | 0
0x40640000 | 18 | 0
0x40680000 | 19 | 0
0x40700000 | 20 | 0
0x40800000 | 23 | 0
0x41000000 | 24 | 0
0x42000000 | 25 | 0
0x44000000 | 26 | 0
0x48000000 | 27 | 0
0x50000000 | 28 | 0
0x60000000 | 29 | 0
0x80000000 | 29 | 0
0xa0000000 | 28 | 0
0xb0000000 | 27 | 0
0xb8000000 | 26 | 0
0xbc000000 | 25 | 0
0xbe000000 | 24 | 0
0xbf000000 | 23 | 0
0xbf800000 | 22 | 0
0xbfc00000 | 21 | 0
0xbfe00000 | 20 | 0
0xbff00000 | 19 | 0
0xbffd9800 | 11 | 0
0xbffda000 | 13 | 0
0xbffdc000 | 14 | 0
0xbffe0000 | 17 | 0
Untyped summary
1 untypeds of size 4
1 untypeds of size 5
1 untypeds of size 8
1 untypeds of size 10
2 untypeds of size 11
1 untypeds of size 13
1 untypeds of size 14
2 untypeds of size 16
2 untypeds of size 17
3 untypeds of size 18
3 untypeds of size 19
2 untypeds of size 20
2 untypeds of size 21
2 untypeds of size 22
3 untypeds of size 23
3 untypeds of size 24
3 untypeds of size 25
3 untypeds of size 26
3 untypeds of size 27
3 untypeds of size 28
3 untypeds of size 29
1 untypeds of size 30
1 untypeds of size 32
1 untypeds of size 33
1 untypeds of size 34
1 untypeds of size 35
1 untypeds of size 36
1 untypeds of size 37
1 untypeds of size 38
1 untypeds of size 39
Switching to a safer, bigger stack... 
seL4 Test
=========

vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 2147483648, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 1073741824, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 536870912, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 268435456, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 134217728, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 67108864, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 33554432, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 16777216, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 8388608, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 4194304, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 2097152, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 1048576, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 524288, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 262144, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 131072, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 65536, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 32768, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 16384, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 8192, error 1
vspace_reserve_range_at@vspace.h:738 vspace is NULL
create_reservations@elf.c:245 Failed to make reservation: 0x400000, 876544
elf_reserve_regions_in_vspace@elf.c:438 Failed to create reservations
sel4utils_elf_reserve@elf.c:465 Failed to reserve regions
Starting test suite sel4test
Starting test 0: Test that there are tests
Starting test 1: SYSCALL0000
Starting test 2: SYSCALL0001
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
Starting test 3: SYSCALL0002
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
Starting test 4: SYSCALL0003
Starting test 5: SYSCALL0004
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404c00]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404c00]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404c00]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404c00]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404c00]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404c00]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404c00]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404c00]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404c00]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404c00]: CNodeCap: Illegal Operation attempted.&gt;&gt;
Starting test 6: SYSCALL0005
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
Starting test 7: SYSCALL0006
          Starting test 8: SYSCALL0010
Starting test 9: SYSCALL0011
Starting test 10: SYSCALL0012
Starting test 11: SYSCALL0013
Starting test 12: SYSCALL0014
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
Starting test 13: SYSCALL0015
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404b90]: CNodeCap: Illegal Operation attempted.&gt;&gt;
Starting test 14: SYSCALL0016
Starting test 15: SYSCALL0017
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/54 T0xffffff80bffd9400 "sel4test-driver" @404ce0]: CNodeCap: Illegal Operation attempted.&gt;&gt;
Starting test 16: TIMER0001
Starting test 17: TIMER0002
Starting test 18: BIND0001
Running test BIND0001 (Test that a bound tcb waiting on a sync endpoint receives normal sync ipc and notification notifications.)
Test BIND0001 passed
Starting test 19: BIND0002
Running test BIND0002 (Test that a bound tcb waiting on its bound notification recieves notifications)
Test BIND0002 passed
Starting test 20: BIND0003
Running test BIND0003 (Test IPC ordering 1) bound tcb waits on bound notification 2, true) another tcb sends a message)
Test BIND0003 passed
Starting test 21: BIND0004
Running test BIND0004 (Test IPC ordering 2) bound tcb waits on bound notification 1, true) another tcb sends a message)
Test BIND0004 passed
Starting test 22: CACHEFLUSH0001
Running test CACHEFLUSH0001 (Test a cache maintenance on pages)
Test CACHEFLUSH0001 passed
Starting test 23: CACHEFLUSH0002
Running test CACHEFLUSH0002 (Test a cache maintenance on page directories)
Test CACHEFLUSH0002 passed
Starting test 24: CACHEFLUSH0003
Running test CACHEFLUSH0003 (Test that cache maintenance can be done on large pages)
Test CACHEFLUSH0003 passed
Starting test 25: CACHEFLUSH0004
Running test CACHEFLUSH0004 (Test that mapping a frame uncached doesn't see stale data after retype)
Test CACHEFLUSH0004 passed
Starting test 26: CANCEL_BADGED_SENDS_0001
Running test CANCEL_BADGED_SENDS_0001 (Basic endpoint cancelBadgedSends testing.)
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804065bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #213.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #284.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #337.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #409.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #468.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406be400 "child of: '35'" @411d78]: Attempted to invoke a null cap #534.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bec00 "child of: '35'" @411d78]: Attempted to invoke a null cap #589.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #661.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #722.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #783.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #848.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff2f400 "child of: '35'" @411d78]: Attempted to invoke a null cap #920.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff2fc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #977.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff54400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1050.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff54c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1112.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1181.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1230.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040720400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1303.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040720c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1363.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040745400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1430.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040745c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1497.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1560.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1628.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040790400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1695.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040790c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1748.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b6400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1819.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b6c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1879.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407db400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1952.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407dbc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #2015.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bfe00400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1960.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bfe00c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #2140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bfe26400 "child of: '35'" @411d78]: Attempted to invoke a null cap #2209.&gt;&gt;
Test CANCEL_BADGED_SENDS_0001 passed
Starting test 27: CANCEL_BADGED_SENDS_0002
Running test CANCEL_BADGED_SENDS_0002 (cancelBadgedSends deletes caps)
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1378.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1378.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1318.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1378.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1318.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1380.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1378.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1318.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1380.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1569.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1378.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1318.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1380.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1569.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076c400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1634.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1378.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1318.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1380.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1569.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076c400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1634.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076cc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1698.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1378.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1318.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1380.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1569.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076c400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1634.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076cc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1698.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1752.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1378.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1318.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1380.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1569.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076c400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1634.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076cc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1698.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1752.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1815.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1378.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1318.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1380.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1569.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076c400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1634.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076cc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1698.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1752.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1815.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b7400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1880.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1378.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1318.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1380.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1569.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076c400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1634.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076cc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1698.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1752.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1815.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b7400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1880.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b7c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1936.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1378.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1318.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1380.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1569.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076c400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1634.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076cc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1698.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1752.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1815.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b7400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1880.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b7c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1936.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407dd400 "child of: '35'" @411d78]: Attempted to invoke a null cap #2002.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1378.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1318.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1380.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1569.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076c400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1634.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076cc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1698.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1752.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1815.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b7400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1880.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b7c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1936.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407dd400 "child of: '35'" @411d78]: Attempted to invoke a null cap #2002.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407ddc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #2069.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1378.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1318.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1380.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1569.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076c400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1634.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076cc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1698.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1752.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1815.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b7400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1880.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b7c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1936.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407dd400 "child of: '35'" @411d78]: Attempted to invoke a null cap #2002.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407ddc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #2069.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bfe03400 "child of: '35'" @411d78]: Attempted to invoke a null cap #2117.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1378.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1318.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1380.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1569.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076c400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1634.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076cc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1698.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1752.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1815.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b7400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1880.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b7c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1936.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407dd400 "child of: '35'" @411d78]: Attempted to invoke a null cap #2002.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407ddc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #2069.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bfe03400 "child of: '35'" @411d78]: Attempted to invoke a null cap #2117.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bfe03c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #2183.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1378.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1318.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1380.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1569.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076c400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1634.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076cc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1698.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1752.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1815.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b7400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1880.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b7c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1936.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407dd400 "child of: '35'" @411d78]: Attempted to invoke a null cap #2002.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407ddc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #2069.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bfe03400 "child of: '35'" @411d78]: Attempted to invoke a null cap #2117.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bfe03c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #2183.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bfe28400 "child of: '35'" @411d78]: Attempted to invoke a null cap #2250.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670400 "child of: '35'" @411d78]: Attempted to invoke a null cap #286.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040670c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #338.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696400 "child of: '35'" @411d78]: Attempted to invoke a null cap #405.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040696c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #466.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bf400 "child of: '35'" @411d78]: Attempted to invoke a null cap #521.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406bfc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #579.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4400 "child of: '35'" @411d78]: Attempted to invoke a null cap #646.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80406e4c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #708.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0a400 "child of: '35'" @411d78]: Attempted to invoke a null cap #762.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff0ac00 "child of: '35'" @411d78]: Attempted to invoke a null cap #827.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30400 "child of: '35'" @411d78]: Attempted to invoke a null cap #892.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff30c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #948.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1012.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff55c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1079.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7b400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1140.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bff7bc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1198.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1378.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040721c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1318.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1380.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040746c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1569.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076c400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1634.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff804076cc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1698.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1752.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040792c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1815.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b7400 "child of: '35'" @411d78]: Attempted to invoke a null cap #1880.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407b7c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #1936.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407dd400 "child of: '35'" @411d78]: Attempted to invoke a null cap #2002.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80407ddc00 "child of: '35'" @411d78]: Attempted to invoke a null cap #2069.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bfe03400 "child of: '35'" @411d78]: Attempted to invoke a null cap #2117.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bfe03c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #2183.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bfe28400 "child of: '35'" @411d78]: Attempted to invoke a null cap #2250.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff80bfe28c00 "child of: '35'" @411d78]: Attempted to invoke a null cap #2313.&gt;&gt;
Test CANCEL_BADGED_SENDS_0002 passed
Starting test 28: CNODEOP0001
Running test CNODEOP0001 (Basic seL4_CNode_Copy() testing)
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
Test CNODEOP0001 passed
Starting test 29: CNODEOP0002
Running test CNODEOP0002 (Basic seL4_CNode_Delete() testing)
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
Test CNODEOP0002 passed
Starting test 30: CNODEOP0003
Running test CNODEOP0003 (Basic seL4_CNode_Mint() testing)
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
Test CNODEOP0003 passed
Starting test 31: CNODEOP0004
Running test CNODEOP0004 (Basic seL4_CNode_Move() testing)
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
Test CNODEOP0004 passed
Starting test 32: CNODEOP0005
Running test CNODEOP0005 (Basic seL4_CNode_Mutate() testing)
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
Test CNODEOP0005 passed
Starting test 33: CNODEOP0006
Running test CNODEOP0006 (Basic seL4_CNode_CancelBadgedSends() testing)
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/224 T0xffffff80bffd9c00 "35" @4007c0]: CNode CancelBadgedSends: Target cap invalid.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
Test CNODEOP0006 passed
Starting test 34: CNODEOP0007
Running test CNODEOP0007 (Basic seL4_CNode_Revoke() testing)
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
Test CNODEOP0007 passed
Starting test 35: CNODEOP0008
Running test CNODEOP0008 (Basic seL4_CNode_Rotate() testing)
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/266 T0xffffff80bffd9c00 "35" @4007c0]: CNode Rotate: Pivot slot the same as source or dest slot.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
Test CNODEOP0008 passed
Starting test 36: CNODEOP0009
Running test CNODEOP0009 (Basic seL4_CNode_SaveCaller() testing)
&lt;&lt;seL4(CPU 0) [invokeCNodeSaveCaller/374 T0xffffff80bffd9c00 "35" @4007c0]: CNode SaveCaller: Reply cap not present.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/209 T0xffffff80bffd9c00 "35" @4007c0]: CNode SaveCaller: Destination slot not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
Test CNODEOP0009 passed
Starting test 37: CSPACE0001
Running test CSPACE0001 (Test full cspace resolution)
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #0.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #1.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #2.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #3.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #4.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #5.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #7.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #8.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #9.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #10.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #11.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #12.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #13.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #14.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #15.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #16.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #17.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #18.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #19.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #20.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #21.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #22.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #23.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #24.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #25.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #26.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #27.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #28.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #29.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #30.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #31.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #32.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #33.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #34.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #35.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #36.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #37.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #38.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #39.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #40.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #41.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #42.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #43.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #44.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #45.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #46.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #47.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #48.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #49.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #50.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #51.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #52.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #53.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #54.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #55.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #56.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #57.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #58.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #59.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #60.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #61.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #62.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #63.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236517204.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236517207.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236517201.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236517213.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236517189.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236517237.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236517141.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236517333.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236516949.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236517717.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236516181.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236519253.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236513109.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236525397.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236500821.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236549973.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236451669.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236648277.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691236255061.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691237041493.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691235468629.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691238614357.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691232322901.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691244905813.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691219739989.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691270071637.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691169408341.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691370734933.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914690968081749.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914691773388117.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914690162775381.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914693384000853.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914686941549909.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914699826451797.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914674056648021.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914725596255573.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914622517040469.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914828675470677.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148914416358610261.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148915240992331093.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148913591724889429.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148916890259772757.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148910293190006101.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148923487329539413.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148897099050472789.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148949875608606037.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148844322492339541.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6149055428724872533.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6148633216259806549.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6149477641189938517.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6147788791329674581.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6151166491050202453.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6144411091609146709.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6157921890491258197.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6130900292727035221.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6184943488255481173.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6076857097198589269.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6293029879312373077.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #5860684315084805461.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #6725375443539940693.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #4995993186629670229.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #8454757700450211157.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #1537228672809129301.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/646 T0xffffff8040661c00 "child of: '35'" @40f7e4]: Attempted to invoke a null cap #15372286728091293013.&gt;&gt;
Test CSPACE0001 passed
Starting test 38: DOMAINS0001
Running test DOMAINS0001 (Change domain successfully())
Test DOMAINS0001 passed
Starting test 39: DOMAINS0002
Running test DOMAINS0002 (Try non-existant domain())
&lt;&lt;seL4(CPU 0) [decodeDomainInvocation/1582 T0xffffff80bffd9c00 "35" @4110dc]: Domain Configure: invalid domain (11 &gt;= 1).&gt;&gt;
Test DOMAINS0002 passed
Starting test 40: DOMAINS0003
Running test DOMAINS0003 (Invoke non-domain cap())
&lt;&lt;seL4(CPU 0) [decodeTCBInvocation/886 T0xffffff80bffd9c00 "35" @4110dc]: TCB: Illegal operation.&gt;&gt;
Test DOMAINS0003 passed
Starting test 41: DOMAINS0004
Running test DOMAINS0004 (Run threads in domains())
Test DOMAINS0004 passed
Starting test 42: FPU0000
Running test FPU0000 (Ensure that simple FPU operations work)
Test FPU0000 passed
Starting test 43: FPU0001
Running test FPU0001 (Ensure multiple threads can use FPU simultaneously)
Test FPU0001 passed
Starting test 44: FRAMEDIPC0001
Running test FRAMEDIPC0001 (Test that we cannot create a thread with an IPC buffer that is a frame)
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @41a64c]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [checkValidIPCBuffer/640 T0xffffff80bffd9c00 "35" @41a64c]: IPC Buffer is an invalid cap.&gt;&gt;
Test FRAMEDIPC0001 passed
Starting test 45: FRAMEDIPC0002
Running test FRAMEDIPC0002 (Test that we cannot switch a threads IPC buffer to a device frame)
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @41a64c]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [checkValidIPCBuffer/640 T0xffffff80bffd9c00 "35" @41a64c]: IPC Buffer is an invalid cap.&gt;&gt;
Test FRAMEDIPC0002 passed
Starting test 46: FRAMEDIPC0003
Running test FRAMEDIPC0003 (Test that deleting a frame cap unmaps the frame)
Test FRAMEDIPC0003 passed
Starting test 47: FRAMEEXPORTS0001
Running test FRAMEEXPORTS0001 (Test that we can access all exported frames)
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 2097152, error 1
vka_alloc_object_at_maybe_dev@object.h:57 Failed to allocate object of size 4096, error 1
Test FRAMEEXPORTS0001 passed
Starting test 48: FRAMEXN0001
Running test FRAMEXN0001 (Test that we can map a small frame XN)
Test FRAMEXN0001 passed
Starting test 49: FRAMEXN0002
Running test FRAMEXN0002 (Test that we can map a large frame XN)
Test FRAMEXN0002 passed
Starting test 50: IPC0001
Running test IPC0001 (Test SMP seL4_Send + seL4_Recv)
Test IPC0001 passed
Starting test 51: IPC0002
Running test IPC0002 (Test SMP seL4_Call + seL4_ReplyRecv)
Test IPC0002 passed
Starting test 52: IPC0003
Running test IPC0003 (Test SMP seL4_Send + seL4_Reply + seL4_Recv)
Test IPC0003 passed
Starting test 53: IPC0004
Running test IPC0004 (Test seL4_NBSend + seL4_Recv)
Test IPC0004 passed
Starting test 54: IPC0010
Running test IPC0010 (Test suspending an IPC mid-Call())
Test IPC0010 passed
Starting test 55: IPC1001
Running test IPC1001 (Test SMP inter-AS seL4_Send + seL4_Recv)
Test IPC1001 passed
Starting test 56: IPC1002
Running test IPC1002 (Test SMP inter-AS seL4_Call + seL4_ReplyRecv)
Test IPC1002 passed
Starting test 57: IPC1003
Running test IPC1003 (Test SMP inter-AS seL4_Send + seL4_Reply + seL4_Recv)
Test IPC1003 passed
Starting test 58: IPC1004
Running test IPC1004 (Test inter-AS seL4_NBSend + seL4_Recv)
Test IPC1004 passed
Starting test 59: IPCRIGHTS0001
Running test IPCRIGHTS0001 (seL4_Send needs write)
&lt;&lt;seL4(CPU 0) [decodeInvocation/659 T0xffffff80bffd9c00 "35" @4267b4]: Attempted to invoke a read-only endpoint cap #214.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeInvocation/659 T0xffffff80bffd9c00 "35" @4267b4]: Attempted to invoke a read-only endpoint cap #214.&gt;&gt;
Test IPCRIGHTS0001 passed
Starting test 60: IPCRIGHTS0002
Running test IPCRIGHTS0002 (seL4_Recv needs read)
Test IPCRIGHTS0002 passed
Starting test 61: IPCRIGHTS0003
Running test IPCRIGHTS0003 (seL4_Send with caps needs grant)
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff804065bc00 "child of: '35'" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff804065bc00 "child of: '35'" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
Test IPCRIGHTS0003 passed
Starting test 62: IPCRIGHTS0004
Running test IPCRIGHTS0004 (seL4_Call needs grant or grant-reply)
&lt;&lt;seL4(CPU 0) [invokeCNodeSaveCaller/374 T0xffffff80bffd9c00 "35" @4007c0]: CNode SaveCaller: Reply cap not present.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [invokeCNodeSaveCaller/374 T0xffffff80bffd9c00 "35" @4007c0]: CNode SaveCaller: Reply cap not present.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [invokeCNodeSaveCaller/374 T0xffffff80bffd9c00 "35" @4007c0]: CNode SaveCaller: Reply cap not present.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [invokeCNodeSaveCaller/374 T0xffffff80bffd9c00 "35" @4007c0]: CNode SaveCaller: Reply cap not present.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [invokeCNodeSaveCaller/374 T0xffffff80bffd9c00 "35" @4007c0]: CNode SaveCaller: Reply cap not present.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [invokeCNodeSaveCaller/374 T0xffffff80bffd9c00 "35" @4007c0]: CNode SaveCaller: Reply cap not present.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
Test IPCRIGHTS0004 passed
Starting test 63: IPCRIGHTS0005
Running test IPCRIGHTS0005 (seL4_Reply grant depends of the grant of previous seL4_Recv)
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff804065bc00 "child of: '35'" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff804065bc00 "child of: '35'" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff804065bc00 "child of: '35'" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/95 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Destination not empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff804065bc00 "child of: '35'" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff804065bc00 "child of: '35'" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff804065bc00 "child of: '35'" @4007c0]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
Test IPCRIGHTS0005 passed
Starting test 64: NBWAIT0001
Running test NBWAIT0001 (Test seL4_NBRecv)
Test NBWAIT0001 passed
Starting test 65: PAGEFAULT0001
Running test PAGEFAULT0001 (Test read page fault)
Test PAGEFAULT0001 passed
Starting test 66: PAGEFAULT0002
Running test PAGEFAULT0002 (Test write page fault)
Test PAGEFAULT0002 passed
Starting test 67: PAGEFAULT0003
Running test PAGEFAULT0003 (Test execute page fault)
Test PAGEFAULT0003 passed
Starting test 68: PAGEFAULT0004
Running test PAGEFAULT0004 (Test unknown system call)
Test PAGEFAULT0004 passed
Starting test 69: PAGEFAULT0005
Running test PAGEFAULT0005 (Test undefined instruction)
Test PAGEFAULT0005 passed
Starting test 70: PAGEFAULT1001
Running test PAGEFAULT1001 (Test read page fault (inter-AS))
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

Test PAGEFAULT1001 passed
Starting test 71: PAGEFAULT1002
Running test PAGEFAULT1002 (Test write page fault (inter-AS))
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

Test PAGEFAULT1002 passed
Starting test 72: PAGEFAULT1003
Running test PAGEFAULT1003 (Test execute page fault (inter-AS))
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

Test PAGEFAULT1003 passed
Starting test 73: PAGEFAULT1004
Running test PAGEFAULT1004 (Test unknown system call (inter-AS))
&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

&lt;&lt;seL4(CPU 0) [decodeCNodeInvocation/107 T0xffffff80bffd9c00 "35" @464da4]: CNode Copy/Mint/Move/Mutate: Source slot invalid or empty.&gt;&gt;
sel4utils_copy_path_to_process@process.c:131 Failed to copy cap

Test PAGEFAULT1004 passed
Starting test 74: PREEMPT_REVOKE
Running test PREEMPT_REVOKE (Test preemption path in revoke)
Test PREEMPT_REVOKE passed
Starting test 75: PT0001
Running test PT0001 (Fun with page tables on ARM)
&lt;&lt;seL4(CPU 0) [decodeARMFrameInvocation/1570 T0xffffff80bffd9c00 "35" @42e97c]: ARMPageMap: Attempting to map frame into multiple addresses&gt;&gt;
clear_entries_mid@vspace_internal.h:169 Cannot clear reserved entries mid level
Test PT0001 passed
Starting test 76: REGRESSIONS0001
Running test REGRESSIONS0001 (Ensure WriteRegisters functions correctly)
Test REGRESSIONS0001 passed
Starting test 77: REGRESSIONS0002
Running test REGRESSIONS0002 (Test the load-exclusive monitor is cleared on context switch)
Test REGRESSIONS0002 passed
Starting test 78: RETYPE0000
Running test RETYPE0000 (Retype test)
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/146 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Number of requested objects (0) too small or large.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/154 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Requested destination window overruns size of node.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/138 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Destination node offset #4 too large.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/166 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Slot #0 in destination window non-empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/166 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Slot #1 in destination window non-empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/166 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Slot #2 in destination window non-empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/166 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Slot #3 in destination window non-empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/146 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Number of requested objects (18446744071562067968) too small or large.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/154 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Requested destination window overruns size of node.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/166 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Slot #0 in destination window non-empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/166 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Slot #1 in destination window non-empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/166 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Slot #2 in destination window non-empty.&gt;&gt;
Test RETYPE0000 passed
Starting test 79: RETYPE0001
Running test RETYPE0001 (Incremental retype test)
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/81 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Invalid object size.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/81 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Invalid object size.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/81 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Invalid object size.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/81 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Invalid object size.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/81 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Invalid object size.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/81 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Invalid object size.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 140737488355328 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 70368744177664 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 35184372088832 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 17592186044416 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 8796093022208 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 4398046511104 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 2199023255552 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 1099511627776 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 549755813888 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 274877906944 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 137438953472 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 68719476736 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 34359738368 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 17179869184 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 8589934592 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 4294967296 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 2147483648 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 1073741824 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 536870912 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 268435456 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 134217728 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 67108864 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 33554432 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 16777216 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 8388608 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 4194304 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 2097152 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 1048576 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 524288 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 262144 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 131072 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 65536 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 32768 bytes needed, 8192 bytes available).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 16384 bytes needed, 8192 bytes available).&gt;&gt;
Test RETYPE0001 passed
Starting test 80: RETYPE0002
Running test RETYPE0002 (Incremental retype test #2)
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/146 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Number of requested objects (1048576) too small or large.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/166 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Slot #108 in destination window non-empty.&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeUntypedInvocation/205 T0xffffff80bffd9c00 "35" @41df28]: Untyped Retype: Insufficient memory (1 * 4096 bytes needed, 0 bytes available).&gt;&gt;
Test RETYPE0002 passed
Starting test 81: SCHED0000
Running test SCHED0000 (Test suspending and resuming a thread (flaky))
Test SCHED0000 passed
Starting test 82: SCHED0002
Running test SCHED0002 (Test resuming ourselves)
Test SCHED0002 passed
Starting test 83: SCHED0003
Running test SCHED0003 (Test TCB suspend/resume)
Test SCHED0003 passed
Starting test 84: SCHED0004
Running test SCHED0004 (Test threads at all priorities)
Test SCHED0004 passed
Starting test 85: SCHED0005
Running test SCHED0005 (Test set priority)
&lt;&lt;seL4(CPU 0) [decodeSetPriority/1183 T0xffffff8040670400 "child of: '35'" @43ce88]: TCB SetPriority: Requested priority 253 too high (max 251).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeSetPriority/1183 T0xffffff804065bc00 "child of: '35'" @43ce88]: TCB SetPriority: Requested priority 250 too high (max 249).&gt;&gt;
&lt;&lt;seL4(CPU 0) [decodeSetMCPriority/1227 T0xffffff804065bc00 "child of: '35'" @43ce88]: TCB SetMCPriority: Requested maximum controlled priority 253 too high (max 249).&gt;&gt;
Test SCHED0005 passed
Starting test 86: SCHED0006
Running test SCHED0006 (Test IPC priorities for Send)
Test SCHED0006 passed
Starting test 87: SCHED0020
Running test SCHED0020 (test set prio to a higher prio runs higher prio thread)
Test SCHED0020 passed
Starting test 88: SCHED0021
Running test SCHED0021 (Test for pre-emption during running of many threads with equal prio)
Test SCHED0021 passed
Starting test 89: SERSERV_CLIENT_001
Running test SERSERV_CLIENT_001 (Connect from client threads)
Test SERSERV_CLIENT_001 passed
Starting test 90: SERSERV_CLIENT_002
Running test SERSERV_CLIENT_002 (Printf from client threads)
Hello, world!
Test SERSERV_CLIENT_002 passed
Starting test 91: SERSERV_CLIENT_003
Running test SERSERV_CLIENT_003 (Write from client threads)
Hello, world!
Test SERSERV_CLIENT_003 passed
Starting test 92: SERSERV_CLIENT_004
Running test SERSERV_CLIENT_004 (Printf, then write, then reset connection, and Printf, then write again, from client threads)
Hello, world!
Hello, world!
Hello, world!
Hello, world!
Test SERSERV_CLIENT_004 passed
Starting test 93: SERSERV_CLIENT_005
Running test SERSERV_CLIENT_005 (Connect, then disconnect from server on all threads, then kill server from parent thread)
Test SERSERV_CLIENT_005 passed
Starting test 94: SERSERV_CLI_PROC_001
Running test SERSERV_CLI_PROC_001 (Connect to server from a client in another VSpace and CSpace)
Test SERSERV_CLI_PROC_001 passed
Starting test 95: SERSERV_CLI_PROC_002
Running test SERSERV_CLI_PROC_002 (Connect to server and printf(, true), from a client in another VSpace and CSpace)
Hello, world!
Test SERSERV_CLI_PROC_002 passed
Starting test 96: SERSERV_CLI_PROC_003
Running test SERSERV_CLI_PROC_003 (Connect to server and write(, true), from a client in another VSpace and CSpace)
Hello, world!
Test SERSERV_CLI_PROC_003 passed
Starting test 97: SERSERV_CLI_PROC_004
Running test SERSERV_CLI_PROC_004 (Connect to server, printf(), write(, true), then disconnect, then reconnect and printf() and write() again, from clients in other VSpaces and CSpaces)
Hello, world!
Hello, world!
Hello, world!
Hello, world!
Test SERSERV_CLI_PROC_004 passed
Starting test 98: SERSERV_CLI_PROC_005
Running test SERSERV_CLI_PROC_005 (Connect to server then disconnect on all clients (in different VSpace/CSpace containers), and finally kill the server from the parent)
Test SERSERV_CLI_PROC_005 passed
Starting test 99: SERSERV_PARENT_001
Running test SERSERV_PARENT_001 (Serial server spawn test)
Test SERSERV_PARENT_001 passed
Starting test 100: SERSERV_PARENT_002
Running test SERSERV_PARENT_002 (Test connecting to the server from a parent thread)
Test SERSERV_PARENT_002 passed
Starting test 101: SERSERV_PARENT_003
Running test SERSERV_PARENT_003 (Printf() from a connected parent thread)
Hello, world!
Test SERSERV_PARENT_003 passed
Starting test 102: SERSERV_PARENT_004
Running test SERSERV_PARENT_004 (Write() from a connected parent thread)
Hello, world!
Test SERSERV_PARENT_004 passed
Starting test 103: SERSERV_PARENT_005
Running test SERSERV_PARENT_005 (Test printf() and write() from a parent thread when after a connection reset (disconnect/reconnect))
Hello, world!
Hello, world!
Hello, world!
Hello, world!
Test SERSERV_PARENT_005 passed
Starting test 104: SERSERV_PARENT_006
Running test SERSERV_PARENT_006 (Kill the Server from the Parent thread)
Test SERSERV_PARENT_006 passed
Starting test 105: SERSERV_PARENT_007
Running test SERSERV_PARENT_007 (Test a series of unexpected input values to spawn_thread)
Test SERSERV_PARENT_007 passed
Starting test 106: SERSERV_PARENT_008
Running test SERSERV_PARENT_008 (Test a series of unexpected input values to connect())
Test SERSERV_PARENT_008 passed
Starting test 107: SERSERV_PARENT_009
Running test SERSERV_PARENT_009 (Test a series of unexpected input values to printf())
serial_server_printf@clientapi.c:178 Serserv Client: printf: NULL passed for required arguments.
        Is connection handle valid?
serial_server_printf@clientapi.c:178 Serserv Client: printf: NULL passed for required arguments.
        Is connection handle valid?
Test SERSERV_PARENT_009 passed
Starting test 108: SERSERV_PARENT_010
Running test SERSERV_PARENT_010 (Test a series of unexpected input values to write())
serial_server_write@clientapi.c:221 Serserv Client: printf: NULL passed for required arguments.
        Is connection handle valid?
serial_server_write@clientapi.c:221 Serserv Client: printf: NULL passed for required arguments.
        Is connection handle valid?
Test SERSERV_PARENT_010 passed
Starting test 109: SYNC001
Running test SYNC001 (libsel4sync Test binary semaphores)
Test SYNC001 passed
Starting test 110: SYNC002
Running test SYNC002 (libsel4sync Test semaphores)
Test SYNC002 passed
Starting test 111: SYNC003
Running test SYNC003 (libsel4sync Test monitors)
Test SYNC003 passed
Starting test 112: SYNC004
Running test SYNC004 (libsel4sync Test monitors - broadcast)
Test SYNC004 passed
Starting test 113: THREADS0004
Running test THREADS0004 (seL4_TCB_Configure with a NULL CSpace should fail)
&lt;&lt;seL4(CPU 0) [decodeTCBConfigure/1118 T0xffffff80bffd9c00 "35" @44dc44]: TCB Configure: CSpace cap is invalid.&gt;&gt;
Test THREADS0004 passed
Starting test 114: THREADS0005
Running test THREADS0005 (seL4_TCB_SetSpace with a NULL CSpace should fail)
&lt;&lt;seL4(CPU 0) [decodeSetSpace/1514 T0xffffff80bffd9c00 "35" @44dc44]: TCB SetSpace: Invalid CNode cap.&gt;&gt;
Test THREADS0005 passed
Starting test 115: TLS0001
Running test TLS0001 (Test root thread accessing __thread variables)
Test TLS0001 passed
Starting test 116: TLS0002
Running test TLS0002 (Test multiple threads using __thread variables)
Test TLS0002 passed
Starting test 117: TLS0006
Running test TLS0006 (sel4utils_thread with distinct TLS should not interfere)
Test TLS0006 passed
Starting test 118: TRIVIAL0000
Running test TRIVIAL0000 (Ensure the test framework functions)
Test TRIVIAL0000 passed
Starting test 119: TRIVIAL0001
Running test TRIVIAL0001 (Ensure the allocator works)
Test TRIVIAL0001 passed
Starting test 120: TRIVIAL0002
Running test TRIVIAL0002 (Ensure the allocator works more than once)
Test TRIVIAL0002 passed
Starting test 121: VSPACE0000
Running test VSPACE0000 (Test threads in different cspace/vspace)
Test VSPACE0000 passed
Starting test 122: VSPACE0001
Running test VSPACE0001 (Test unmapping a page after deleting the PD)
Test VSPACE0001 passed
Starting test 123: VSPACE0002
Running test VSPACE0002 (Test create ASID pool)
Test VSPACE0002 passed
Starting test 124: VSPACE0003
Running test VSPACE0003 (Test create multiple ASID pools)
Test VSPACE0003 passed
Starting test 125: VSPACE0004
Running test VSPACE0004 (Test running out of ASID pools)
Test VSPACE0004 passed
Starting test 126: VSPACE0005
Running test VSPACE0005 (Test overassigning ASID pool)
Test VSPACE0005 passed
Starting test 127: VSPACE0006
Running test VSPACE0006 (Test touching all available ASID pools)
Test VSPACE0006 passed
Starting test 129: Test all tests ran
Test suite passed. 129 tests passed. 42 tests disabled.
All is well in the universe
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="camkes-adder"><a class="header" href="#camkes-adder">CAmkES adder</a></h1>
<p>The purpose of this example is to confirm that the CAmkES environment is configured correctly. As usual, this assumes that the user is already running the CAmkES Docker container within the <a href="first_boot/../install_and_configure/build_environment_setup.html">build environment</a>, where we can create a directory and clone the code and dependencies.</p>
<h2 id="getting-the-code-1"><a class="header" href="#getting-the-code-1">Getting the code</a></h2>
<pre><code>git clone git@github.com:sel4devkit/sel4devkit-maaxboard-camkes-first-boot-adder.git
</code></pre>
<h2 id="building-1"><a class="header" href="#building-1">Building</a></h2>
<p>The CAmkES adder example uses the make build system therefore make needs to be run in the repository:</p>
<pre><code>cd sel4devkit-maaxboard-camkes-first-boot-adder
</code></pre>
<pre><code>make get
make all
</code></pre>
<p>On completion of the compilation, the resulting executable is available at <code>/host/sel4devkit-maaxboard-camkes-first-boot-adder/out/program.img</code> on the build environment, or available at <code>/&lt;host_directory&gt;/sel4devkit-maaxboard-camkes-first-boot-adder/out/program.img</code> on the host machine, where <code>/&lt;host_directory&gt;</code> was the directory on the host mapped to the build environment.</p>
<h2 id="example-output-1"><a class="header" href="#example-output-1">Example output</a></h2>
<p>The example output when executed on the target (as described in <a href="first_boot/bootloader.html">bootloader</a>) is demonstrated below:</p>
<pre><code>u-boot=&gt; bootelf 0x50000000
## Starting application at 0x4085e000 ...

ELF-loader started on CPU: ARM Ltd. Cortex-A53 r0p4
  paddr=[4085e000..40b6d137]
No DTB passed in from boot loader.
Looking for DTB in CPIO archive...found at 409a0a08.
Loaded DTB from 409a0a08.
   paddr=[4023f000..40249fff]
ELF-loading image 'kernel' to 40000000
  paddr=[40000000..4023efff]
  vaddr=[ffffff8040000000..ffffff804023efff]
  virt_entry=ffffff8040000000
ELF-loading image 'capdl-loader' to 4024a000
  paddr=[4024a000..40462fff]
  vaddr=[400000..618fff]
  virt_entry=408e98
Enabling MMU and paging
Jumping to kernel-image entry point...

Warning:  gpt_cntfrq 8333333, expected 8000000
Bootstrapping kernel
available phys memory regions: 1
  [40000000..c0000000]
reserved virt address space regions: 3
  [ffffff8040000000..ffffff804023f000]
  [ffffff804023f000..ffffff80402492c7]
  [ffffff804024a000..ffffff8040463000]
Booting all finished, dropped to user space
client: what's the answer to 342 + 74 + 283 + 37 + 534 ?
adder: Adding 342
adder: Adding 74
adder: Adding 283
adder: Adding 37
adder: Adding 534
client: result was 1270
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="microkit-hello-world"><a class="header" href="#microkit-hello-world">Microkit Hello World</a></h1>
<p>The purpose of this example is to confirm that the Microkit environment is configured correctly. As usual, this assumes that the user is already running the Microkit Docker container within the <a href="first_boot/../../install_and_configure/build_environment_setup.html">build environment</a>, where we can create a directory and clone the code and dependencies.</p>
<h2 id="getting-the-code-2"><a class="header" href="#getting-the-code-2">Getting the code</a></h2>
<pre><code>git clone git@github.com:sel4devkit/sel4devkit-maaxboard-microkit-first-boot-hello-world.git
</code></pre>
<h2 id="building-2"><a class="header" href="#building-2">Building</a></h2>
<p>The Microkit hello world example uses the make build system therefore make needs to be run in the repository:</p>
<pre><code>cd sel4devkit-maaxboard-microkit-first-boot-hello-world
</code></pre>
<pre><code>make get
make all
</code></pre>
<p>On completion of the compilation, the resulting executable is available at <code>/host/sel4devkit-maaxboard-microkit-first-boot-hello-world/out/program.img</code> on the build environment, or available at <code>/&lt;host_directory&gt;/sel4devkit-maaxboard-microkit-first-boot-hello-world/out/program.img</code> on the host machine, where <code>/&lt;host_directory&gt;</code> was the directory on the host mapped to the build environment.</p>
<h2 id="example-output-2"><a class="header" href="#example-output-2">Example output</a></h2>
<p>The example output when executed on the target (as described in <a href="first_boot/bootloader.html">bootloader</a>) is demonstrated below:</p>
<pre><code>u-boot=&gt; go 0x50000000
## Starting application at 0x50000000 ...
LDR|INFO: altloader for seL4 starting
LDR|INFO: Flags:                0x0000000000000001
             seL4 configured as hypervisor
LDR|INFO: Kernel:      entry:   0x0000008040000000
LDR|INFO: Root server: physmem: 0x0000000040270000 -- 0x0000000040277000
LDR|INFO:              virtmem: 0x000000008a000000 -- 0x000000008a007000
LDR|INFO:              entry  : 0x000000008a000000
LDR|INFO: region: 0x00000000   addr: 0x0000000040000000   size: 0x000000000024c000   offset: 0x0000000000000000   type: 0x01
LDR|INFO: region: 0x00000001   addr: 0x0000000040270000   size: 0x0000000000006b40   offset: 0x000000000024c000   type: 0x01
LDR|INFO: region: 0x00000002   addr: 0x000000004024c000   size: 0x00000000000011a8   offset: 0x0000000000252b40   type: 0x01
LDR|INFO: region: 0x00000003   addr: 0x000000004024e000   size: 0x000000000000046c   offset: 0x0000000000253ce8   type: 0x01
LDR|INFO: region: 0x00000004   addr: 0x000000004024f000   size: 0x0000000000020070   offset: 0x0000000000254154   type: 0x01
LDR|INFO: copying region 0x00000000
LDR|INFO: copying region 0x00000001
LDR|INFO: copying region 0x00000002
LDR|INFO: copying region 0x00000003
LDR|INFO: copying region 0x00000004
LDR|INFO: CurrentEL=EL2
LDR|INFO: Resetting CNTVOFF
LDR|INFO: enabling MMU
LDR|INFO: jumping to kernel
Warning:  gpt_cntfrq 8333333, expected 8000000
Bootstrapping kernel
available phys memory regions: 1
  [40000000..c0000000]
reserved virt address space regions: 3
  [8040000000..804024c000]
  [804024c000..8040270000]
  [8040270000..8040277000]
Booting all finished, dropped to user space
MON|INFO: Microkit Bootstrap
MON|INFO: bootinfo untyped list matches expected list
MON|INFO: Number of bootstrap invocations: 0x00000009
MON|INFO: Number of system invocations:    0x0000003f
MON|INFO: completed bootstrap invocations
MON|INFO: completed system invocations
hello, world
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="activities"><a class="header" href="#activities">Activities</a></h1>
<p>These techical activities provide a range of examples which seek to
demonstrate how to develop with seL4. For each activity our development
process is discussed which intends to shed light on the our experience with
writing programs in seL4. This aims to show the lessons we learnt along the
way and act as inspiration for others wishing to embark on writing their own
systems and programs with seL4.</p>
<ul>
<li><a href="activity/../activity/microkit_memory_probe/main.html">Microkit Memory Probe</a>: Simple Microkit program illustrating memory access.</li>
<li><a href="activity/../activity/device_drivers/main.html">Use U-Boot Device Drivers</a>: Guidance on adding device drivers to seL4.</li>
<li><a href="activity/../activity/picoserver_uboot/main.html">Test application: picoserver_uboot</a>: Picoserver U-Boot test application.</li>
<li><a href="activity/../activity/new_platform/main.html">Porting Device Drivers to a New Platform</a>: Guidance for porting the U-Boot driver library to a new platform.</li>
<li><a href="activity/../activity/new_driver/main.html">Adding New U-Boot Device Driver</a>: Guidance for adding a new driver to the U-Boot driver library</li>
<li><a href="activity/../activity/guide_to_porting_seL4/main.html">Guide to Porting seL4</a>: Guidance for porting seL4 to a new platform.</li>
<li><a href="activity/../activity/spi_bus_bmp280_pressure_sensor/main.html">SPI Bus BMP280 Pressure Sensor</a>: Testing the Serial Peripheral Interface (SPI) driver with a pressure sensor.</li>
<li><a href="activity/../activity/camkes_case_study_application/main.html">CAmkES Case Study Application</a>: Demonstrating device drivers being used within a larger application nominally a keyboard-based encryption device.</li>
<li><a href="activity/../activity/microkit_case_study_application/main.html">Microkit Case Study Application</a>: Porting of the case study application to Microkit.</li>
<li><a href="activity/../activity/microkit_usb_driver/main.html">Microkit USB Driver</a>: A XHCI USB driver with support for Keyboard, Mouse, Resistive Touch Screen, USB Hub and Mass Storage Devices.</li>
<li><a href="activity/../activity/microkit_hdmi_driver/main.html">Microkit HDMI Driver</a>: A basic HDMI Driver capable of displaying static images and simple moving images.</li>
<li><a href="activity/../activity/microkit_vmm_single_linux_guest/main.html">Microkit Single Linux VMM</a>: Loads up a single Linux virtual machine with serial I/O.</li>
<li><a href="activity/../activity/microkit_vmm_dual_linux_guest_tty_multiplex/main.html">Microkit Dual Linux VMM with TTY Multiplexing</a>: Loads up two Linux virtual machines with serial I/O and multiplexing for each virtual machine.</li>
<li><a href="activity/../activity/microkit_vmm_dual_linux_guest_usb_routing/main.html">Microkit Dual Linux VMM with USB Routing</a>: An investigation into communication between virtual machines.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="microkit-memory-probe"><a class="header" href="#microkit-memory-probe">Microkit Memory Probe</a></h1>
<p>Development atop the seL4 Microkernel, particularly where interacting with
devices, is fundamentally low-level. In this context, for basic orientation
and investigations, it can be helpful to inspect specific portions of memory.
More generally, framing such a facility in terms of Microkit, provides an
example which is slightly more complex than "hello world", yet still
fundamentally self-contained.</p>
<p>The repository for this activity is located <a href="https://github.com/sel4devkit/sel4devkit-maaxboard-microkit-memory-probe">here</a>.</p>
<h2 id="design"><a class="header" href="#design">Design</a></h2>
<p>As Microkit builds a static program, the selection of the memory to inspect,
in terms of a starting address and size, is provided at build time. The entire
program is presented inside a single Protection Domain (PD).</p>
<h2 id="base64"><a class="header" href="#base64">Base64</a></h2>
<p>Base64 output is generated to permit the effective transfer of arbitrary
binary data over a simple ASCII only interface. The generated Base64 includes
a new line at each 81st column. This simplifies the cut-and-paste of the
generated Base64 from a terminal program. While new line characters are
technically not part of the Base64 standard, their usage is normal, and it is
conventional for a Base64 encoder and decoder to silently ignore these.</p>
<h2 id="page-size"><a class="header" href="#page-size">Page Size</a></h2>
<p>Within Microkit, Physical Addresses, Virtual Addresses, and Sizes all need to
be aligned to a Page Size. We chose to exclusively work with the smallest
supported page size (4KiB, or 0x1000 bytes). The build process utilises both
bc (arbitrary precision calculator) and m4 (macro processor) to calculate
aligned memory regions and amend the program code and configuration
accordingly.</p>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>The MaaXBoard holds the USB-1 Memory Map from 0x38100000, containing various
items of structured information, including a set of capability descriptions.
These capability descriptions include a four byte Name String, "USB ", one of
which resides at address 0x38100894.</p>
<p>The program may be built to inspect exactly these four bytes:</p>
<pre><code>make get
make all ENV_BLOCK_ADDR_HEX=38100894 ENV_BLOCK_SIZE_BYTE_HEX=4
</code></pre>
<p>On execution, the following is output:</p>
<pre><code>u-boot=&gt; go 0x50000000
## Starting application at 0x50000000 ...
LDR|INFO: altloader for seL4 starting
LDR|INFO: Flags:                0x0000000000000001
             seL4 configured as hypervisor
LDR|INFO: Kernel:      entry:   0x0000008040000000
LDR|INFO: Root server: physmem: 0x000000004024f000 -- 0x0000000040257000
LDR|INFO:              virtmem: 0x000000008a000000 -- 0x000000008a008000
LDR|INFO:              entry  : 0x000000008a000000
LDR|INFO: region: 0x00000000   addr: 0x0000000040000000   size: 0x000000000024c000   offset: 0x0000000000000000   type: 0x000001
LDR|INFO: region: 0x00000001   addr: 0x000000004024f000   size: 0x0000000000007110   offset: 0x000000000024c000   type: 0x000001
LDR|INFO: region: 0x00000002   addr: 0x000000004024c000   size: 0x0000000000000a38   offset: 0x0000000000253110   type: 0x000001
LDR|INFO: region: 0x00000003   addr: 0x000000004024d000   size: 0x00000000000008d4   offset: 0x0000000000253b48   type: 0x000001
LDR|INFO: region: 0x00000004   addr: 0x000000004024e000   size: 0x0000000000000090   offset: 0x000000000025441c   type: 0x000001
LDR|INFO: copying region 0x00000000
LDR|INFO: copying region 0x00000001
LDR|INFO: copying region 0x00000002
LDR|INFO: copying region 0x00000003
LDR|INFO: copying region 0x00000004
LDR|INFO: CurrentEL=EL2
LDR|INFO: Resetting CNTVOFF
LDR|INFO: enabling MMU
LDR|INFO: jumping to kernel
Warning:  gpt_cntfrq 8333333, expected 8000000
Bootstrapping kernel
available phys memory regions: 1
  [40000000..c0000000]
reserved virt address space regions: 3
  [8040000000..804024c000]
  [804024c000..804024f000]
  [804024f000..8040257000]
Booting all finished, dropped to user space
MON|INFO: Microkit Bootstrap
MON|INFO: bootinfo untyped list matches expected list
MON|INFO: Number of bootstrap invocations: 0x00000009
MON|INFO: Number of system invocations:    0x00000028
MON|INFO: completed bootstrap invocations
MON|INFO: completed system invocations
BLOCK_ADDR_HEX:0x0000000038100894
BLOCK_SIZE_BYTE_HEX:0x0000000000000004
BASE64:BEGIN
VVNCIA==
BASE64:END
</code></pre>
<p>The text between <code>BASE64:BEGIN</code> and <code>BASE64:END</code> is Base64 encoded. It may be
decoded to view its contents:</p>
<pre><code>echo "VVNCIA==" | base64 -d | xxd
</code></pre>
<p>Where the expected output is as follows:</p>
<pre><code>00000000: 5553 4220                                USB
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="remote-power-cycle"><a class="header" href="#remote-power-cycle">Remote Power Cycle</a></h1>
<p>It is conventional for seL4 Microkernel to be deployed on embedded devices,
such as the Avent MaaXBoard. And it is conventional for applications installed
onto embedded devices to be designed to start, and never terminate. Thus, in a
development environment, it is very convenient to be able to routinely power
cycle the embedded device, to gain access to the bootloader, and adjust the
application.</p>
<p>The Avent MaaXBoard is powered from a standard USB Type C connection. Thus,
where the Avent MaaXBoard is physically present, the power switch to its USB-C
connection may be flipped off, and back on again, to trivially achieve a power
cycle.</p>
<p>However, where the Avent MaaXBoard is in a remote location, it is more awkward
to achieve a power cycle. One solution is to utilise a USB Hub with PPPS
(Per-Port Power Switching), as described below.</p>
<h2 id="mega4-4-port-usb-31-ppps-hub-for-raspberry-pi-4"><a class="header" href="#mega4-4-port-usb-31-ppps-hub-for-raspberry-pi-4">MEGA4 (4-Port USB 3.1 PPPS Hub for Raspberry Pi 4)</a></h2>
<p>While there are many USB Hubs</p>
<h2 id="deployment"><a class="header" href="#deployment">Deployment</a></h2>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>sudo apt-get install uhubctl</p>
<p>sudo /usr/sbin/uhubctl</p>
<p>Identify the address...</p>
<p>Indvidual control....</p>
<p>sudo /usr/sbin/uhubctl -l "1-12.1" -p 4 -a cycle</p>
<p>perhaps being
shared across a team,</p>
<p>in close physically, it may be trivially power
cycled, by removing and</p>
<p>When the</p>
<p>applications to start and never
terminite</p>
<p>targeting the</p>
<p>The development of applications of with the</p>
<p>atop the seL4 Microkernel, particularly where interacting with</p>
<p>https://thepihut.com/products/mega4-4-port-usb-3-1-ppps-hub-for-raspberry-pi-4</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="device-drivers"><a class="header" href="#device-drivers">Device Driver's</a></h1>
<p>This section seeks to provide guidance on adding device drivers to seL4.</p>
<p>It should be noted that seL4 runs all device drivers in user mode; device support is therefore not the kernel’s problem.</p>
<p>This guide focuses on methods, complete with an extensive worked example, for adding device support to seL4.</p>
<p>The following sections describe the creation of an extensible library for seL4 allowing U-Boot device drivers to function under seL4 with either minimal or no modifications. As an example of its usage, the library provides an extensive set of device drivers for the Avnet MaaXBoard (support for USB, Ethernet, SD/MMC, I<sup>2</sup>C, GPIO, IOMUX, Clock and SPI devices). Guidance on the extension of this library to support other platforms and devices is also provided.</p>
<p>This guide provides guidance on adding device drivers atop of both the CAmkES and Microkit frameworks.</p>
<h2 id="goals"><a class="header" href="#goals">Goals</a></h2>
<p>The goal of this guide is to lower the barrier to entry for the use of seL4. One such barrier is device driver support for seL4, both the relatively limited device driver support as well as the difficulty in the creation of new device drivers.</p>
<p>To help overcome this barrier, this guide attempts to provide a route for adding device support to seL4 with minimal effort and technical challenges. This goal has resulted in the following decisions and priorities being taken:</p>
<ol>
<li>
<p>A focus on porting existing open source device drivers from other projects (e.g. Linux or U-Boot) over the writing of new device drivers; detailed guidance on the writing of new device drivers is outside the scope of this guide.</p>
</li>
<li>
<p>Methods of porting that allow devices to be supported with minimal effort, e.g. minimising changes to driver source code, have been prioritised over factors such as performance and support for all features.</p>
</li>
<li>
<p>Consideration for device driver formal verification has not been applied. No guarantee of correctness, security, or anything else is given for the drivers ported, or the method described.</p>
</li>
</ol>
<h2 id="porting-drivers"><a class="header" href="#porting-drivers">Porting Drivers</a></h2>
<p>Device drivers can be ported from any source where the device driver source code is available under a suitable license. The most obvious such sources are Linux and U-Boot, both of which contain a very large selection of open source device drivers. It is suggested that porting drivers from U-Boot is easier than porting drivers from Linux for the following reasons:</p>
<ul>
<li>
<p>Porting a device driver requires either the driver to be made to function independently from the driver framework of its source project, or for the source project's driver framework to be made to function within seL4. The U-Boot driver framework is significantly less complex and extensive than the Linux driver framework.</p>
</li>
<li>
<p>U-Boot device drivers tend to be significantly simpler than device drivers found in Linux. This is because the use cases of a bootloader such as U-Boot do not require high performance, fully-featured drivers. Indeed it can be seen that many of the U-Boot device drivers are in fact actively simplified versions of Linux drivers that have been ported to the U-Boot driver framework.</p>
</li>
</ul>
<p>In line with the goals stated above this guide therefore focuses on the porting of drivers from U-Boot to seL4.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="u-boot-driver-library-overview"><a class="header" href="#u-boot-driver-library-overview">U-Boot Driver Library Overview</a></h1>
<p>To achieve the goals specified in <a href="activity/device_drivers/main.html">device driver introduction</a> section, an extensible library of device drivers ported from U-Boot has been created. This library provides an extensive set of drivers for the Avnet MaaXBoard platform as a worked example of its usage. The library is supported by documentation in the following sections on usage, maintenance, and guidance on the extension of the library to support additional platforms and devices.</p>
<p>Information on the design and structure of the library is provided under the following sections:</p>
<ul>
<li><a href="activity/device_drivers/uboot_driver_library.html#design-summary">Design Summary</a></li>
<li><a href="activity/device_drivers/uboot_driver_library.html#build-system">Build System</a></li>
<li><a href="activity/device_drivers/uboot_driver_library.html#library-limitations">Library Limitations</a></li>
<li><a href="activity/device_drivers/uboot_driver_library.html#code-structure">Code Structure</a></li>
</ul>
<h2 id="design-summary"><a class="header" href="#design-summary">Design Summary</a></h2>
<p>The primary goal of the library is to allow drivers from U-Boot to be used within seL4 with minimal or no code changes. To support this goal, the library comprises:</p>
<ul>
<li>
<p>A set of U-Boot drivers.</p>
</li>
<li>
<p>The U-Boot <a href="https://u-boot.readthedocs.io/en/latest/develop/driver-model/index.html">Driver Model</a> driver framework and associated subsystems required to support device drivers.</p>
</li>
<li>
<p>Stubbed versions of U-Boot subsystems providing a compatibility / conversion layer between the U-Boot source code and underlying seL4 libraries.</p>
</li>
<li>
<p>A wrapper around the U-Boot code to provide an API for users of the library to interact with devices and manage library initialisation / shutdown.</p>
</li>
</ul>
<p>It should be noted that the library works with the intended security and isolation of seL4; capabilities to permit access to hardware devices and provide sufficient resources (e.g. heap and DMA memory) must be granted to components/protection domains using the library.</p>
<h2 id="detailed-design-information"><a class="header" href="#detailed-design-information">Detailed Design Information</a></h2>
<p>The following sections provide details on the design of stub or wrapper elements that are significant to support the functioning of the drivers within the Driver Model framework.</p>
<h3 id="linker-lists"><a class="header" href="#linker-lists">Linker Lists</a></h3>
<p>To allow variable levels of functionality to be built into a U-Boot executable, U-Boot utilises a concept of <a href="https://u-boot.readthedocs.io/en/latest/api/linker_lists.html">linker-generated arrays</a>. These are arrays of objects (e.g. drivers, supported commands, driver classes, etc.) which are stored by U-Boot within dedicated linker sections to be queried at runtime.</p>
<p>Access to the objects stored within these linker sections is provided by U-Boot through a set of macros defined in the <code>linker_lists.h</code> header file.</p>
<p>To mimic this functionality within the library, the following approach has been taken:</p>
<ol>
<li>
<p>Rather than storing the objects within linker sections of the executable, a global variable named <code>driver_data</code> is declared within <code>driver_data.h</code> which contains the equivalent object arrays.</p>
</li>
<li>
<p>During initialisation of the library, the platform-dependent contents of the <code>driver_data</code> global variable are set up.</p>
</li>
<li>
<p>A stubbed version of the <code>linker_lists.h</code> header file is provided. Rather than accessing data from the executable's linker sections as performed by the original version, the stubbed version accesses data from the arrays within the <code>driver_data</code> global variable.</p>
</li>
</ol>
<h3 id="global-data"><a class="header" href="#global-data">Global Data</a></h3>
<p>U-Boot maintains a <a href="https://u-boot.readthedocs.io/en/latest/develop/global_data.html">global data</a> structure for the storage of globally required fields.</p>
<p>The macro <code>DECLARE_GLOBAL_DATA_PTR</code> is used by U-Boot to provide a pointer to this data structure. On most architectures this pointer is stored in a dedicated register (e.g. register <code>x18</code> on ARM64); such a mechanism is not compatible with seL4.</p>
<p>Within the library the following approach has been taken to global data:</p>
<ol>
<li>
<p>A stub of the <code>global_data.h</code> header file has been provided to provide the macro <code>DECLARE_GLOBAL_DATA_PTR</code> as a pointer to a global variable.</p>
</li>
<li>
<p>At initialisation of the library, memory for the global data structure is allocated and initialised as follows:</p>
<ul>
<li>Most elements are unused and set to null values.</li>
<li>The global status <code>flags</code> are set up to mimic an instance of U-Boot that has been relocated to, and is executing from, RAM.</li>
<li>Pointers to the flattened device tree are setup to point to seL4's device tree.</li>
<li>A <a href="https://u-boot.readthedocs.io/en/latest/develop/driver-model/livetree.html">live device tree</a> is built from the flattened device tree and referenced.</li>
</ul>
</li>
</ol>
<h3 id="timer"><a class="header" href="#timer">Timer</a></h3>
<p>The U-Boot code expects to have access to a high-frequency, monotonic timer. The timer is accessed by the U-Boot source code through calls to routines <code>get_ticks</code>, <code>get_timer_*</code> and <code>timer_get_*</code>.</p>
<p>Provision of such a timer is platform dependent. For the Avnet MaaXBoard the timer has been implemented through use of the System Counter (SYS_CON) device provided by the iMX8MQ SoC; see file <code>timer_imx8mq.c</code> for details.</p>
<h3 id="memory-mapped-io"><a class="header" href="#memory-mapped-io">Memory Mapped IO</a></h3>
<p>One of the core mechanisms for providing a software interface to a hardware device is through the use of <a href="https://en.wikipedia.org/wiki/Memory-mapped_I/O">memory mapped IO</a>.</p>
<p>The memory addresses that a U-Boot driver uses for communication with a device can be either read from the device tree (i.e. from a device's <code>reg</code> property) or in some cases can be hard-coded into the driver.</p>
<p>At this point it should be noted that U-Boot source code is intended to be executed in an environment with direct access to the system's physical address space; however, the library is executed within a virtual address space provided by seL4. As such, the addresses used by U-Boot drivers are <em>physical</em> addresses which are not directly accessible by the library. To work around this issue:</p>
<h4 id="camkes"><a class="header" href="#camkes">CAmkES</a></h4>
<ol>
<li>
<p>During library initialisation the list of all platform-dependent devices that need to be accessed must be provided. For each device:</p>
<ul>
<li>The device's physical address range is read from the device tree.</li>
<li>The device's physical address range is mapped into the virtual address space through use of the IO mapping routines provided by seL4's platform support library.</li>
<li>The mapping between the physical address range and the mapped virtual address range is stored within the <code>sel4_io_map</code> package (part of the library's wrapper functionality).</li>
</ul>
</li>
<li>
<p>When a driver attempts to perform memory mapped IO it calls architecture-dependent routines from the <code>io.h</code> header, e.g. <code>readl</code> or <code>writel</code>. A stubbed version of the <code>io.h</code> header is provided that uses the <code>sel4_io_map</code> package to translate the physical addresses provided by the driver to the equivalent address mapped into the library's virtual address space.</p>
</li>
</ol>
<p>U-Boot drivers performing memory mapped IO should perform seamlessly without the need for any modifications to the driver.</p>
<h4 id="microkit"><a class="header" href="#microkit">Microkit</a></h4>
<p>The physical addresses of all platform-dependent devices must be provided in the system file in this format:</p>
<pre><code>&lt;system&gt;
    &lt;memory_region name="&lt;physical_device_name&gt;" size="&lt;physical_device_size&gt;" phys_addr="&lt;physical_device address&gt;"/&gt;
    ...
    &lt;protection_domain name="&lt;PD name&gt;"&gt;
      &lt;map mr="&lt;physical_device_name&gt;" vaddr="&lt;virtual_map_address&gt;" perms="rw" cached="false"/&gt;
      ...
   &lt;/protection_domain&gt;
&lt;/system&gt;
</code></pre>
<h3 id="dma"><a class="header" href="#dma">DMA</a></h3>
<p>As for <a href="activity/device_drivers/uboot_driver_library.html#memory-mapped-io">memory mapped IO</a>, it should be noted that U-Boot source code expects to be executed in an environment with direct access to the system's physical address space; however the library is executed within a virtual address space provided by seL4.</p>
<p>This can lead to U-Boot drivers that are executed within seL4 erroneously providing a <em>virtual</em> memory address to devices as the address to use for a DMA transfer; DMA transfers performed by devices can only be performed to <em>physical</em> addresses.</p>
<p>To support this issue, the library:</p>
<ol>
<li>
<p>Provides the <code>sel4_dma</code> package as part of its wrapper, which:</p>
<ul>
<li>Provides memory allocation / deallocation routines that utilise the underlying DMA functions provided by seL4's platform support library;</li>
<li>Maintains a mapping between the physical and virtual addresses, and provides routines to perform address translations;</li>
<li>Provides routines to perform flushing and invalidation of the allocated DMA regions.</li>
</ul>
</li>
<li>
<p>Provides an implementation of Linux's <code>dma_mapping.h</code> interface via the <code>sel4_dma</code> package.</p>
</li>
<li>
<p>Provides modifications to the XHCI USB stack, as used by USB 3.0 devices, intended to cover all DMA issues related to <em>users</em> of the USB stack (e.g. keyboard, mouse, or mass storage devices).</p>
</li>
</ol>
<p>It is an unfortunate fact that drivers utilising DMA may require manual modifications to function correctly:</p>
<ul>
<li>
<p>Drivers that use the DMA interface exported by <code>dma-mapping.h</code> should work without modification; drivers ported to U-Boot from Linux have been seen to use this interface. Examples of device drivers for the Avnet MaaXBoard using the <code>dma-mapping.h</code> DMA interface are the USB driver and the SD/MMC driver.</p>
</li>
<li>
<p>Drivers that do not use the DMA interface exported by <code>dma-mapping.h</code> will need to be modified to use the API exported by the <code>sel4_dma</code> wrapper package. An example of a device driver for the Avnet MaaXBoard that required manual modifications is the Ethernet driver (see <code>fec_mxc.c</code>).</p>
</li>
</ul>
<h3 id="console"><a class="header" href="#console">Console</a></h3>
<p>A minimal stub of U-Boot's console subsystem has been provided (see <code>console.c</code>). This stub provides the subset of functionality required to allow input and output devices to be registered and accessed by the driver library.</p>
<p>It should be noted that the console subsystems's <code>stdout</code> file is not used by the library; instead all output is routed directly to the C library output routines.</p>
<p>The console subsystem's <code>stdin</code> file, however, is used. For example, if a USB keyboard is registered with the console as the <code>stdin</code> device then subsequent calls to retrieve input from <code>stdin</code> will return keypresses that are input from the USB keyboard.</p>
<h3 id="standard-output-and-logging"><a class="header" href="#standard-output-and-logging">Standard Output and Logging</a></h3>
<p>The wrapper header file <code>uboot_print.h</code> provides a set of macros that map:</p>
<ul>
<li>All U-Boot standard output routines onto calls to the C library <code>printf</code> routine.</li>
<li>All U-Boot logging routines onto the seL4 platform support library <code>ZF_LOG*</code> routines at an equivalent logging level or <code>UBOOT_LOG</code> routines for Microkit.</li>
</ul>
<h3 id="initialisation"><a class="header" href="#initialisation">Initialisation</a></h3>
<p>As part of library initialisation, any U-Boot subsystems that require explicit initialisation are handled (see <code>uboot_wrapper.c:initialise_uboot_wrapper</code>). This mimics the initialisation that would normally be performed by <a href="https://github.com/u-boot/u-boot/blob/master/common/board_r.c">U-Boot's start-up routine</a>.</p>
<p>Initialisation of the library comprises:</p>
<h4 id="camkes-1"><a class="header" href="#camkes-1">CAmkES</a></h4>
<ul>
<li>Initialisation of the memory mapped IO and DMA wrappers;</li>
<li>Initialisation of the monotonic timer;</li>
<li>Initialisation of the Linker Lists data structure;</li>
<li>Initialisation of the Global Data data structure;</li>
<li>Initialisation of U-Boot's Environment subsystem (manages storage of environment variables);</li>
<li>Initialisation of U-Boot's Driver Model subsystem;</li>
<li>Initialisation of U-Boot's MMC subsystem (if SD/MMC drivers are used by the platform);</li>
<li>Initialisation of U-Boot's Network subsystem (if Ethernet drivers are used by the platform).</li>
</ul>
<p>When calling the <code>initialise_uboot_wrapper</code> routine the following must be provided:</p>
<ul>
<li>The I/O operations data structure from the platform support library. These routines enable the library to access the seL4 device tree and to perform memory mapping and DMA operations. The routines are provided by CAmkES on creation of a single threaded component.</li>
<li>The list of device tree paths containing physical addresses to be memory mapped (through the <code>reg</code> property).</li>
<li>The list of device tree paths for the devices to enable. Note that all sub-nodes of the device tree paths will be automatically enabled; only the root node for the required devices need to be listed. All other nodes in the device tree will be marked as disabled.</li>
</ul>
<h4 id="microkit-1"><a class="header" href="#microkit-1">Microkit</a></h4>
<ul>
<li>Initialisation of the DMA wrappers;</li>
<li>Initialisation of the monotonic timer;</li>
<li>Initialisation of the Linker Lists data structure;</li>
<li>Initialisation of the Global Data data structure;</li>
<li>Initialisation of U-Boot's Environment subsystem (manages storage of environment variables);</li>
<li>Initialisation of U-Boot's Driver Model subsystem;</li>
<li>Initialisation of U-Boot's MMC subsystem (if SD/MMC drivers are used by the platform);</li>
<li>Initialisation of U-Boot's Network subsystem (if Ethernet drivers are used by the platform).</li>
</ul>
<p>When calling the <code>initialise_uboot_wrapper</code> routine the following must be provided:</p>
<ul>
<li>A DMA manager which can be initialised with a call to the <code>microkit_dma_manager</code> routine.</li>
<li>A pointer to the device tree blob.</li>
<li>The list of device tree paths for the devices to enable. Note that all sub-nodes of the device tree paths will be automatically enabled; only the root node for the required devices need to be listed. All other nodes in the device tree will be marked as disabled.</li>
</ul>
<p>A worked example for use of the <code>initialise_uboot_wrapper</code> routine is provided by the <a href="activity/device_drivers/uboot-driver-example.html">uboot-driver-example test application</a> for the Avnet MaaXBoard.</p>
<h2 id="build-system"><a class="header" href="#build-system">Build System</a></h2>
<p>U-Boot is, by necessity, highly configurable in terms of which functionality is included in a build and the configuration of default values / settings. The U-Boot source code relies upon a KConfig build system that results in the definition of a set of macros (typically named <code>CONFIG_xxx</code>), together with the identification of the required source code files, to manage this configuration; however, seL4 relies upon the CMake build system. To resolve this issue the following approach has been taken:</p>
<ol>
<li>
<p>Macros that are expected to be consistent across all platforms, e.g. those supporting the basic U-Boot subsystem configuration that the library relies upon, are defined in the <code>uboot_helper.h</code> header file within the library's wrapper.</p>
</li>
<li>
<p>All other configuration, i.e. macros, includes and sources files, are controlled by the library's CMake file (<code>CMakeLists.txt</code>).</p>
</li>
</ol>
<p>As such all architecture and platform dependent configuration is encapsulated within the library's CMake file. The general structure of this file is as follows:</p>
<ul>
<li>
<p>A section controlling architecture dependent settings. The settings necessary for ARM-based platforms (both ARMv7 and ARMv8) have been provided.</p>
</li>
<li>
<p>A section controlling platform dependent settings. This contains platform-specific macros, identification of drivers supporting the platform, and setup of platform specific header files.</p>
</li>
<li>
<p>One section for each class of device (e.g. clock devices, USB devices, etc.). For each class of device the generic settings are provided (i.e. settings required irrespective of the chosen driver) as well as the settings provided for each supported driver.</p>
</li>
<li>
<p>A section controlling configuration consistent across all architectures and platforms, e.g. the set of source files required by all platforms.</p>
</li>
</ul>
<p>This modular structure of the CMake file is intended to allow for the library to be incrementally extended, i.e. through the addition of support for new architectures, platforms, device classes and drivers.</p>
<h2 id="library-limitations"><a class="header" href="#library-limitations">Library Limitations</a></h2>
<p>Users of the library should be aware of its limitations, and potential workarounds for those limitations.</p>
<ol>
<li>
<p><strong>Thread safety</strong>: The library is not thread safe; as such it is the responsibility of the user to serialise access to any single instance of the library. Note, however, that multiple instances of the library may be used. For example, two instances of the library could be used concurrently, each held within separate CAmkES components/ Microkit protection domains. If multiple instances of the library are used, it is the responsibility of the user to ensure that each instance is using disjoint devices, i.e. two instances of the library would not both be able to access the same USB device; however, it should be possible for one instance to access an Ethernet device whilst a second instance accesses a USB device (see the <a href="activity/device_drivers/../camkes_case_study_application/main.html">case study application</a> for an example of this).</p>
</li>
<li>
<p><strong>Performance</strong>: Do not expect great performance from the library. The underlying U-Boot drivers have tended to prioritise simplicity over performance; for example the SPI driver for the Avnet MaaXBoard does not support the use of DMA transfers even though the underlying device can perform DMA transfers. Additionally, the library wrapper adds additional layers of address translations and data copying (e.g. in its support of memory mapped IO and DMA) as part of the trade-off for minimising changes necessary to the U-Boot drivers.</p>
</li>
<li>
<p><strong>U-Boot Live Device Tree</strong>: The decision has been taken for the library to utilise U-Boot's modern <a href="https://u-boot.readthedocs.io/en/latest/develop/driver-model/livetree.html">live device tree</a> functionality to read device tree properties rather than the historical <code>fdtdec</code> interface. Whilst this should result in improved long term support for the library, it may be necessary to make minor changes to a driver when porting an old driver to the live device tree interface. Porting is a simple activity and guidance is provided <a href="https://u-boot.readthedocs.io/en/latest/develop/driver-model/livetree.html#porting-drivers">here</a>.</p>
</li>
<li>
<p><strong>Interrupt Handling</strong>: The device drivers provided by U-Boot generally do not support interrupt handling; instead they rely on busy-waiting / polling of devices. There is, however, no inherent reason preventing the use of interrupt handlers. Should use of interrupt handling be required then it would need to be added by the user to the driver and the library's API would need to be enhanced to support such functionality.</p>
</li>
<li>
<p><strong>ARM Power Domains</strong>: ARM power domains are controlled through calls to the ARM Trusted Firmware (ATF). Accessing the ATF from within seL4 is not currently supported due to the need for elevated privileges. It is instead suggested that the power domains should be set as required during execution of the bootloader prior to seL4's startup. On the Avnet MaaXBoard, for example, power domains need to be enabled to power the USB PHY; therefore the USB devices need to be probed from the U-Boot bootloader prior to starting seL4 to ensure they are powered.</p>
</li>
</ol>
<h2 id="code-structure"><a class="header" href="#code-structure">Code Structure</a></h2>
<p>The library code is held within the following structure:</p>
<pre><code class="language-text">libubootdrivers
│
├───include
│   ├───plat
│   ├───public_api
│   └───wrapper
│
├───src
│   ├───plat
│   ├───timer
│   └───wrapper
│
├───uboot
│
└───uboot_stub
</code></pre>
<p>The following conventions are maintained for each folder name:</p>
<ul>
<li><strong>plat</strong>: Folders holding platform specific source files. Contains one subfolder per platform.</li>
<li><strong>public_api</strong>: Holds header files defining the library's publicly accessible API.</li>
<li><strong>wrapper</strong>: Bespoke code written for the library.</li>
<li><strong>timer</strong>: Timer driver source code.</li>
<li><strong>uboot</strong>: A symlink to an unmodified, or minimally modified, fork of the U-Boot project. Note that the build system is responsible for creation of the symlink; for the <a href="activity/device_drivers/uboot_driver_usage.html">example test applications</a> the symlink is created by the <code>repo</code> tool.</li>
<li><strong>uboot_stub</strong>: Holds library specific replacements for U-Boot source code. Internal folder structure mirrors U-Boot code structure.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-the-u-boot-driver-library"><a class="header" href="#using-the-u-boot-driver-library">Using the U-Boot Driver Library</a></h1>
<p>This section outlines the library's API.</p>
<ul>
<li><a href="activity/device_drivers/uboot_driver_usage.html#library-api">Library API</a></li>
<li><a href="activity/device_drivers/uboot-driver-example.html">Test application: uboot-driver-example</a></li>
</ul>
<h2 id="library-api"><a class="header" href="#library-api">Library API</a></h2>
<p>At the core of the library's public API (see library folder <code>include/public_api</code> for full details) are:</p>
<ul>
<li>
<p>Routines to initialise (<code>initialise_uboot_drivers</code>) and shutdown (<code>shutdown_uboot_drivers</code>) the library that must book-end the usage of all other API routines;</p>
</li>
<li>
<p>A routine (<code>run_uboot_command</code>) to allow execution of the same textual commands as used at the <a href="activity/device_drivers/first_boot.html#boot-to-u-boot-prompt">U-Boot prompt</a>. For example, in the <a href="activity/device_drivers/uboot_library_add_driver.html#establishing-the-driver-api">I<sup>2</sup>C worked example</a>, it is shown how the U-Boot <code>i2c</code> command is added and used, e.g. to probe the bus.</p>
</li>
</ul>
<p>Although this provides a relatively simple API, it is intuitive as it has a direct analogue to the commands available at the U-Boot command line. There are limitations, but the API can be readily developed further to expose more functionality, for example:</p>
<ul>
<li>
<p>To accept arguments through parameter passing rather than through a textual command;</p>
</li>
<li>
<p>To return data or results rather than printing outcomes to the console;</p>
</li>
<li>
<p>To expose lower-level interfaces than the U-Boot commands permit, for example access to raw Ethernet frames.</p>
</li>
</ul>
<p>It is expected that the source code of the U-Boot commands are likely to provide a starting point for extended API routines.</p>
<p>A number of worked examples have been provided for extensions to the core API described above:</p>
<ul>
<li>
<p>For accessing the <code>stdin</code> file maintained by U-Boot, routines <code>uboot_stdin_&lt;...&gt;</code> have been provided to enable testing whether characters are available and to retrieve them. The <a href="activity/device_drivers/uboot-driver-example.html">uboot-driver-example</a> test application demonstrates usage of these API routines for retrieving characters typed on a connected USB keyboard.</p>
</li>
<li>
<p>For reading and sending raw Ethernet frames, routines <code>uboot_eth_&lt;...&gt;</code> have been provided. The <a href="activity/device_drivers/../picoserver_uboot/main.html">picoserver_uboot</a> test application demonstrates usage of these API routines to integrate the library with the picoTCP stack.</p>
</li>
</ul>
<p>The following documents give a basic overview of the test applications and how to build and run them.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="instructions-for-running-uboot-driver-example-camkes"><a class="header" href="#instructions-for-running-uboot-driver-example-camkes">Instructions for running uboot-driver-example: CAmkES</a></h1>
<p>As usual, this assumes that the user is already running the CAmkES Docker container within the <a href="activity/device_drivers/../../install_and_configure/build_environment_setup.html">build environment</a>, where we can create a directory and clone the code and dependencies.</p>
<pre><code class="language-text">mkdir /host/uboot_test
cd /host/uboot_test
</code></pre>
<pre><code class="language-bash">repo init -u https://github.com/sel4devkit/sel4devkit-maaxboard-camkes-manifest.git
</code></pre>
<pre><code class="language-bash">repo sync
</code></pre>
<p>The test application includes an Ethernet operation (<code>ping</code>) with hard-coded IP addresses; these need to be customised for an individual's environment. The following lines of the source file <code>projects/camkes/apps/uboot-driver-example/components/Test/src/test.c</code> should be edited:</p>
<pre><code class="language-c">run_uboot_command("setenv ipaddr xxx.xxx.xxx.xxx"); // IP address to allocate to MaaXBoard
run_uboot_command("ping yyy.yyy.yyy.yyy"); // IP address of host machine
</code></pre>
<p>Optionally, to <code>ping</code> to an address beyond the local network:</p>
<pre><code class="language-c">run_uboot_command("setenv gatewayip zzz.zzz.zzz.zzz"); // IP address of router
run_uboot_command("setenv netmask 255.255.255.0");
run_uboot_command("ping 8.8.8.8"); // An example internet IP address (Google DNS)
</code></pre>
<p>From the <code>/host/uboot_test</code> directory, execute the following commands:</p>
<pre><code class="language-text">mkdir build
cd build
</code></pre>
<pre><code class="language-bash">../init-build.sh -DCAMKES_APP=uboot-driver-example -DPLATFORM=maaxboard -DSIMULATION=FALSE
</code></pre>
<pre><code class="language-bash">ninja
</code></pre>
<p>A successful build will result in an executable file called <code>capdl-loader-image-arm-maaxboard</code> in the <code>images</code> subdirectory. This should be copied to a file named <code>sel4_image</code> and then made available to the preferred loading mechanism, such as TFTP, as per <a href="activity/device_drivers/../../first_boot/bootloader.html">Bootloader</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="instructions-for-running-the-uboot-driver-example-microkit"><a class="header" href="#instructions-for-running-the-uboot-driver-example-microkit">Instructions for running the uboot-driver-example: Microkit</a></h1>
<p>As usual, this assumes that the user is already running the Microkit Docker container within the <a href="activity/device_drivers/../../install_and_configure/build_environment_setup.html">build environment</a>, where we can create a directory and clone the code and dependencies.</p>
<pre><code class="language-text">mkdir /host/uboot_test
cd /host/uboot_test
</code></pre>
<pre><code class="language-bash">repo init -u git@github.com:sel4devkit/sel4devkit-maaxboard-microkit_manifest.git
</code></pre>
<pre><code class="language-bash">repo sync
</code></pre>
<p>The test application includes an Ethernet operation (<code>ping</code>) with hard-coded IP addresses; these need to be customised for an individual's environment. The following lines of the source file <code>examples/maaxboard/uboot-driver-example/uboot-driver-example.c</code> should be edited:</p>
<pre><code class="language-c">run_uboot_command("setenv ipaddr xxx.xxx.xxx.xxx"); // IP address to allocate to MaaXBoard
run_uboot_command("ping yyy.yyy.yyy.yyy"); // IP address of host machine
</code></pre>
<p>Optionally, to <code>ping</code> to an address beyond the local network:</p>
<pre><code class="language-c">run_uboot_command("setenv gatewayip zzz.zzz.zzz.zzz"); // IP address of router
run_uboot_command("setenv netmask 255.255.255.0");
run_uboot_command("ping 8.8.8.8"); // An example internet IP address (Google DNS)
</code></pre>
<p>From the <code>/host/uboot_test/project_libs</code> directory, execute the following command:</p>
<pre><code class="language-bash">./init-build.sh -DMICROKIT_APP=uboot_driver_example -DPLATFORM=maaxboard
</code></pre>
<p>A successful build will result in an executable file called <code>sel4_image</code> in the <code>examples/maaxboard/uboot-driver-example/example-build</code> subdirectory. This file should be made available to the preferred loading mechanism, such as TFTP, as per <a href="activity/device_drivers/../../first_boot/bootloader.html">Bootloader</a>.</p>
<p>Once build there is an option to rebuild the entire project using the below command:</p>
<pre><code class="language-bash">./init-build.sh -DMICROKIT_APP=uboot_driver_example -DPLATFORM=maaxboard -DBUILD_TYPE=rebuild
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="test-application-picoserver_uboot"><a class="header" href="#test-application-picoserver_uboot">Test application: <code>picoserver_uboot</code></a></h1>
<p>The picoserver_uboot test application has only been built using the camkes framework.</p>
<h2 id="overview-of-the-picoserver_uboot-test-application"><a class="header" href="#overview-of-the-picoserver_uboot-test-application">Overview of the <code>picoserver_uboot</code> test application</a></h2>
<p>It is not the purpose of this developer kit to give a CAmkES tutorial (e.g. see <a href="https://docs.sel4.systems/projects/camkes/">seL4's documentation</a>), but this application is based on the following CAmkES model:</p>
<p><img src="activity/picoserver_uboot/../picoserver_uboot/figures/picoserver-camkes.png" alt="Picoserver CAmkES overview" /></p>
<p>EthDriverUboot is a simple implementation of an Ethernet driver that has been ported from U-Boot. PicoServer provides a picoTCP TCP/IP stack on top of this, and the Echo component simply listens on port 1234 of a given IP address, echoing received characters on the display. (An additional component TimeServer has been omitted from the diagram for clarity, but see the <a href="activity/picoserver_uboot/../camkes_case_study_application/main.html">case study application</a> for more details.)</p>
<h2 id="instructions-for-running-picoserver_uboot"><a class="header" href="#instructions-for-running-picoserver_uboot">Instructions for running <code>picoserver_uboot</code></a></h2>
<p>As usual, this assumes that the user is already running a the CAmkES docker container within the <a href="activity/picoserver_uboot/../../install_and_configure/build_environment_setup.html">build environment</a>, where we can create a directory and clone the code and dependencies.</p>
<pre><code class="language-text">mkdir /host/uboot_pico
cd /host/uboot_pico
</code></pre>
<pre><code class="language-bash">repo init -u https://github.com/sel4devkit/camkes-manifest.git
</code></pre>
<pre><code class="language-bash">repo sync
</code></pre>
<p>From the <code>/host/uboot_pico</code> directory, execute the following commands:</p>
<pre><code class="language-text">mkdir build
cd build
</code></pre>
<pre><code class="language-bash">../init-build.sh -DCAMKES_APP=picoserver_uboot -DPLATFORM=maaxboard -DSIMULATION=FALSE -DPICOSERVER_IP_ADDR=xxx.xxx.xxx.xxx
ninja
</code></pre>
<p>where <code>xxx.xxx.xxx.xxx</code> is the IP address to allocate to the MaaXBoard.</p>
<p>A successful build will result in an executable file called <code>capdl-loader-image-arm-maaxboard</code> in the <code>images</code> subdirectory. This should be copied to a file named <code>sel4_image</code> and then made available to the preferred loading mechanism, such as TFTP, as per <a href="activity/picoserver_uboot/../../first_boot/bootloader.html">Bootloader</a>.</p>
<p>When the <code>picoserver_uboot</code> application is running on the MaaXBoard, it should confirm that it is listening on port 1234 of the supplied IP address. It will also confirm registration of the protocol stack layers. The application allocates a random MAC address.</p>
<p>At any time while running, the application may display <code>No such port ....</code> messages as it monitors traffic on the network; this is expected behaviour that may be ignored.</p>
<p>Meanwhile, from a terminal window on the host machine, use the <code>netcat</code> (<code>nc</code>) command (native to Linux or macOS, or available as a <a href="https://nmap.org/ncat/">download</a> for Windows), where <code>xxx.xxx.xxx.xxx</code> is the IP address of the MaaXBoard, as previously specified:</p>
<pre><code class="language-bash">nc xxx.xxx.xxx.xxx 1234
</code></pre>
<p>On the MaaXBoard (via CoolTerm as usual), a message like the following should be seen:</p>
<pre><code class="language-text">echo: Connection established with yyy.yyy.yyy.yyy on socket 1
</code></pre>
<p>where <code>yyy.yyy.yyy.yyy</code> is the IP address of the host machine.</p>
<p>From the host machine's terminal, strings may be typed until <code>nc</code> is terminated with Ctrl-C:</p>
<pre><code class="language-bash">hostmachine ~ % nc 192.168.0.111 1234
Hello world!
Goodbye
^C
hostmachine ~ %
</code></pre>
<p>Each time carriage return is entered, the <code>picoserver_uboot</code> application will display the string, until the <code>nc</code> session is terminated, upon which the connection will be closed:</p>
<pre><code class="language-text">echo: Connection established with 192.168.0.11 on socket 1
echo: Received message of length 13 --&gt; Hello world!
echo: Received message of length 8 --&gt; Goodbye
echo: Connection closing on socket 2
echo: Connection closed on socket 2
</code></pre>
<p>Connections can be re-established simply by issuing another <code>nc</code> command.</p>
<h3 id="implementation-note"><a class="header" href="#implementation-note">Implementation note</a></h3>
<p>Connecting, disconnecting, and reconnecting to a network can give rise to delays in the order of a few minutes while the elements in the network handshake and resynchronise, particularly in the case of our application, which assigns a random MAC address to the same IP address each time it runs. If the connection is not established promptly, the easiest remedial options are:</p>
<ul>
<li>Start from a clean reboot of the host machine (which will include flushing its DNS cache); or</li>
<li>Be patient! (If you are prepared to wait for a few minutes, the connection will be made. Note that <code>nc</code> may timeout after a while if no connection is made, so the command would need to be repeated.)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="porting-device-drivers-to-a-new-platform"><a class="header" href="#porting-device-drivers-to-a-new-platform">Porting Device Drivers to a New Platform</a></h1>
<p>This section documents the required actions and guidance to add support for a new platform to the library.</p>
<p>By the end of this section, an seL4 executable will be built for the new platform that can initialise the library (although the library may not support any of the platform's devices). Later sections of this guide cover the required actions to add driver support into the library for the new platform (e.g. see the <a href="activity/new_platform/add_odroidc2.html">Odroid-C2 worked example</a>).</p>
<p>Throughout the sections of this guide devoted to extension of the U-Boot driver library, it is expected the developer is working within the folder structure created by the <code>repo</code> tool (e.g. as used to build the <a href="activity/new_platform/../device_drivers/uboot_driver_usage.html">test applications</a>). Key folders and files within the hierarchy are shown below:</p>
<h3 id="camkes-2"><a class="header" href="#camkes-2">CAmkES</a></h3>
<pre><code class="language-text">&lt;manifest root&gt;
|
├───kernel
│   └───tools
│       └───dts
│
└───projects
    ├───camkes
    │   └───apps
    │       └───uboot-driver-example
    │           └───include
    │               └───plat
    │                   └───&lt;platform name&gt;
    │                       └───platform_devices.h
    │
    ├───projects_libs
    │   └───libubootdrivers
    │       ├───include
    │       │   └───plat
    │       │       └───&lt;platform name&gt;
    │       │           └───plat_driver_data.h
    │       ├───src
    │       │   └───plat
    │       │       └───&lt;platform name&gt;
    │       │           └───plat_driver_data.c
    │       └───CMakeLists.txt
    │
    └───uboot
</code></pre>
<ul>
<li><code>kernel/tools/dts</code>: Location of platform device trees.</li>
<li><code>projects/project_libs/camkes/apps/uboot-driver-example</code>: <a href="activity/new_platform/../device_drivers/uboot_driver_usage.html">The test application</a>.</li>
<li><code>projects/project_libs/libubootdrivers</code>: Referred to as "the library" throughout. See <a href="https://github.com/sel4devkit/projects_libs/tree/master/libubootdrivers">linked Git repository</a>.</li>
<li><code>projects/uboot</code>: Fork of the U-Boot project source code (note, this is also symlinked to <code>projects/project_libs/libubootdrivers/uboot</code>).</li>
</ul>
<h3 id="microkit-2"><a class="header" href="#microkit-2">Microkit</a></h3>
<pre><code class="language-text">&lt;manifest root&gt;
|
└───project_libs
    ├───include
    │   └───&lt;platform&gt;
    │       └───all_platform_devices.h
    │
    ├───libubootdrivers
    │       ├───include
    │       │   └───plat
    │       │       └───&lt;platform name&gt;
    │       │           └───plat_driver_data.h
    │       ├───src
    │       │   └───plat
    │       │       └───&lt;platform name&gt;
    │       │           └───plat_driver_data.c
    │       └───CMakeLists.txt
    │
    ├───boards
    │      └───&lt;platform&gt;.dts
    │ 
    ├───example
    │   └───&lt;platform&gt;
    │       └───uboot-driver-example
    │
    └───uboot
</code></pre>
<ul>
<li><code>project_libs/boards</code>: Location of platform device trees.</li>
<li><code>example/&lt;platform&gt;/uboot-driver-example</code>: <a href="activity/new_platform/../device_drivers/uboot_driver_usage.html">The test application</a>.</li>
<li><code>project_libs/libubootdrivers</code>: Referred to as "the library" throughout. See <a href="https://github.com/sel4devkit/sel4devkit-maaxboard-microkit-project-libs/tree/main/libubootdrivers">linked Git repository</a>.</li>
<li><code>project_libs/uboot</code>: Fork of the U-Boot project source code (note, this is also symlinked to <code>project_libs/libubootdrivers/uboot</code>).</li>
</ul>
<h2 id="required-reading"><a class="header" href="#required-reading">Required Reading</a></h2>
<p>The developer should be familiar with the following tools and concepts in order to add platform and driver support to the library.</p>
<ul>
<li>
<p><em>Device Tree</em>: An introduction to device tree data is <a href="https://www.kernel.org/doc/html/latest/devicetree/usage-model.html">provided by the Linux documentation</a> and by the <a href="https://docs.zephyrproject.org/2.6.0/guides/dts/intro.html">Zephyr project</a>.</p>
</li>
<li>
<p><em>CMake</em>: Reference documentation is provided by <a href="https://cmake.org/cmake/help/latest/">the CMake project</a>, including details of the structure and syntax of the CMakeLists.txt file.</p>
</li>
<li>
<p><em>CAmkES</em>: The seL4 foundation provides <a href="https://docs.sel4.systems/projects/camkes/">documentation on its use of CAmkES</a> including tutorials.</p>
</li>
<li>
<p><em>Microkit</em>: The seL4 foundation provides <a href="https://github.com/seL4/microkit/blob/main/docs/manual.md">documentation on its use of Microkit</a> including tutorials.</p>
</li>
</ul>
<h2 id="add-basic-support-to-library"><a class="header" href="#add-basic-support-to-library">Add basic support to library</a></h2>
<p>To allow the library to be successfully compiled for a new platform, the following changes will need to be made to the library.</p>
<h3 id="update-the-librarys-cmake-file-to-support-the-platform"><a class="header" href="#update-the-librarys-cmake-file-to-support-the-platform">Update the library's CMake file to support the platform</a></h3>
<p>The library's CMake file (located at <code>project_libs/libubootdrivers/CMakeLists.txt</code>) contains a section titled <code>Platform specific settings</code> to control the settings for each platform. This section:</p>
<ol>
<li>
<p>Declares a set of variables to control which drivers and optional capabilities are to be built for each platform. The default values produce a build including only a dummy timer driver; this is the minimum necessary to allow the library to be built.</p>
</li>
<li>
<p>Provides a conditional block of settings associated with each supported platform, e.g. to control which of the supported drivers to build. If no conditional block is supplied for a platform, the compilation of the library fails and an error message is returned.</p>
</li>
</ol>
<p>The minimal change to this section that allows the library to be built is therefore the inclusion of a conditional block for the platform, even if that section makes no changes to the default settings. For example, to add support for a platform that is named  <code>foo</code> within the seL4 build system, the following changes would be required:</p>
<pre><code class="language-makefile">    # Set up the applicable drivers and platform dependent configuration.
    if(KernelPlatImx8mq)
        ...
+   elseif("${KernelPlatform}" STREQUAL "foo")
+       # Platform specific settings for the Foo board.
    else()
        message(FATAL_ERROR "Unsupported platform. Aborting.")
    endif()
</code></pre>
<p>Note that where settings are shared across multiple platforms, this logic can be simplified to reflect the shared settings. An example of this is provided in the library's <code>CMakeLists.txt</code> for the <code>maaxboard</code> and <code>imx8mq-evk</code> platforms, which both use the iMX8MQ SoC.</p>
<p>It should also be noted that U-Boot drivers can support multiple devices. For example, many of the drivers added to support the Avnet MaaXBoard support multiple iMX SoCs. If previously supported drivers are compatible with the new platform, this support can be added now; for example, if platform <code>foo</code> has a GPIO device supported by the <code>gpio_mxc</code> driver (as used by the Avnet MaaXBoard), then the line <code>set(gpio_driver "gpio_mxc")</code> could be added to the <code>foo</code> platform's settings to enable support.</p>
<p>To enable access to platform specific header files it is necessary to create a symlink within the U-Boot code structure named <code>arch</code> to one of the many <code>arch-xxx</code> folders provided by U-Boot; this mimics an equivalent action taken by U-Boot's native build system. As an example it can be seen that for the iMX8MQ based platforms the <code>arch</code> symlink points to the <code>arch-imx8m</code> folder. It is expected that identification of the correct folder to link to will in most cases will be possible through naming convention alone. To definitively determine the folder to link, the symlink created during a build of U-Boot could be inspected.</p>
<h3 id="define-platform-specific-linker-lists-data-structure"><a class="header" href="#define-platform-specific-linker-lists-data-structure">Define platform specific Linker Lists data structure</a></h3>
<p>As documented within the <a href="activity/new_platform/../device_drivers/uboot_driver_library.html#linker-lists">Linker Lists section of the library overview</a>, the library requires a global data structure named <code>driver_data</code> to be declared to allow the U-Boot source code to access optional functionality included in the executable.</p>
<p>To define <code>driver_data</code> for the new platform, new platform-specific files must be added to the library. The code blocks that follow provide minimal templates for these files that include the base device classes, drivers for those classes, and base commands that are required by all platforms.</p>
<p>File <code>include/plat/foo/plat_driver_data.h</code>:</p>
<pre><code class="language-c">/*
 * This file defines which drivers, driver classes, driver entries and commands
 * are to be included in the compiled library for this platform.
 *
 * This allows only the drivers compatible with the targeted platform to be
 * included with all non-compatible drivers excluded.
 *
 * It should be noted that some of these are fundamental to allowing the U-Boot
 * driver model to function (e.g. the nop, root and simple bus drivers).
 */

/* Define the number of different driver elements to be used on this platform */
#define _u_boot_uclass_driver_count     5
#define _u_boot_driver_count            2
#define _u_boot_usb_driver_entry_count  0
#define _u_boot_part_driver_count       0
#define _u_boot_cmd_count               3
#define _u_boot_env_driver_count        0
#define _u_boot_env_clbk_count          0
#define _u_boot_driver_info_count       0
#define _u_boot_udevice_count           0

/* Define the uclass drivers to be used on this platform. The count of declarations
 * in this section must match the value of _u_boot_uclass_driver_count */
extern struct uclass_driver _u_boot_uclass_driver__nop;
extern struct uclass_driver _u_boot_uclass_driver__root;
extern struct uclass_driver _u_boot_uclass_driver__simple_bus;
extern struct uclass_driver _u_boot_uclass_driver__phy;
extern struct uclass_driver _u_boot_uclass_driver__blk;

/* Define the drivers to be used on this platform. The count of declarations
 * in this section must match the value of _u_boot_driver_count */
extern struct driver _u_boot_driver__root_driver;
extern struct driver _u_boot_driver__simple_bus;

/* Define the driver entries to be used on this platform. The count of declarations
 * in this section must match the value of _u_boot_usb_driver_entry_count */

/* Define the disk partition types to be used. The count of declarations
 * in this section must match the value of _u_boot_part_driver_count */

/* Define the u-boot commands to be used on this platform. The count of declarations
 * in this section must match the value of _u_boot_cmd_count */
extern struct cmd_tbl _u_boot_cmd__dm;
extern struct cmd_tbl _u_boot_cmd__env;
extern struct cmd_tbl _u_boot_cmd__setenv;

/* Define the u-boot environment variables callbacks to be used on this platform. The
 * count of declarations in this section must match the value of _u_boot_env_clbk_count */
</code></pre>
<p>File <code>src/plat/foo/plat_driver_data.c</code>:</p>
<pre><code class="language-c">#include &lt;uboot_helper.h&gt;
#include &lt;driver_data.h&gt;

#include &lt;dm/device.h&gt;
#include &lt;dm/uclass.h&gt;
#include &lt;dm/platdata.h&gt;
#include &lt;usb.h&gt;
#include &lt;part.h&gt;

void initialise_driver_data(void) {
    /* The number of elements in the uclass_driver_array must match the
     * _u_boot_uclass_driver_count constant (see plat_driver_data.h) */
    driver_data.uclass_driver_array[0]  = _u_boot_uclass_driver__nop;
    driver_data.uclass_driver_array[1]  = _u_boot_uclass_driver__root;
    driver_data.uclass_driver_array[2]  = _u_boot_uclass_driver__simple_bus;
    driver_data.uclass_driver_array[3]  = _u_boot_uclass_driver__phy;
    driver_data.uclass_driver_array[4]  = _u_boot_uclass_driver__blk;

    /* The number of elements in the driver_array must match the
     * _u_boot_driver_count constant (see plat_driver_data.h) */
    driver_data.driver_array[0]  = _u_boot_driver__root_driver;
    driver_data.driver_array[1]  = _u_boot_driver__simple_bus;

    /* The number of elements in the cmd_array must match the
     * _u_boot_cmd_count constant (see plat_driver_data.h) */
    driver_data.cmd_array[0]  = _u_boot_cmd__dm;
    driver_data.cmd_array[1]  = _u_boot_cmd__env;
    driver_data.cmd_array[2]  = _u_boot_cmd__setenv;
}
</code></pre>
<p>As support for additional optional objects (e.g. drivers, driver classes, commands, etc.) are added for a platform, these files will be updated to reference the associated objects. See the files for the Avnet MaaXBoard platform for an example of these how these files provide more extensive support.</p>
<h2 id="add-support-to-example-application"><a class="header" href="#add-support-to-example-application">Add support to example application</a></h2>
<p>Section <a href="activity/new_platform/../device_drivers/uboot_driver_usage.html">Using the U-Boot Driver Library</a> introduced the demonstration application <a href="activity/new_platform/../device_drivers/uboot-driver-example.html">uboot-driver-example</a>. This section documents the changes required to the <code>uboot-driver-example</code> application to allow it to be built for the new platform.</p>
<p>The following empty template file needs to be added to the application <code>include/plat/foo/platform_devices.h</code>:</p>
<h3 id="camkes-3"><a class="header" href="#camkes-3">CAmkES</a></h3>
<pre><code class="language-c">#pragma once

/* List the set of device tree paths that include the 'reg' entries
 * for memory regions that will need to be mapped */
#define REG_PATHS {};
#define REG_PATH_COUNT 0

/* List the set of device tree paths for the devices we wish to access.
 * Note these need to be the root nodes of each device to be accessed */
#define DEV_PATHS {};
#define DEV_PATH_COUNT 0

/* Provide the hardware settings for CAmkES. Note that we only need to inform
 * CAmkES of the devices with memory mapped regions, i.e. the REG_xxx
 * devices. See https://docs.sel4.systems/projects/camkes for syntax */

#define HARDWARE_INTERFACES

#define HARDWARE_COMPOSITION

#define HARDWARE_CONFIGURATION
</code></pre>
<h3 id="microkit-3"><a class="header" href="#microkit-3">Microkit</a></h3>
<pre><code class="language-c">#pragma once

/* List the set of device tree paths that include the 'reg' entries
 * for memory regions that will need to be mapped */
#define REG_PATHS {};
#define REG_PATH_COUNT 0

/* List the set of device tree paths for the devices we wish to access.
 * Note these need to be the root nodes of each device to be accessed */
#define DEV_PATHS {};
#define DEV_PATH_COUNT 0
</code></pre>
<p>As support for devices is added for a platform, this file will be updated to reference those devices from the platform's device tree. See the file for the Avnet MaaXBoard platform for an example that provides more extensive support.</p>
<h2 id="guidance-on-next-steps"><a class="header" href="#guidance-on-next-steps">Guidance on next steps</a></h2>
<p>At this point, the library should compile cleanly for the new platform but will fail during library initialisation due to no devices being supplied.</p>
<p>The order in which drivers need to be added is likely to depend on the intended usage of the library; e.g. support for a single device or support for multiple devices, and the internal needs of the device drivers to be added.</p>
<p>The following drivers are likely to form the core of the support for a platform and underpin the capabilities of other drivers. It may be possible to support some devices without these core drivers, but that would need to checked on a case-by-case basis.</p>
<h3 id="timer-1"><a class="header" href="#timer-1">Timer</a></h3>
<p>As documented <a href="activity/new_platform/../device_drivers/uboot_driver_library.html#timer">in the library overview</a>, some U-Boot drivers rely upon access to a monotonic timer to underpin their timing needs.</p>
<p>By default a platform will be supported by the <code>dummy</code> timer driver (see library file <code>src/timer/timer_dummy.c</code>). Whilst the dummy timer driver allows the library to build cleanly, it will raise an assertion error / exception, thereby halting execution, should any of the timing routines be used. Some simple drivers (e.g. GPIO drivers) typically do not require any timing routines and so can be supported without the need to provide a functional timer; however, a functional timer will typically need to be provided to support more complex devices such as Ethernet or USB.</p>
<p>The means of providing a timer driver is architecture- and platform-dependent, so detailed guidance cannot be provided. A worked example of a timer driver for the iMX8MQ SoC is provided in file <code>src/timer/timer_imx8mq.c</code>; it is expected that this driver could be extended to cover multiple iMX SoCs.</p>
<h3 id="clock"><a class="header" href="#clock">Clock</a></h3>
<p>The U-Boot <code>CLK</code> subsystem is used to enable and reconfigure clocks. To enable the <code>CLK</code> subsystem, support for the platform's U-Boot clock driver will need to be added. See the configuration of the clock driver for the Avnet MaaXBoard in the library's <code>CMakeLists.txt</code> file as an example.</p>
<p>In many cases it may be possible to support devices without the need to add support for a clock driver. Simple devices, e.g. GPIO, may not use a clock source. Even for more complex devices that use a clock source, it may be possible for the device to function without providing a clock driver; e.g. if the device was previously set up and used by the bootloader prior to entry to seL4 then it is likely that the required clocks have already been configured and enabled.</p>
<h3 id="pin-multiplexing-iomux"><a class="header" href="#pin-multiplexing-iomux">Pin Multiplexing (IOMUX)</a></h3>
<p>SoCs typically contain a lot of functionality but a have limited number of pins (or pads). Pin multiplexing is used to configure pins for a specific purpose. An IOMUX driver must be supplied to allow the library to configure the pins from the default configuration.</p>
<p>As with the clock driver, in many cases it may be possible to support devices without the need to add support for an IOMUX driver. For example, if a device was previously set up and used by the bootloader prior to entry to seL4 then it is likely that the required pin configuration has already been configured.</p>
<h3 id="gpio"><a class="header" href="#gpio">GPIO</a></h3>
<p>Many drivers rely upon the availability of a GPIO driver to function correctly. For example: an MMC driver may use GPIO for card-detect and write-protect sensing; an Ethernet driver may use GPIO to reset an external PHY; an SPI driver may use GPIO for the chip select signal, etc.</p>
<p>As such it may be necessary to provide a GPIO driver for other drivers to function correctly.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odroid-c2-platform---worked-example"><a class="header" href="#odroid-c2-platform---worked-example">Odroid-C2 Platform - Worked Example</a></h1>
<p>As part of the review of the <a href="activity/new_platform/main.html">New Platform</a> section of this guide, we ported the
U-Boot Driver Library to build with seL4 on the Odroid-C2 platform for the CAmkES framework.</p>
<p>This document gives details of how this was achieved, following the structure
of those earlier sections, but adding details of exact changes to each file.</p>
<p>Our goal is to get the U-Boot <a href="activity/new_platform/../device_drivers/uboot-driver-example.html">test application</a> running
on the Odroid-C2.</p>
<h2 id="repository-setup-and-forks"><a class="header" href="#repository-setup-and-forks">Repository setup and forks</a></h2>
<p>To work on a new platform build, we need to modify some of the existing repositories.
To do that, we need to "fork" those repositores and do the work in our own local
branches until it's all working. Finally, we would need to open a "Pull Request"
to merge our changes back into the "upstream" repositories.</p>
<p>Additionally, we need to tell the <code>repo</code> tool that we want to build from our
own forked repositories (so that the <code>repo sync</code> step gets the sources from
our forks, not from the upstream repositories).</p>
<p>You'll need to your own GitHub account to do this. From here on, we'll be using the
GitHub account name <code>rod-chapman</code> for our local forks.</p>
<ol>
<li>
<p>Using the GitHub web GUI, create your own forks of the <code>sel4devkit-maaxboard-camkes-manifest</code>, <code>sel4devkit-maaxboard-camkes</code>,
and <code>sel4devkit-maaxboard-camkes-projects-libs</code> repositories. You might want to rename using the board being ported.</p>
</li>
<li>
<p>Clone the <code>sel4devkit-maaxboard-camkes-manifest</code> fork into your local machine, and create
a new branch called <code>addc2</code> to make our changes. In the following commands, remember to change <code>rod-chapman</code> to your own GitHub user name:</p>
<pre><code class="language-text">git clone https://github.com/rod-chapman/sel4devkit-maaxboard-camkes-manifest.git
cd camkes-manifest
git checkout -b addc2
git push --set-upstream origin addc2
cd ..
</code></pre>
</li>
<li>
<p>Similarly, clone the <code>sel4devkit-maaxboard-camkes</code> and <code>sel4devkit-maaxboard-camkes-projects-libs</code> forks, and add a new branch to each with the same name.</p>
<pre><code class="language-text">git clone https://github.com/rod-chapman/sel4devkit-maaxboard-camkes.git
cd camkes
git checkout -b addc2
git push --set-upstream origin addc2
cd ..
</code></pre>
<pre><code class="language-text">git clone https://github.com/rod-chapman/sel4devkit-maaxboard-camkes-projects-libs.git
cd projects_libs
git checkout -b addc2
git push --set-upstream origin addc2
cd ..
</code></pre>
</li>
<li>
<p>Edit the <code>default.xml</code> file in the <code>sel4devkit-maaxboard-camkes-manifest</code> repository to add a new remote (in our
case called <code>rod</code>) pointing at our own GitHub account.</p>
<p>For example, the line to add is</p>
<pre><code class="language-text">&lt;remote name="rod" fetch="https://github.com/rod-chapman"/&gt;
</code></pre>
</li>
<li>
<p>Similarly, edit the <code>default.xml</code> file to specify that the <code>sel4devkit-maaxboard-camkes</code> and <code>sel4devkit-maaxboard-camkes-projects-libs</code> repositories
should come from the <code>addc2</code> branches of our own forked repositories. Find the <code>project</code> line for each
repository and modify its entry to specify our own remote (<code>rod</code>) and branch (<code>addc2</code>).</p>
<p>For example, the <code>project</code> lines for our forks are:</p>
<pre><code class="language-text">&lt;project name="sel4devkit-maaxboard-camkes.git" path="projects/camkes" remote="rod" revision="addc2" upstream="addc2" dest-branch="addc2"&gt;
  &lt;linkfile src="easy-settings.cmake" dest="easy-settings.cmake"/&gt;
&lt;/project&gt;
&lt;project name="sel4devkit-maaxboard-camkes-projects_libs.git" path="projects/projects_libs" remote="rod" revision="addc2" upstream="addc2" dest-branch="addc2"/&gt;
</code></pre>
</li>
<li>
<p>Commit and push that change:</p>
<pre><code class="language-text">cd sel4devkit-maaxboard-camkes-manifest
git add default.xml
git commit -m "Add remote and forked repositories for adding Odroid-C2 platform."
git push
cd ..
</code></pre>
</li>
</ol>
<h2 id="test-application-build-for-the-maaxboard"><a class="header" href="#test-application-build-for-the-maaxboard">Test Application Build for the MaaxBoard</a></h2>
<p>Having made no other changes at this point, we should be able to build and run
the U-Boot Driver Example program for the MaaxBoard from those newly forked
repositories, just to make sure that creating the forks hasn't broken anything.</p>
<p>The earlier instructions in the <a href="activity/new_platform/main.html">New Platform</a>
section should be followed with one significant change: the first <code>repo init</code> command
specifies our fork and branch of the <code>sel4devkit-maaxboard-camkes-manifest</code> repository.</p>
<p>For example:</p>
<pre><code class="language-text">repo init -u https://github.com/rod-chapman/sel4devkit-maaxboard-camkes-manifest.git -b addc2
</code></pre>
<p>Assuming that works, then we can start to make modifications to support the Odroid-C2.</p>
<h2 id="root-directory-platform-name-and-basic-platform-details"><a class="header" href="#root-directory-platform-name-and-basic-platform-details">Root Directory, Platform Name, and basic Platform Details</a></h2>
<p>To build the test application, we need to create a new root directory
to hold a <code>repo</code> structure and perform the build.</p>
<p>The root directory name is <code>c2new</code>. From here on, all directory names given in this section
are relative to that new root directory.</p>
<p>We also know that the Odroid-C2 is already supported by seL4. Its device tree
appears in <code>kernel/tools/dts/odroidc2.dts</code>.</p>
<p>The seL4 "platform name" is <code>odroidc2</code>.</p>
<p>The system-on-chip device at the heart of the C2 is Amlogic S905, also known as
a "meson" SoC.</p>
<p>We create that root directory, and initialise our build environment. Remember to use the
Docker container from the <a href="activity/new_platform/../../install_and_configure/build_environment_setup.html#usage">build environment setup</a> section
from here on:</p>
<pre><code class="language-text"># In the docker container with working directory at /host
mkdir c2new
cd c2new
repo init -u https://github.com/rod-chapman/sel4devkit-maaxboard-camkes-manifest.git -b addc2
repo sync
</code></pre>
<p>At this point, we return to the structure of the <a href="activity/new_platform/main.html">New Platform</a>
section.</p>
<h2 id="update-the-librarys-cmake-file-to-support-the-platform-1"><a class="header" href="#update-the-librarys-cmake-file-to-support-the-platform-1">Update the library's CMake file to support the platform</a></h2>
<p>We need to update the file <code>projects/projects_libs/libubootdrivers/CMakeLists.txt</code> to
include bare-minimum support for our new platform.</p>
<p>From the seL4 documentation we can find that the value of the <code>${KernelPlatform}</code>
variable is <code>odroidc2</code>. We also need to locate the correct C header files for this
platform and create a sym-link to them, so we add:</p>
<pre><code class="language-makefile">+ elseif("${KernelPlatform}" STREQUAL "odroidc2")
+     # Define the drivers used for this platform
+     set(arch_source "./arch-meson")
+     set(arch_target "../projects/uboot/arch/arm/include/asm/arch")
+     execute_process(COMMAND ln -fsn ${arch_source} ${arch_target})
</code></pre>
<p>in the "Platform specific settings" section of the file.</p>
<h2 id="adding-the-gpio-driver"><a class="header" href="#adding-the-gpio-driver">Adding the GPIO Driver</a></h2>
<p>At this point, we decided to add support for the U-Boot "General Purpose IO" device
driver, also known as "GPIO".</p>
<p>We start by searching the Odroid-C2 device tree file for the string "gpio-controller" in
the file <code>kernel/tools/dts/odroidc2.dts</code>.</p>
<p>This appears in two places in the Device Tree, with path-names <code>/soc/bus@c8100000/pinctrl@14/bank@14</code>
and <code>/soc/periphs@c8834000/pinctrl@4b0/bank@4b0</code>.</p>
<p>From those nodes of the tree we search "up" the tree (towards the "soc" root node) for a
"compatible" string. We find</p>
<pre><code class="language-text">compatible = "amlogic,meson-gxbb-aobus-pinctrl";
</code></pre>
<p>for the former entry, and</p>
<pre><code class="language-text">compatible = "amlogic,meson-gxbb-periphs-pinctrl";
</code></pre>
<p>for the latter.</p>
<h2 id="finding-the-driver-source-code"><a class="header" href="#finding-the-driver-source-code">Finding the driver source code</a></h2>
<p>Those "compatible" strings give us the key to finding the correct source file from the U-Boot sources
that we need to support the C2's GPIO device(s).</p>
<p>We can search the sources for all the U-Boot drivers for either of those strings with:</p>
<pre><code class="language-text">cd projects/uboot/drivers
grep -r "meson-gxbb-.*-pinctrl" .
</code></pre>
<p>which yields a result:</p>
<pre><code class="language-text">./pinctrl/meson/pinctrl-meson-gxbb.c:           .compatible = "amlogic,meson-gxbb-periphs-pinctrl",
./pinctrl/meson/pinctrl-meson-gxbb.c:           .compatible = "amlogic,meson-gxbb-aobus-pinctrl",
</code></pre>
<p>showing us that the single source file <code>pinctrl-meson-gxbb.c</code> implements a
driver that is compatible with both of the devices we're interested in.</p>
<p>At the bottom of that source file, we find the declarations:</p>
<pre><code class="language-c">static const struct udevice_id meson_gxbb_pinctrl_match[] = {
        {
                .compatible = "amlogic,meson-gxbb-periphs-pinctrl",
                .data = (ulong)&amp;meson_gxbb_periphs_pinctrl_data,
        },
        {
                .compatible = "amlogic,meson-gxbb-aobus-pinctrl",
                .data = (ulong)&amp;meson_gxbb_aobus_pinctrl_data,
        },
        { /* sentinel */ }
};

U_BOOT_DRIVER(meson_gxbb_pinctrl) = {
        .name = "meson-gxbb-pinctrl",
        .id = UCLASS_PINCTRL,
        .of_match = of_match_ptr(meson_gxbb_pinctrl_match),
        .probe = meson_pinctrl_probe,
        .priv_auto      = sizeof(struct meson_pinctrl),
        .ops = &amp;meson_gx_pinctrl_ops,
};
</code></pre>
<p>so we know the driver is called "meson-gxbb-pinctrl" and it is compatible with both
the "aobus" and "periphs" instances of that device on the C2.</p>
<h2 id="adding-a-source-dependency-for-the-gpio-driver"><a class="header" href="#adding-a-source-dependency-for-the-gpio-driver">Adding a source dependency for the GPIO driver</a></h2>
<p>Having identified which source file we need to build, we can add it to the CMake file.</p>
<p>Firstly, we set the variable "iomux_driver" to the value we just found - "meson-gxbb-pinctrl" -
by adding</p>
<pre><code class="language-makefile">     elseif("${KernelPlatform}" STREQUAL "odroidc2")
         # Define the drivers used for this platform
+        set(iomux_driver "meson-gxbb-pinctrl")
         ...
</code></pre>
<p>in the "Platform Specific Settings" section of the <code>CMakeLists.txt</code> file as above.</p>
<p>In the same file, we then go to the "Settings for IOMUX Drivers" section and add
an <code>elseif</code> branch to add the required source code dependencies when that driver is selected:</p>
<pre><code class="language-makefile">    elseif(iomux_driver MATCHES "meson-gxbb-pinctrl")
        list(APPEND uboot_deps uboot/drivers/pinctrl/meson/pinctrl-meson-gxbb.c)
</code></pre>
<h2 id="resolving-compilation-issues"><a class="header" href="#resolving-compilation-issues">Resolving Compilation Issues</a></h2>
<p>An attempt to compile the U-Boot Driver Test application fails owing to missing sources, where
our new driver code depends on some other code that we have not included yet.</p>
<p>Identification of the missing units (and further searching of the U-Boot driver sources) shows that
we additionally need the <code>pinctrl-meson.c</code> and <code>pinctrl-meson-gx-pmx.c</code> source files to be included, so
we update <code>CMakeLists.txt</code> to include them:</p>
<pre><code class="language-makefile">    elseif(iomux_driver MATCHES "meson-gxbb-pinctrl")
        list(APPEND uboot_deps uboot/drivers/pinctrl/meson/pinctrl-meson-gxbb.c)
        list(APPEND uboot_deps uboot/drivers/pinctrl/meson/pinctrl-meson.c)
        list(APPEND uboot_deps uboot/drivers/pinctrl/meson/pinctrl-meson-gx-pmx.c)
</code></pre>
<h2 id="platform-specific-linker-lists"><a class="header" href="#platform-specific-linker-lists">Platform Specific Linker Lists</a></h2>
<p>Next, we need to add the "Linker Lists" data structures for this platform
and for the set of device drivers that we want to support.</p>
<p>First, we create two new directories in our fork of the projects_libs repository:</p>
<pre><code class="language-text">projects_libs/libubootdrivers/include/plat/odroidc2
</code></pre>
<p>and</p>
<pre><code class="language-text">projects_libs/libubootdrivers/src/plat/odroidc2
</code></pre>
<p>Following the templates from the <a href="activity/new_platform/main.html">New Platform</a> section,
we create <code>plat_driver_data.h</code> in the former of those directories.</p>
<p>There are five UClass Drivers that are effectively mandatory (<code>nop</code>, <code>root</code>, <code>simple_bus</code>, <code>phy</code> and <code>blk</code>),
and we want to add two more (<code>pinconfig</code> and <code>pinctrl</code>), making a total of 7, so we declare in
<code>plat_driver_data.h</code>:</p>
<pre><code class="language-c">#define _u_boot_uclass_driver_count     7

/* Define the uclass drivers to be used on this platform */
extern struct uclass_driver _u_boot_uclass_driver__nop;
extern struct uclass_driver _u_boot_uclass_driver__root;
extern struct uclass_driver _u_boot_uclass_driver__simple_bus;
extern struct uclass_driver _u_boot_uclass_driver__phy;
extern struct uclass_driver _u_boot_uclass_driver__blk;
extern struct uclass_driver _u_boot_uclass_driver__pinconfig;
extern struct uclass_driver _u_boot_uclass_driver__pinctrl;
</code></pre>
<p>We require a total of 4 drivers, so:</p>
<pre><code class="language-c">#define _u_boot_driver_count            4

/* Define the drivers to be used on this platform */
extern struct driver _u_boot_driver__root_driver;
extern struct driver _u_boot_driver__simple_bus;
extern struct driver _u_boot_driver__pinconfig_generic;
extern struct driver _u_boot_driver__meson_gxbb_pinctrl;
</code></pre>
<p>and 4 commands:</p>
<pre><code class="language-c">#define _u_boot_cmd_count               4

/* Define the u-boot commands to be used on this platform */
extern struct cmd_tbl _u_boot_cmd__dm;
extern struct cmd_tbl _u_boot_cmd__env;
extern struct cmd_tbl _u_boot_cmd__setenv;
extern struct cmd_tbl _u_boot_cmd__pinmux;
</code></pre>
<p>We can now create <code>plat_driver_data.c</code> in the <code>src/plat/odroidc2</code> directory to initialise
the actual data structures thus:</p>
<pre><code class="language-c">void initialise_driver_data(void) {
    driver_data.uclass_driver_array[0]  = _u_boot_uclass_driver__nop;
    driver_data.uclass_driver_array[1]  = _u_boot_uclass_driver__root;
    driver_data.uclass_driver_array[2]  = _u_boot_uclass_driver__simple_bus;
    driver_data.uclass_driver_array[3]  = _u_boot_uclass_driver__phy;
    driver_data.uclass_driver_array[4]  = _u_boot_uclass_driver__blk;
    driver_data.uclass_driver_array[5]  = _u_boot_uclass_driver__pinconfig;
    driver_data.uclass_driver_array[6]  = _u_boot_uclass_driver__pinctrl;

    driver_data.driver_array[0]  = _u_boot_driver__root_driver;
    driver_data.driver_array[1]  = _u_boot_driver__simple_bus;
    driver_data.driver_array[2]  = _u_boot_driver__pinconfig_generic;
    driver_data.driver_array[3]  = _u_boot_driver__meson_gxbb_pinctrl;

    driver_data.cmd_array[0]  = _u_boot_cmd__dm;
    driver_data.cmd_array[1]  = _u_boot_cmd__env;
    driver_data.cmd_array[2]  = _u_boot_cmd__setenv;
    driver_data.cmd_array[3]  = _u_boot_cmd__pinmux;
}
</code></pre>
<p>Note how the number of assignments and array elements initialised must exactly match
the values of the constants defined in the <code>plat_driver_data.h</code> file.</p>
<h2 id="add-odroid-c2-support-in-the-u-boot-driver-example-test-program"><a class="header" href="#add-odroid-c2-support-in-the-u-boot-driver-example-test-program">Add Odroid-C2 support in the U-Boot Driver Example test program</a></h2>
<p>We now need to modify the CAmkES configuration of our test program to tell CAmkES that our program is
configured for this platform and our code can have capabilities allocation to access certain devices.</p>
<p>This is done by creating a specific <code>platform_devices.h</code> file for the Odroid-C2 in the example application.</p>
<p>We create <code>camkes/apps/uboot-driver-example/include/plat/odroidc2/platform_devices.h</code> with the following
content:</p>
<pre><code class="language-c">#pragma once

/* List the set of device tree paths that include the 'reg' entries
 * for memory regions that will need to be mapped */
#define BUS_PATH     "/soc/bus@c8100000"
#define PERIPHS_PATH "/soc/periphs@c8834000"
#define REG_PATHS { BUS_PATH, PERIPHS_PATH };
#define REG_PATH_COUNT 2

/* List the set of device tree paths for the devices we wish to access.
 * Note these need to be the root nodes of each device to be accessed */
#define PINCTRL1_PATH "/soc/bus@c8100000/pinctrl@14"
#define PINCTRL2_PATH "/soc/periphs@c8834000/pinctrl@4b0"
#define DEV_PATHS { PINCTRL1_PATH, PINCTRL2_PATH };
#define DEV_PATH_COUNT 2

/* Provide the hardware settings for CAmkES. Note that we only need to inform
 * CAmkES of the devices with memory mapped regions, i.e. the REG_xxx
 * devices. See https://docs.sel4.systems/projects/camkes for syntax */

#define HARDWARE_INTERFACES                                                   \
    consumes Dummy bus;                                                       \
    consumes Dummy periphs;                                                   \
    emits Dummy dummy_source;

#define HARDWARE_COMPOSITION                                                \
    connection seL4DTBHardware bus_conn(from dummy_source, to bus);         \
    connection seL4DTBHardware periphs_conn(from dummy_source, to periphs);

#define HARDWARE_CONFIGURATION                                              \
    bus.dtb     = dtb({ "path" : BUS_PATH });                               \
    periphs.dtb = dtb({ "path" : PERIPHS_PATH });                           \
</code></pre>
<p>Refer to the <a href="https://docs.sel4.systems/Tutorials/hello-camkes-0.html">CAmkES tutorial</a>
and <a href="https://docs.sel4.systems/projects/camkes/">documentation</a> for the exact syntax
and semantics of these declarations.</p>
<p>We also need to update the main test program to enable the specific tests that we want to run
on the Odroid-C2. The source file is in <code>projects/camkes/apps/uboot-driver-example/components/Test/src/test.c</code>.</p>
<p>Each specific test for device <code>XXX</code> is only run if a C preprocessor symbol <code>TEST_XXX</code> is defined. A set of these are defined by testing each appropriate <code>CONFIG_PLAT_YYY</code> symbol that might be defined by CMake. <code>test.c</code> already defines a set of tests are are appropriate for the MaaxBoard, so we need to add a set for the Odroid-C2. At this point, only the <code>pinmux</code> command is implemented, so we add:</p>
<pre><code class="language-text">  /* Determine which functionality to test based upon the platform */
  #if defined(CONFIG_PLAT_MAAXBOARD)
      ...
+ #elif defined(CONFIG_PLAT_ODROIDC2)
+     #define TEST_PINMUX
  #else
      ...
  #endif
</code></pre>
<h2 id="compilation"><a class="header" href="#compilation">Compilation</a></h2>
<p>At this point, the U-Boot Driver Example test program should build for the C2.</p>
<p>Make sure all your changes are committed and pushed to GitHub, then (in the Docker container):</p>
<pre><code class="language-text">cd /host/c2new
repo sync
mkdir build
cd build
../init-build.sh -DCAMKES_APP=uboot-driver-example -DPLATFORM=odroidc2 -DSIMULATION=FALSE
ninja
</code></pre>
<p>This should result in a binary image in the <code>images</code> subdirectory that can be copied to a
USB memory stick or a TFTP server of your choice. As before, we assume that the image is renamed
to <code>sel4_image</code> if that is the default set up in your U-Boot configuration.</p>
<h2 id="running-the-test-application"><a class="header" href="#running-the-test-application">Running the test application</a></h2>
<p>In our case, we download using TFTP, so we start the TFTP Server Application as before, start CoolTerm,
reboot the Odroid-C2, and hit <code>Return</code> immediately to interrupt whatever default boot
sequence is installed.  Then we set the <code>ipaddr</code> and <code>serverip</code> environment variables in
U-Boot, and use the <code>tftpboot sel4_image</code> command to download the image.</p>
<p>On our system, our ethernet subnet is <code>192.168.2.x</code> and the image is built to
run with a start address of <code>0x20000000</code>, so the entire
sequence of commands to setup, download and start the test program is:</p>
<pre><code class="language-text">odroidc2# setenv ipaddr 192.168.2.2
odroidc2# setenv serverip 192.168.2.1
odroidc2# tftpboot sel4_image
odroidc2# go 0x20000000
</code></pre>
<h2 id="test-results"><a class="header" href="#test-results">Test results</a></h2>
<p>Most of the commands that are expected to work on the MaaxBoard
will fail on the Odroid-C2 owing to missing drivers, but the <code>dm tree</code> command
should work and show the <code>pinctrl</code> devices that we have added. The output that we see,
truncated to only show the first 4 levels of the device tree, is as follows:</p>
<pre><code class="language-text">Starting U-Boot driver example
run_uboot_command@uboot_wrapper.c:176 --- running command 'dm tree' ---
 Class     Index  Probed  Driver                Name
-----------------------------------------------------------
 root          0  [ + ]   root_driver           root_driver
 simple_bus    0  [   ]   simple_bus            `-- soc
 simple_bus    1  [   ]   simple_bus                |-- bus@c8100000
 pinctrl       0  [   ]   meson-gxbb-pinctrl        |   `-- pinctrl@14
 pinconfig     0  [   ]   pinconfig                 |       |-- uart_ao_a
 pinconfig     1  [   ]   pinconfig                 |       |   `-- mux
 pinconfig     2  [   ]   pinconfig                 |       |-- # and many more - truncated here
 pinconfig     3  [   ]   pinconfig                 |       |   `-- mux
 simple_bus    2  [   ]   simple_bus                `-- periphs@c8834000
 pinctrl       1  [   ]   meson-gxbb-pinctrl            `-- pinctrl@4b0
 pinconfig    40  [   ]   pinconfig                         |-- emmc
 pinconfig    41  [   ]   pinconfig                         |   `-- mux
 pinconfig    42  [   ]   pinconfig                         |-- # and many more - truncated here
 pinconfig    43  [   ]   pinconfig                         |   `-- mux
run_uboot_command@uboot_wrapper.c:181 --- command 'dm tree' completed with return code 0 ---
Completed U-Boot driver example
</code></pre>
<h2 id="adding-support-for-the-led-and-gpio-commands"><a class="header" href="#adding-support-for-the-led-and-gpio-commands">Adding support for the LED and GPIO commands</a></h2>
<p>At this point, we can go further and add support for the U-Boot <code>led</code> and <code>gpio</code> commands.</p>
<p>The LEDs are driven by the lower-level GPIO <code>pinctrl</code> and <code>pinmux</code> subsystems, so we look in the Odroid-C2's device tree for the tell-tale "compatible" string for the appropriate driver. We find:</p>
<pre><code class="language-text">leds {
    compatible = "gpio-leds";
    blue {
        label = "c2:blue:alive";
        gpios = &lt; 0x2e 0x0d 0x01 &gt;;
        linux,default-trigger = "heartbeat";
        default-state = "off";
    };
};
</code></pre>
<p>This tells is to look for the declaration of a <code>gpio-leds</code> driver in the U-Boot sources. Indeed, in <code>uboot/drivers/led/led_gpio.c</code>, we find:</p>
<pre><code class="language-c">U_BOOT_DRIVER(led_gpio) = {
        .name   = "gpio_led",
        .id     = UCLASS_LED,
        .ops    = &amp;gpio_led_ops,
        .priv_auto      = sizeof(struct led_gpio_priv),
        .probe  = led_gpio_probe,
        .remove = led_gpio_remove,
};

static const struct udevice_id led_gpio_ids[] = {
        { .compatible = "gpio-leds" },
        { }
};

U_BOOT_DRIVER(led_gpio_wrap) = {
        .name   = "gpio_led_wrap",
        .id     = UCLASS_NOP,
        .of_match = led_gpio_ids,
        .bind   = led_gpio_bind,
};
</code></pre>
<p>showing that we need to add the <code>led_gpio</code> and <code>led_gpio_wrap</code> drivers to our build.</p>
<p>In addition, we need to add the general GPIO driver which, for this platform, is called <code>meson_gx_gpio_driver</code>.</p>
<p>In summary, we need to:</p>
<ul>
<li>add 2 more UClass Drivers, 3 more Drivers, and 2 more U-Boot commands to the library configuration in <code>plat_driver_data.h</code>:</li>
</ul>
<pre><code class="language-text">#define _u_boot_uclass_driver_count     9 // was 7 previously
#define _u_boot_driver_count            7 // was 4 previously
#define _u_boot_cmd_count               6 // was 4 previously

  extern struct uclass_driver _u_boot_uclass_driver__pinconfig;
  extern struct uclass_driver _u_boot_uclass_driver__pinctrl;
+ extern struct uclass_driver _u_boot_uclass_driver__gpio;
+ extern struct uclass_driver _u_boot_uclass_driver__led;

  extern struct driver _u_boot_driver__pinconfig_generic;
  extern struct driver _u_boot_driver__meson_gxbb_pinctrl;
+ extern struct driver _u_boot_driver__meson_gx_gpio_driver;
+ extern struct driver _u_boot_driver__led_gpio_wrap;
+ extern struct driver _u_boot_driver__led_gpio;

  extern struct cmd_tbl _u_boot_cmd__pinmux;
+ extern struct cmd_tbl _u_boot_cmd__gpio;
+ extern struct cmd_tbl _u_boot_cmd__led;
</code></pre>
<ul>
<li>initialise these structures properly in <code>plat_driver_data.c</code>, adding:</li>
</ul>
<pre><code class="language-text">  driver_data.uclass_driver_array[5]  = _u_boot_uclass_driver__pinconfig;
  driver_data.uclass_driver_array[6]  = _u_boot_uclass_driver__pinctrl;
+ driver_data.uclass_driver_array[7]  = _u_boot_uclass_driver__gpio;
+ driver_data.uclass_driver_array[8]  = _u_boot_uclass_driver__led;

  driver_data.driver_array[2]  = _u_boot_driver__pinconfig_generic;
  driver_data.driver_array[3]  = _u_boot_driver__meson_gxbb_pinctrl;
+ driver_data.driver_array[4]  = _u_boot_driver__meson_gx_gpio_driver;
+ driver_data.driver_array[5]  = _u_boot_driver__led_gpio_wrap;
+ driver_data.driver_array[6]  = _u_boot_driver__led_gpio;

  driver_data.cmd_array[3]  = _u_boot_cmd__pinmux;
+ driver_data.cmd_array[4]  = _u_boot_cmd__gpio;
+ driver_data.cmd_array[5]  = _u_boot_cmd__led;
</code></pre>
<ul>
<li>modify <code>CMakeLists.txt</code> to enable those drivers and sources in the CMake build process:</li>
</ul>
<pre><code class="language-makefile">     elseif("${KernelPlatform}" STREQUAL "odroidc2")
         # Define the drivers used for this platform
         set(iomux_driver "meson-gxbb-pinctrl")
+        set(gpio_driver "meson_gx_gpio_driver")
+        set(led_driver "gpio_led")
         ...
</code></pre>
<p>Next, we declare the <code>/leds</code> device tree path in the configuration of the U-Boot Driver Example program in <code>camkes/apps/uboot-driver-example/include/plat/odroidc2/platform_devices.h</code> and add that to the list of <code>DEV_PATHS</code> that are required by our test application:</p>
<pre><code class="language-text">#define LEDS_PATH "/leds"
#define DEV_PATHS { PINCTRL1_PATH, PINCTRL2_PATH, LEDS_PATH };
#define DEV_PATH_COUNT 3
</code></pre>
<p>Finally, the main test program <code>test.c</code> is modified to run tests for the <code>gpio</code> and <code>led</code> commands</p>
<pre><code class="language-text">  #elif defined(CONFIG_PLAT_ODROIDC2)
      #define TEST_PINMUX
+     #define TEST_GPIO
+     #define TEST_LED
+     #define TEST_LED_NAME_1 "c2:blue:alive"
+     #define TEST_LED_NAME_2 "c2:blue:alive"
</code></pre>
<p>If we run the test program, we first notice the tail of the output of the <code>dm tree</code> command now includes:</p>
<pre><code class="language-text"> gpio          1  [ + ]   meson-gx-gpio         |           `-- meson-gpio
 nop           0  [ + ]   gpio_led_wrap         `-- leds
 led           0  [ + ]   gpio_led                  `-- blue
</code></pre>
<p>Secondly the <code>led list</code> command produces:</p>
<pre><code class="language-text">c2:blue:alive   off
</code></pre>
<p>The <code>pinmux status -a</code> command also works, and lists the current assignment of the general GPIO pins to their current specific function.</p>
<h2 id="wrapping-up"><a class="header" href="#wrapping-up">Wrapping up</a></h2>
<p>This section has given a detailed walkthrough of how the U-Boot driver framework and test application
have been built and run under seL4 on the Odroid-C2. We've also shown how the basic GPIO "pinctrl"
driver from U-Boot can be added to our configuration for that platform and how the
U-Boot <code>dm tree</code> command works and shows the presence of that device. We then went on to add support for the <code>pinmux</code> and <code>led</code> commands and demonstrated their use in a simple test application.</p>
<p><img src="activity/new_platform/../new_platform/figures/odroidc2_boots.png" alt="C2_Boots" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="new-driver"><a class="header" href="#new-driver">New Driver</a></h1>
<p>This section provides guidance on the addition of a new device driver to support a device on an existing platform.</p>
<p>Adding support for a new device can be broken down into logical steps:</p>
<ol>
<li>
<p><a href="activity/new_driver/main.html#identification-of-u-boot-device-driver">Identification of U-Boot Device Driver</a></p>
</li>
<li>
<p><a href="activity/new_driver/main.html#updating-cmakeliststxt">Updating the library <code>CMakeLists.txt</code> to support the device driver</a></p>
</li>
<li>
<p><a href="activity/new_driver/main.html#associating-driver-with-platform">Associating the device driver with an existing platform</a></p>
</li>
<li>
<p><a href="activity/new_driver/main.html#resolving-compilation-issues">Resolving compilation issues</a></p>
</li>
<li>
<p><a href="activity/new_driver/main.html#updating-sel4-application">Updating an seL4 application to access the device</a></p>
</li>
</ol>
<p>To further support this topic, documentation have been added to provide <a href="activity/new_driver/add_driver_worked_example.html">a worked example</a> and to discuss <a href="activity/new_driver/driver_troubleshooting.html">troubleshooting and common issues</a> that may be encountered.</p>
<h2 id="identification-of-u-boot-device-driver"><a class="header" href="#identification-of-u-boot-device-driver">Identification of U-Boot Device Driver</a></h2>
<p>The first step in adding a new device driver to the library is to positively identify the U-Boot source file providing the required support. U-Boot declares drivers through use of a macro of the following format:</p>
<pre><code class="language-c">U_BOOT_DRIVER(&lt;driver_id&gt;) = {
    .name = "&lt;driver_name&gt;",
    .id = UCLASS_&lt;driver_uclass_id&gt;,
    ...
};
</code></pre>
<p>An example of such a declaration from the GPIO driver for the Avnet MaaXBoard can be found in the U-Boot source code within file <code>drivers/gpio/mxc_gpio.c</code>.</p>
<p>If a build of U-Boot with support for the desired device is available, the name of the device driver can be obtained through use of U-Boot's <code>dm tree</code> command.</p>
<p>For example, to determine the GPIO device driver for a platform the following <code>dm tree</code> output would identify that the U-Boot driver with a <code>&lt;driver_name&gt;</code> of <code>gpio_mxc</code> provides the desired support. Note that the name of the device (as per the platform's device tree) is provided in the <code>Name</code> column whilst the <code>&lt;driver_name&gt;</code> is provided in the <code>Driver</code> column.</p>
<pre><code class="language-text">u-boot=&gt; dm tree
 Class     Index  Probed  Driver                Name
-----------------------------------------------------------
 root          0  [ + ]   root_driver           root_driver
 simple_bus    0  [ + ]   simple_bus            `-- soc@0
 simple_bus    1  [ + ]   simple_bus                |-- bus@30000000
 gpio          0  [ + ]   gpio_mxc                  |   |-- gpio@30200000
 gpio          1  [   ]   gpio_mxc                  |   |-- gpio@30210000
 gpio          2  [   ]   gpio_mxc                  |   |-- gpio@30220000
 gpio          3  [   ]   gpio_mxc                  |   |-- gpio@30230000
 gpio          4  [   ]   gpio_mxc                  |   |-- gpio@30240000
 ...
</code></pre>
<p>If no such build of U-Boot is available, the device driver can be obtained through manual matching of the <code>compatible</code> strings between the platform's device tree and a device driver.</p>
<p>For example, from the following device tree excerpt it can be seen that the GPIO device is compatible with a device driver that advertises compatibility to either <code>fsl,imx8mq-gpio</code> or <code>fsl,imx35-gpio</code> devices.</p>
<pre><code class="language-text">gpio@30200000 {
    compatible = "fsl,imx8mq-gpio\0fsl,imx35-gpio";
    ...
};
</code></pre>
<p>Performing a textual search for these compatibility strings within the U-Boot source code provides the following match for the <code>fsl,imx35-gpio</code> compatibility string:</p>
<pre><code class="language-c">static const struct udevice_id mxc_gpio_ids[] = {
    { .compatible = "fsl,imx35-gpio" },
    { }
};

U_BOOT_DRIVER(gpio_mxc) = {
    .name = "gpio_mxc",
    .id = UCLASS_GPIO,
    ...
    .of_match = mxc_gpio_ids,
    ...
};
</code></pre>
<p>Through either method, the U-Boot source file declaring the driver can be identified.</p>
<h2 id="updating-cmakeliststxt"><a class="header" href="#updating-cmakeliststxt">Updating <code>CMakeLists.txt</code></a></h2>
<p>Once the source file declaring the driver has been established, this information can be captured in the library CMake file (<code>CMakeLists.txt</code>).</p>
<p>The CMake file contains sections devoted to each class of driver (also known as a <code>UCLASS</code> in U-Boot), e.g. Ethernet drivers, MMC drivers, etc. If the driver to be added is of a previously unsupported class then a new section will need to be added; this will typically have the following structure (using the GPIO driver class as an example supporting a single driver):</p>
<pre><code class="language-makefile">#############################
# Settings for GPIO drivers #
#############################

if(gpio_driver MATCHES "none")
    # Nothing to do
else()
    # Enable GPIO support
    add_definitions("-DCONFIG_DM_GPIO=1")
    add_definitions("-DCONFIG_GPIO_EXTRA_HEADER=1")
    add_definitions("-DCONFIG_CMD_GPIO_READ=1")
    # Generic GPIO source files
    list(APPEND uboot_deps uboot/cmd/gpio.c)
    list(APPEND uboot_deps uboot/drivers/gpio/gpio-uclass.c)

    # Driver specific settings / files
    if(gpio_driver MATCHES "gpio_mxc")
        list(APPEND uboot_deps uboot/drivers/gpio/mxc_gpio.c)
    else()
        message(FATAL_ERROR "Unrecognised GPIO driver. Aborting.")
    endif()
endif()
</code></pre>
<p>This structure allows configuration settings to be defined, such as configuration macros and source files, which are set regardless of the driver to be used, as well as configuration settings specific to each driver.</p>
<p>To identify the required configuration macros (using <code>add_definitions("-D&lt;macro_name&gt;=1")</code>) it is suggested that the macros generated by a build of U-Boot are examined (contained in the <code>.config</code> file following configuration of U-Boot). If a build of U-Boot is unavailable, the <code>defconfig</code> file for the platform can be examined (see U-Boot files <code>config/&lt;platform&gt;_defconfig</code>). Alternatively, how the configuration macros themselves are used within the U-Boot source code can be examined (see instances of <code>#if ...</code>).</p>
<p>For a new driver class, it is recommended that two source files are listed for all drivers (using <code>list(APPEND uboot_deps &lt;file&gt;)</code>):</p>
<ol>
<li>The source file declaring U-Boot commands related to the driver class. For example, U-Boot commands related to GPIO are stored in the <code>uboot/cmd/gpio.c</code> file.</li>
<li>The source file declaring the UCLASS driver for the driver class. A UCLASS driver is declared in U-Boot using the <code>UCLASS_DRIVER</code> macro. For example, the U-Boot GPIO UCLASS driver is declared in the <code>uboot/drivers/gpio/gpio-uclass.c</code> file.</li>
</ol>
<p>For a new driver it is recommended that the single source file declaring the driver (as identified in the <a href="activity/new_driver/main.html#identification-of-u-boot-device-driver">previous step</a>) is set.</p>
<p>It is accepted at this stage that the set of source files may not be complete; this is resolved in a later step.</p>
<p>Note that by convention, the driver naming used in <code>CMakeLists.txt</code> matches the driver name used by U-Boot, e.g. in its <code>dm tree</code> output (e.g. <code>gpio_mxc</code>).</p>
<h2 id="associating-driver-with-platform"><a class="header" href="#associating-driver-with-platform">Associating Driver With Platform</a></h2>
<p>To associate the driver with the platform, the following changes need to be made.</p>
<h3 id="cmakeliststxt"><a class="header" href="#cmakeliststxt"><code>CMakeLists.txt</code></a></h3>
<p>Within the platform specific section of the library <code>CMakeLists.txt</code> file, the variable holding the selected driver for the driver class must be set. For example, if a GPIO driver named <code>gpio_foo</code> has been added for platform <code>foo</code> then the following would be added:</p>
<pre><code class="language-makefile">    # Set up the applicable drivers and platform dependent configuration.
    if(KernelPlatImx8mq)
        ...
    elseif("${KernelPlatform}" STREQUAL "foo")
        # Platform specific settings for the Foo board.
+       set(gpio_driver "gpio_foo")
    else()
        message(FATAL_ERROR "Unsupported platform. Aborting.")
    endif()
</code></pre>
<h3 id="plat_driver_datah"><a class="header" href="#plat_driver_datah"><code>plat_driver_data.h</code></a></h3>
<p>The <code>plat_driver_data.h</code> and <code>plat_driver_data.c</code> files are used to create arrays of objects, such as drivers or commands, that U-Boot normally stores in dedicated linker sections (see <a href="activity/new_driver/uboot_driver_library.html#linker-lists">documentation on linker lists</a> for details). The objects are declared in U-Boot source files via macros of the form <code>U_BOOT_&lt;object_type&gt; = { ... };</code>. All objects that the library needs to access must be declared and enumerated in  <code>plat_driver_data.h</code> and added to the <code>driver_data</code> structure within <code>plat_driver_data.c</code>.</p>
<p>Within the platform's <code>include/plat/&lt;platform&gt;/plat_driver_data.h</code> file, the new objects from the added source files (e.g. driver, UCLASS driver, commands, etc.) need to be declared, and the counts of each class of object needs to be updated. It should be noted that sometimes multiple drivers or UCLASS drivers are required to support a single device.</p>
<p>For example, if a GPIO driver were to be added then it is expected that the GPIO driver, the GPIO UCLASS driver, and the GPIO command objects would be added as follows:</p>
<pre><code class="language-c">extern struct uclass_driver _u_boot_uclass_driver__gpio;
extern struct driver        _u_boot_driver__gpio_foo;
extern struct cmd_tbl       _u_boot_cmd__gpio;
</code></pre>
<p>Each declaration is of the form <code>extern struct &lt;type&gt; _u_boot_&lt;class&gt;__&lt;name&gt;</code> to match the declaration generated by the expansion of the <code>U_BOOT_&lt;object_Type&gt;</code> macro, where:</p>
<ul>
<li><code>&lt;name&gt;</code> is the parameter provided to the macro that declared the object, e.g. a driver is declared with <code>U_BOOT_DRIVER(&lt;name&gt;)</code>;</li>
<li><code>&lt;type&gt;</code> and <code>&lt;class&gt;</code> directly correspond to the type of object. Worked examples of the correct format for each object type are provided in the Avnet MaaXBoard's <code>plat_driver_data.h</code> file. Alternatively, the format for each type of object can be determined from the expansion of the macro for that object type; e.g. for a driver, see the expansion of <code>#define U_BOOT_DRIVER</code>.</li>
</ul>
<h3 id="plat_driver_datac"><a class="header" href="#plat_driver_datac"><code>plat_driver_data.c</code></a></h3>
<p>Within the platform's <code>include/plat/&lt;platform&gt;/plat_driver_data.c</code> file, the objects declared in the <code>plat_driver_data.h</code> file need to be added to the <code>driver_data</code> global structure. A worked example covering multiple object types is provided in the Avnet MaaXBoard's <code>plat_driver_data.c</code> file.</p>
<h2 id="resolving-compilation-issues-1"><a class="header" href="#resolving-compilation-issues-1">Resolving Compilation Issues</a></h2>
<p>At this stage, compilation of the library should be attempted, e.g. through compilation of the <a href="activity/new_driver/../device_drivers/uboot-driver-example.html">uboot-driver-example test application</a>.</p>
<p>It is expected that the set of source files referenced in the library <code>CMakeLists.txt</code> may not be complete, leading to compilation or linker errors;  whilst the source files declaring the driver, UCLASS driver and commands have been added, these may rely upon routines from source files not currently referenced.</p>
<p>For each error some judgement needs to be made:</p>
<ul>
<li>
<p>If the required routine is fundamental to correct operation of the driver (this is the normal case) then the source file should be added to the <code>CMakeLists.txt</code> section for the driver class. It must be determined by the developer whether the source file is likely to be required by all drivers of the driver class or is specific to the driver.</p>
</li>
<li>
<p>If the required routine is not required, e.g. it can be seen that it should never be called or a 'null' implementation would be sufficient, then the routine can be added to the wrapper file <code>src/wrapper/unimplemented.c</code>.</p>
</li>
<li>
<p>If an alternative implementation of the routine / source file needs to be provided, e.g. because the original implementation is incompatible with use within the context of an seL4 user-mode application, then a stub version of the source file can be added to the <code>uboot_stub</code> folder.</p>
</li>
</ul>
<h2 id="updating-sel4-application"><a class="header" href="#updating-sel4-application">Updating seL4 Application</a></h2>
<p>At this stage, the library with the newly added driver should compile cleanly.</p>
<p>What remains is to update the application utilising the library to:</p>
<ol>
<li>
<p>Ensure that seL4 permits access to the necessary devices from the platform's device tree; this is performed through the configuration of the application's CAmkES project file or Microkit's system file. For a worked example, see the  <code>uboot-driver-example.camkes</code> or <code>uboot-driver-example.system</code> file from the <a href="activity/new_driver/../device_drivers/uboot-driver-example.html">uboot-driver-example test application</a>.</p>
</li>
<li>
<p>Provide the identity of those devices from the platform's device tree to the library; this is performed by providing the names of the devices when initialising the library through the <code>initialise_uboot_drivers</code> interface on the library's public API. Note that only those devices from the device tree listed in the call to <code>initialise_uboot_drivers</code> will be used by the library; all other devices in the device tree will be considered to be disabled.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="library-extension---new-driver-worked-example"><a class="header" href="#library-extension---new-driver-worked-example">Library Extension - New Driver Worked Example</a></h1>
<p>A helpful way to show the process of adding a driver is to work through an example step-by-step. The I<sup>2</sup>C driver is relatively straightforward and can be readily tested on the MaaXBoard as there is a power management IC (BD71837MWV) already installed on the board's I<sup>2</sup>C bus. In this worked example, we shall not go as far as installing a driver for the BD71837MWV device itself, but we can probe the I<sup>2</sup>C bus, identify the address of the BD71837MWV device, and perform a sample memory read.</p>
<h2 id="establishing-the-driver"><a class="header" href="#establishing-the-driver">Establishing the driver</a></h2>
<p>The first place to look is the relevant source code for the driver in U-Boot. This file may be identified as follows.</p>
<p>A <code>dm tree</code> command from the U-Boot prompt<sup class="footnote-reference"><a href="#2">1</a></sup> should reveal an <code>i2c</code> entry, which uses driver <code>i2c_mxc</code>.</p>
<pre><code class="language-text"> Class     Index  Probed  Driver                Name
-----------------------------------------------------------
       ...
 i2c           0  [   ]   i2c_mxc                   |   |-- i2c@30a20000
 i2c           1  [   ]   i2c_mxc                   |   |-- i2c@30a30000
</code></pre>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">1</sup>
<p>If the MaaXBoard is powered on and autoboot is interrupted (e.g. press the <code>Enter</code> key during the countdown shown in line 37 of the output in the <a href="activity/new_driver/../first_boot.html#boot-to-u-boot-prompt">First Boot</a> section), then the <code>dm tree</code> command may be entered at the U-Boot prompt.</p>
</div>
<p>A search for <code>i2c_mxc</code> within U-Boot's github repository <a href="https://github.com/u-boot/u-boot">https://github.com/u-boot/u-boot</a> reveals the relevant file to be <code>uboot/drivers/i2c/mxc_i2c.c</code>:</p>
<p><img src="activity/new_driver/../new_driver/figures/github_search_i2c_1.png" alt="i2c GitHub search-1" /></p>
<p><img src="activity/new_driver/../new_driver/figures/github_search_i2c_2.png" alt="i2c GitHub search-2" /></p>
<p>This file is in the equivalent location within our <code>libubootdrivers</code> library, at <code>projects_libs/libubootdrivers/uboot/drivers/i2c/mxc_i2c.c</code>.</p>
<p>In the code snippet from the screenshot above, we can see that the driver relies on the <code>UCLASS_I2C</code> uclass. This is provided by the file <code>i2c-uclass.c</code> in the same directory. At the end of <code>i2c-uclass.c</code>, we can see that driver and the other relevant drivers:</p>
<pre><code class="language-c">UCLASS_DRIVER(i2c) = {
    .id = UCLASS_I2C,
    .name = "i2c",
    ...

UCLASS_DRIVER(i2c_generic) = {
    .id = UCLASS_I2C_GENERIC,
    .name = "i2c_generic",
    ...

U_BOOT_DRIVER(i2c_generic_chip_drv) = {
    .name = "i2c_generic_chip_drv",
    .id = UCLASS_I2C_GENERIC,
    ...
</code></pre>
<p>This provides the driver references that we need to add to <code>libubootdrivers</code> via <code>projects_libs/libubootdrivers/include/plat/maaxboard/plat_driver_data.h</code>:</p>
<pre><code class="language-c">/* Define the uclass drivers to be used on this platform */
...
extern struct uclass_driver _u_boot_uclass_driver__i2c;
extern struct uclass_driver _u_boot_uclass_driver__i2c_generic;

/* Define the drivers to be used on this platform */
...
extern struct driver _u_boot_driver__i2c_mxc;
extern struct driver _u_boot_driver__i2c_generic_chip_drv;
...
</code></pre>
<p>and <code>projects_libs/libubootdrivers/src/plat/maaxboard/plat_driver_data.c</code>:</p>
<pre><code class="language-c">void initialise_driver_data(void) {
    ...
    driver_data.uclass_driver_array[17] = _u_boot_uclass_driver__i2c;
    driver_data.uclass_driver_array[18] = _u_boot_uclass_driver__i2c_generic;
    ...
    driver_data.driver_array[19] = _u_boot_driver__i2c_mxc;
    driver_data.driver_array[20] = _u_boot_driver__i2c_generic_chip_drv;
    ...
</code></pre>
<p>We can see that the latter change has added to the arrays. In this example, the two arrays had previously extended to elements [16] and [18] respectively. The increased sizes need to be reflected back in <code>libubootdrivers/include/plat/maaxboard/plat_driver_data.h</code> by increasing the size counts:</p>
<pre><code class="language-c">/* Define the number of different driver elements to be used on this platform */
#define _u_boot_uclass_driver_count  19  // In this example previous count was 17, so +2
#define _u_boot_driver_count         21  // In this example previous count was 19, so +2
...
</code></pre>
<p>In order to build the new driver files, we need to add them to the <code>libubootdrivers/CMakeLists.txt</code> makefile.</p>
<p>There are also some U-Boot configuration macros relevant to I<sup>2</sup>C that are needed, which are also set within the makefile. In this example, we can use the guidance in the <a href="activity/new_driver/main.html#updating-cmakeliststxt">Library Extension - New Driver</a> section, and refer to the <code>.config</code> file created during the <a href="activity/new_driver/../../install_and_configure/building_uboot_manually.html">Building U-Boot for the MaaXBoard</a> document. Using the suggested directory name from that document, the filepath would be: <code>maaxboard_dockerimage/maaxboard-uboot-build/maaxboard-uboot/uboot-imx/.config</code>.</p>
<p>Extracting I2C-related items (e.g. using <code>grep -i I2C .config</code>), we would see:</p>
<pre><code class="language-text">CONFIG_SYS_I2C_MXC_I2C1=y
CONFIG_SYS_I2C_MXC_I2C2=y
CONFIG_SYS_I2C_MXC_I2C3=y
# CONFIG_SYS_I2C_MXC_I2C4 is not set
CONFIG_SPL_I2C_SUPPORT=y
CONFIG_CMD_I2C=y
# I2C support
CONFIG_DM_I2C=y
# CONFIG_I2C_SET_DEFAULT_BUS_NUM is not set
# CONFIG_DM_I2C_GPIO is not set
# CONFIG_SYS_I2C_IPROC is not set
# CONFIG_SYS_I2C_FSL is not set
# CONFIG_SYS_I2C_CADENCE is not set
# CONFIG_SYS_I2C_DW is not set
# CONFIG_SYS_I2C_INTEL is not set
# CONFIG_SYS_I2C_IMX_LPI2C is not set
# CONFIG_SYS_I2C_IMX_VIRT_I2C is not set
CONFIG_SYS_I2C_MXC=y
# CONFIG_SYS_I2C_MXC_I2C5 is not set
# CONFIG_SYS_I2C_MXC_I2C6 is not set
# CONFIG_SYS_I2C_MXC_I2C7 is not set
# CONFIG_SYS_I2C_MXC_I2C8 is not set
CONFIG_SYS_MXC_I2C1_SPEED=100000
CONFIG_SYS_MXC_I2C1_SLAVE=0
CONFIG_SYS_MXC_I2C2_SPEED=100000
CONFIG_SYS_MXC_I2C2_SLAVE=0
CONFIG_SYS_MXC_I2C3_SPEED=100000
CONFIG_SYS_MXC_I2C3_SLAVE=0
# CONFIG_SYS_I2C_NEXELL is not set
# CONFIG_SYS_I2C_OCORES is not set
# CONFIG_SYS_I2C_ROCKCHIP is not set
# CONFIG_SYS_I2C_MVTWSI is not set
# CONFIG_SYS_I2C_XILINX_XIIC is not set
# CONFIG_SYS_I2C_IHS is not set
# CONFIG_I2C_MUX is not set
# CONFIG_I2C_EDID is not set
</code></pre>
<p>Removing (most of) the commented items and reordering slightly leaves:</p>
<pre><code class="language-text">CONFIG_CMD_I2C=y
CONFIG_DM_I2C=y
CONFIG_SYS_I2C_MXC=y
CONFIG_SYS_I2C_MXC_I2C1=y
CONFIG_SYS_I2C_MXC_I2C2=y
CONFIG_SYS_I2C_MXC_I2C3=y
CONFIG_SYS_MXC_I2C1_SPEED=100000
CONFIG_SYS_MXC_I2C1_SLAVE=0
CONFIG_SYS_MXC_I2C2_SPEED=100000
CONFIG_SYS_MXC_I2C2_SLAVE=0
CONFIG_SYS_MXC_I2C3_SPEED=100000
CONFIG_SYS_MXC_I2C3_SLAVE=0
# CONFIG_SYS_I2C_MXC_I2C4 is not set
CONFIG_SPL_I2C_SUPPORT=y
</code></pre>
<p>This is an excellent starting point and may well be complete; however, we may still need to apply some reasoning. For example, we do not need the final item (although it would do no harm), as SPL is only used when compiling the secondary bootloader and <code>CONFIG_SPL_I2C_SUPPORT</code> does not appear in our U-Boot code. The penultimate item concerning I2C4 (currently commented) is inaccurate and is an omission from this <code>maaxboard-uboot/uboot-imx</code> build. Examining the DTS file <code>maaxboard.dts</code> confirms that there are four I<sup>2</sup>C buses, so we will include a set of I2C4 macros. Note that, although inconsistent, it is not an issue that these macros use I2C1-I2C4 labels, whereas the DTS labels them 0-3. Our convention, such as in the following <a href="activity/new_driver/add_driver_worked_example.html#integrating-the-driver">CAmkES</a> section, will be to use 0-3 labels.</p>
<p>Combining the previous paragraphs, we update the <code>libubootdrivers/CMakeLists.txt</code> makefile as follows (showing only extracts relevant to I<sup>2</sup>C).</p>
<p>The <code>i2c_driver</code> variable, which by default is <code>"none"</code>, is set to <code>"i2c_mxc"</code>:</p>
<pre><code class="language-makefile"># Set up the applicable drivers and platform dependent configuration.
if(KernelPlatImx8mq)
...
    # Define the drivers used for this platform
    ...
    set(i2c_driver "i2c_mxc")
    ...
</code></pre>
<p>Then a new section is added to handle this:</p>
<pre><code class="language-makefile">...
############################
# Settings for I2C drivers #
############################

if(i2c_driver MATCHES "none")
    # Nothing to do
else()
    # Enable I2C support
    add_definitions("-DCONFIG_DM_I2C=1")
    # Generic I2C source files
    list(APPEND uboot_deps uboot/drivers/i2c/i2c-uclass.c)

    # Driver specific settings / files
    if(i2c_driver MATCHES "i2c_mxc")
        add_definitions("-DCONFIG_SYS_I2C_MXC=1")
        add_definitions("-DCONFIG_SYS_I2C_MXC_I2C1=1")
        add_definitions("-DCONFIG_SYS_I2C_MXC_I2C2=1")
        add_definitions("-DCONFIG_SYS_I2C_MXC_I2C3=1")
        add_definitions("-DCONFIG_SYS_I2C_MXC_I2C4=1")
        add_definitions("-DCONFIG_SYS_MXC_I2C1_SPEED=100000")
        add_definitions("-DCONFIG_SYS_MXC_I2C1_SLAVE=0")
        add_definitions("-DCONFIG_SYS_MXC_I2C2_SPEED=100000")
        add_definitions("-DCONFIG_SYS_MXC_I2C2_SLAVE=0")
        add_definitions("-DCONFIG_SYS_MXC_I2C3_SPEED=100000")
        add_definitions("-DCONFIG_SYS_MXC_I2C3_SLAVE=0")
        add_definitions("-DCONFIG_SYS_MXC_I2C4_SPEED=100000")
        add_definitions("-DCONFIG_SYS_MXC_I2C4_SLAVE=0")

        list(APPEND uboot_deps uboot/drivers/i2c/mxc_i2c.c)
    else()
        message(FATAL_ERROR "Unrecognised I2C driver. Aborting.")
    endif()
endif()
</code></pre>
<p>The <code>list(APPEND uboot_deps ...)</code> lines add the driver files that were identified earlier, ensuring that they are picked out from the rest of the files held in the <code>libubootdrivers/uboot</code> directory and compiled. When they are compiled, they will require extra header files, but those will be picked up automatically from the <code>uboot</code> directory.</p>
<p>The <code>add_definitions</code> lines establish the configuration macros. Note that <code>CONFIG_CMD_I2C</code>, which was in our previous list of candidates, has been excluded, but only until we discuss it further in the forthcoming <a href="activity/new_driver/add_driver_worked_example.html#establishing-the-driver-api">API</a> section.</p>
<p>After these changes, within our <code>build</code> directory, <code>init_build</code> followed by <code>ninja</code> should result in a clean build.</p>
<h2 id="integrating-the-driver"><a class="header" href="#integrating-the-driver">Integrating the driver:</a></h2>
<h3 id="camkes-4"><a class="header" href="#camkes-4">CAmkES</a></h3>
<p>We have established the underlying driver code, but it is not yet integrated within the CAmkES component that we shall be using. Assuming that we use the <a href="activity/new_driver/../device_drivers/uboot-driver-example.html">uboot-driver-example test application</a> introduced earlier – see <a href="activity/new_driver/../device_drivers/uboot_driver_usage.html#instructions-for-running-the-uboot-driver-example-test">Using the U-Boot Driver Library</a> – we need to modify the file <code>camkes/apps/uboot-driver-example/include/plat/maaxboard/platform_devices.h</code> as follows.</p>
<p>Firstly, we need to add path definitions so that the devices can be located in the device tree:</p>
<pre><code class="language-c">#define REG_I2C_0_PATH      "/soc@0/bus@30800000/i2c@30a20000"
#define REG_I2C_1_PATH      "/soc@0/bus@30800000/i2c@30a30000"
#define REG_I2C_2_PATH      "/soc@0/bus@30800000/i2c@30a40000"
#define REG_I2C_3_PATH      "/soc@0/bus@30800000/i2c@30a50000"
...
#define DEV_I2C_0_PATH      REG_I2C_0_PATH
#define DEV_I2C_1_PATH      REG_I2C_1_PATH
#define DEV_I2C_2_PATH      REG_I2C_2_PATH
#define DEV_I2C_3_PATH      REG_I2C_3_PATH
</code></pre>
<p>These need to be added to <code>DEV_PATHS</code> and <code>DEV_PATH_COUNT</code> should be modified accordingly:</p>
<pre><code class="language-c">#define DEV_PATH_COUNT 19 // In this example previous size was 15 so +4

#define DEV_PATHS {   \
    ...               \
    DEV_I2C_0_PATH,   \
    DEV_I2C_1_PATH,   \
    DEV_I2C_2_PATH,   \
    DEV_I2C_3_PATH,   \
    ...
    };
</code></pre>
<p>Entries for the devices need to be added to <code>HARDWARE_INTERFACES</code>:</p>
<pre><code class="language-c">#define HARDWARE_INTERFACES  \
    ...                      \
    consumes Dummy i2c_0;    \
    consumes Dummy i2c_1;    \
    consumes Dummy i2c_2;    \
    consumes Dummy i2c_3;    \
    ...                      \
    emits Dummy dummy_source;
</code></pre>
<p>And also added to <code>HARDWARE_COMPOSITION</code>:</p>
<pre><code class="language-c">#define HARDWARE_COMPOSITION                                             \
    ...                                                                  \
    connection seL4DTBHardware i2c_0_conn(from dummy_source, to i2c_0);  \
    connection seL4DTBHardware i2c_1_conn(from dummy_source, to i2c_1);  \
    connection seL4DTBHardware i2c_2_conn(from dummy_source, to i2c_2);  \
    connection seL4DTBHardware i2c_3_conn(from dummy_source, to i2c_3);  \
    ...
</code></pre>
<p>And also added to <code>HARDWARE_CONFIGURATION</code>:</p>
<pre><code class="language-c">#define HARDWARE_CONFIGURATION                         \
    ...                                                \
    i2c_0.dtb     = dtb({ "path" : REG_I2C_0_PATH });  \
    i2c_1.dtb     = dtb({ "path" : REG_I2C_1_PATH });  \
    i2c_2.dtb     = dtb({ "path" : REG_I2C_2_PATH });  \
    i2c_3.dtb     = dtb({ "path" : REG_I2C_3_PATH });  \
    ...
</code></pre>
<h3 id="microkit-4"><a class="header" href="#microkit-4">Microkit</a></h3>
<p>We have established the underlying driver code, but it is not yet integrated within the Microkit protection domain that we shall be using. Assuming that we use the <a href="activity/new_driver/../device_drivers/uboot-driver-example.html">uboot-driver-example test application</a> introduced earlier – see <a href="activity/new_driver/../device_drivers/uboot_driver_usage.html#instructions-for-running-the-uboot-driver-example-test">Using the U-Boot Driver Library</a> – we need to modify the file <code>project_libs/include/plat/maaxboard/all_platform_devices.h</code> as follows.</p>
<p>Firstly, we need to add path definitions so that the devices can be located in the device tree:</p>
<pre><code class="language-c">#define REG_I2C_0_PATH      "/soc@0/bus@30800000/i2c@30a20000"
#define REG_I2C_1_PATH      "/soc@0/bus@30800000/i2c@30a30000"
#define REG_I2C_2_PATH      "/soc@0/bus@30800000/i2c@30a40000"
#define REG_I2C_3_PATH      "/soc@0/bus@30800000/i2c@30a50000"
...
#define DEV_I2C_0_PATH      REG_I2C_0_PATH
#define DEV_I2C_1_PATH      REG_I2C_1_PATH
#define DEV_I2C_2_PATH      REG_I2C_2_PATH
#define DEV_I2C_3_PATH      REG_I2C_3_PATH
</code></pre>
<p>These need to be added to <code>DEV_PATHS</code> and <code>DEV_PATH_COUNT</code> should be modified accordingly:</p>
<pre><code class="language-c">#define DEV_PATH_COUNT 19 // In this example previous size was 15 so +4

#define DEV_PATHS {   \
    ...               \
    DEV_I2C_0_PATH,   \
    DEV_I2C_1_PATH,   \
    DEV_I2C_2_PATH,   \
    DEV_I2C_3_PATH,   \
    ...
    };
</code></pre>
<h2 id="establishing-the-driver-api"><a class="header" href="#establishing-the-driver-api">Establishing the driver API</a></h2>
<p>We now need to work on the driver's API. We are going to access the driver via the U-Boot <code>i2c</code> command, such as is available at the U-Boot command line:</p>
<pre><code class="language-text">u-boot=&gt; i2c
i2c - I2C sub-system

Usage:
i2c bus [muxtype:muxaddr:muxchannel] - show I2C bus info
i2c crc32 chip address[.0, .1, .2] count - compute CRC32 checksum
i2c dev [dev] - show or set current I2C bus
i2c loop chip address[.0, .1, .2] [# of objects] - looping read of device
i2c md chip address[.0, .1, .2] [# of objects] - read from I2C device
i2c mm chip address[.0, .1, .2] - write to I2C device (auto-incrementing)
i2c mw chip address[.0, .1, .2] value [count] - write to I2C device (fill)
i2c nm chip address[.0, .1, .2] - write to I2C device (constant address)
i2c probe [address] - test for and show device(s) on the I2C bus
i2c read chip address[.0, .1, .2] length memaddress - read to memory
i2c write memaddress chip address[.0, .1, .2] length [-s] - write memory
          to I2C; the -s option selects bulk write in a single transaction
i2c flags chip [flags] - set or get chip flags
i2c olen chip [offset_length] - set or get chip offset length
i2c reset - re-init the I2C Controller
i2c speed [speed] - show or set I2C bus speed
u-boot=&gt;
</code></pre>
<p>We return to <code>libubootdrivers/src/plat/maaxboard/plat_driver_data.c</code> to add a new entry to the <code>cmd_array</code>:</p>
<pre><code class="language-c">void initialise_driver_data(void) {
    ...
    driver_data.cmd_array[16] = _u_boot_cmd__i2c;
    ...
</code></pre>
<p>Corresponding changes are made in <code>libubootdrivers/include/plat/maaxboard/plat_driver_data.h</code>:</p>
<pre><code class="language-c">/* Define the number of different driver elements to be used on this platform */
...
#define _u_boot_cmd_count  17  // In this example previous count was 16, so +1
...

/* Define the u-boot commands to be used on this platform */
...
extern struct cmd_tbl _u_boot_cmd__i2c;
...
</code></pre>
<p>We need to pull in the U-Boot source code for the <code>i2c</code> command from the file <code>i2c.c</code> (<code>projects_libs/libubootdrivers/uboot/cmd/i2c.c</code>).</p>
<p>As with the previous addition of <code>.c</code> files, this needs to be added to the <code>libubootdrivers/CMakeLists.txt</code> makefile, along with the CMD configuration macro that we identified earlier. The previous extract from the makefile is repeated below, with two additional lines marked.</p>
<pre><code class="language-makefile">    ############################
    # Settings for I2C drivers #
    ############################

    if(i2c_driver MATCHES "none")
        # Nothing to do
    else()
        # Enable I2C support
+       add_definitions("-DCONFIG_CMD_I2C=1")
        add_definitions("-DCONFIG_DM_I2C=1")
        # Generic I2C source files
+       list(APPEND uboot_deps uboot/cmd/i2c.c)
        list(APPEND uboot_deps uboot/drivers/i2c/i2c-uclass.c)

        # Driver specific settings / files
        if(i2c_driver MATCHES "i2c_mxc")
            add_definitions("-DCONFIG_SYS_I2C_MXC=1")
            add_definitions("-DCONFIG_SYS_I2C_MXC_I2C1=1")
            add_definitions("-DCONFIG_SYS_I2C_MXC_I2C2=1")
            add_definitions("-DCONFIG_SYS_I2C_MXC_I2C3=1")
            add_definitions("-DCONFIG_SYS_I2C_MXC_I2C4=1")
            add_definitions("-DCONFIG_SYS_MXC_I2C1_SPEED=100000")
            add_definitions("-DCONFIG_SYS_MXC_I2C1_SLAVE=0")
            add_definitions("-DCONFIG_SYS_MXC_I2C2_SPEED=100000")
            add_definitions("-DCONFIG_SYS_MXC_I2C2_SLAVE=0")
            add_definitions("-DCONFIG_SYS_MXC_I2C3_SPEED=100000")
            add_definitions("-DCONFIG_SYS_MXC_I2C3_SLAVE=0")
            add_definitions("-DCONFIG_SYS_MXC_I2C4_SPEED=100000")
            add_definitions("-DCONFIG_SYS_MXC_I2C4_SLAVE=0")

            list(APPEND uboot_deps uboot/drivers/i2c/mxc_i2c.c)
        else()
            message(FATAL_ERROR "Unrecognised I2C driver. Aborting.")
        endif()
    endif()
</code></pre>
<p>Within our <code>build</code> directory, after <code>init_build</code> and <code>ninja</code>, this should build successfully.</p>
<h2 id="testing-the-driver"><a class="header" href="#testing-the-driver">Testing the driver</a></h2>
<p>Now that we have the I<sup>2</sup>C driver and its API, we can call <code>i2c</code> commands from our test application. For example, the following lines can be used within a CAmkES component or Microkit PD (in our example, these would be added to file <code>camkes/apps/uboot-driver-example/components/Test/src/test.c</code> or <code>examples/maaxboard/uboot_driver_example/uboot_driver_example.c</code>):</p>
<pre><code class="language-c">    // I2C test
    run_uboot_command("i2c dev 0"); // Set current i2c bus to zero
    run_uboot_command("i2c probe"); // Probe i2c bus 0
</code></pre>
<p>On the MaaXBoard, the <code>i2c probe</code> command returns <code>Valid chip addresses: 4B</code>, which is the address of the BD71837MWV power management IC on the bus. Extending the test case as follows:</p>
<pre><code class="language-c">    // I2C test
    run_uboot_command("i2c dev 0"); // Set current i2c bus to zero
    run_uboot_command("i2c probe"); // Probe i2c bus 0
    run_uboot_command("i2c md 0x4b 0x0.1 0x20"); // Read 32 bytes from device at address 0x4b
    run_uboot_command("dm tree");
</code></pre>
<p>will read the first 32 bytes from the BD71837MWV, displaying:</p>
<pre><code class="language-text">0000: a3 04 03 a2 00 40 40 44 44 00 00 00 00 14 14 14    .....@@DD.......
0010: 1e 14 1e 1e 02 03 03 28 03 00 00 00 00 00 0f 48    .......(.......H
</code></pre>
<p>Before the <code>i2c probe</code>, a <code>dm tree</code> command would reveal the presence of the <code>i2c_mxc</code> driver:</p>
<pre><code class="language-text"> Class     Index  Probed  Driver                Name
-----------------------------------------------------------
       ...
 i2c           0  [   ]   i2c_mxc               |   |   |-- i2c@30a20000
 i2c           1  [   ]   i2c_mxc               |   |   |-- i2c@30a30000
 i2c           2  [   ]   i2c_mxc               |   |   |-- i2c@30a40000
 i2c           3  [   ]   i2c_mxc               |   |   |-- i2c@30a50000
</code></pre>
<p>Following the <code>i2c probe</code>, the <code>dm tree</code> command shows the instantiation of the <code>i2c_generic_chip_drv</code> driver that we ported earlier:</p>
<pre><code class="language-text"> Class     Index  Probed  Driver                Name
-----------------------------------------------------------
       ...
 i2c           0  [ + ]   i2c_mxc               |   |   |-- i2c@30a20000
 i2c_generi    0  [ + ]   i2c_generic_chip_drv  |   |   |   `-- generic_4b
 i2c           1  [   ]   i2c_mxc               |   |   |-- i2c@30a30000
 i2c           2  [   ]   i2c_mxc               |   |   |-- i2c@30a40000
 i2c           3  [   ]   i2c_mxc               |   |   |-- i2c@30a50000
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="library-extension---troubleshooting"><a class="header" href="#library-extension---troubleshooting">Library Extension - Troubleshooting</a></h1>
<p>This section attempts to provide guidance to help resolve issues that may be encountered when adding new device drivers to the library.</p>
<h2 id="increase-logging"><a class="header" href="#increase-logging">Increase logging</a></h2>
<p>Whenever an issue is encountered, one of the simplest actions that can be taken to provide additional data is to increase the verbosity of the library's output.</p>
<p>The library's logging level is controlled by the <code>LIB_UBOOT_LOGGING_LEVEL</code> variable in the library <code>CMakeLists.txt</code> file:</p>
<pre><code class="language-makefile">set(LIB_UBOOT_LOGGING_LEVEL "ZF_LOG_INFO")
</code></pre>
<p>This can be increased by changing the default <code>ZF_LOG_INFO</code> level to a higher logging level, e.g. <code>ZF_LOG_DEBUG</code> or <code>ZF_LOG_VERBOSE</code>.</p>
<h2 id="dma-1"><a class="header" href="#dma-1">DMA</a></h2>
<p>As documented in the <a href="activity/new_driver/../device_drivers/uboot_driver_library.html#dma">library overview</a> section, drivers utilising DMA may need manual modifications.</p>
<h3 id="detecting-dma-usage"><a class="header" href="#detecting-dma-usage">Detecting DMA usage</a></h3>
<p>When adding support for a new device and associated driver, it should be determined whether the driver utilises DMA.</p>
<p>The single most reliable method for determining DMA usage is to read and understand the device reference manual; however, there are a number of strong indicators from the U-Boot source code that can assist, such as:</p>
<ol>
<li>
<p>Search the driver source code for references to <code>DMA</code>.</p>
</li>
<li>
<p>Allocation of aligned memory (i.e. usage of <code>memalign</code>). Memory allocated with the intent of being used for DMA transfers tends to be aligned on cache line boundaries. Examples of U-Boot source code allocating memory for DMA are <code>ptr = memalign(cachline_size, ...)</code> and <code>tmp = memalign(ARCH_DMA_MINALIGN, ...)</code>.</p>
</li>
<li>
<p>Data cache flushing or invalidation (i.e. usage of <code>flush_dcache_range</code> and <code>invalidate_dcache_range</code>). Such manipulation of the data cache is a strong indicator that the associated memory is utilised for communication with a device.</p>
</li>
</ol>
<h3 id="resolving-dma-issues"><a class="header" href="#resolving-dma-issues">Resolving DMA issues</a></h3>
<p>Once it has been determined that an area of memory is being used by the driver for DMA purposes, it must be converted to use an seL4 DMA region.</p>
<p>Where the memory is managed through standard <code>malloc</code>, <code>memalign</code>, and <code>free</code>, these must be converted to the directly equivalent routines <code>sel4_dma_malloc</code>, <code>sel4_dma_memalign</code>, and <code>sel4_dma_free</code> provided by the library wrapper. Note that no changes are required to usage of <code>flush_dcache_range</code> and <code>invalidate_dcache_range</code>; these routines are automatically mapped to the seL4 DMA equivalents by the library wrapper.</p>
<p>In cases where the existing memory allocation cannot be easily modified, e.g. the memory was allocated by a variable declaration on the stack or is only used for DMA in limited cases, then an alternative approach can be taken. Prior to communicating the DMA address to the device (usually performed via memory-mapped IO) a DMA region can be allocated to mirror the original memory and the data manually copied between them as required.</p>
<p>If a driver performs conversions between the DMA region's virtual and physical addresses, such conversions must be replaced with usage of the <code>sel4_dma_virt_to_phys</code> and <code>sel4_dma_phys_to_virt</code> routines provided by the library wrapper.</p>
<h3 id="worked-examples"><a class="header" href="#worked-examples">Worked Examples</a></h3>
<p>All of the above techniques have been used in the modifications made to the Ethernet driver file <code>drivers/net/fec_mxc.c</code> in <a href="https://github.com/sel4devkit/u-boot/commit/6a4512f1d3b8427a4e192a14c52319a6228c7bbe">this Git commit</a>:</p>
<ul>
<li>Within routine <code>fec_alloc_descs</code>, calls to <code>memalign</code> have been replaced with <code>sel4_dma_memalign</code>.</li>
<li>Within routine <code>fec_free_descs</code>, the corresponding calls to <code>free</code> have been replaced with <code>sel4_dma_free</code>.</li>
<li>Within routine <code>fecmxc_send</code>, an seL4 DMA region is allocated to mirror the contents of the provided packet (and subsequently freed in <code>fecmxc_free_pkt</code>).</li>
<li>Address translations using <code>sel4_dma_virt_to_phys</code> and <code>sel4_dma_phys_to_virt</code> are performed around use of the <code>.data_pointer</code> pointers into the receive buffers (which are communicated with the device) to ensure that the device is only sent the physical address of the DMA region.</li>
</ul>
<h2 id="live-device-tree-support"><a class="header" href="#live-device-tree-support">Live Device Tree support</a></h2>
<p>As documented in the <a href="activity/new_driver/../device_drivers/uboot_driver_library.html#library-limitations">library overview</a> section, the library only supports drivers that are compatible with U-Boot's live tree format for holding the device tree.</p>
<p>Guidance on porting an old driver to the live device tree interface is provided <a href="https://u-boot.readthedocs.io/en/latest/develop/driver-model/livetree.html#porting-drivers">here</a>.</p>
<p>A worked example of porting can be seen in the Pin Multiplexing driver file <code>drivers/pinctrl/nxp/pinctrl-imx.c</code> in <a href="https://github.com/sel4devkit/u-boot/commit/6a4512f1d3b8427a4e192a14c52319a6228c7bbe">this Git commit</a>.</p>
<h2 id="missing-initialisation"><a class="header" href="#missing-initialisation">Missing Initialisation</a></h2>
<p>When a new device class has been added to the library, it may be necessary to perform explicit initialisation of the associated U-Boot subsystems. Currently this has only been required for the Ethernet and MMC device classes as shown below in the extract from <code>uboot_wrapper.c</code>:</p>
<pre><code class="language-c">int initialise_uboot_wrapper(char* fdt_blob)
{
    ...

#ifdef CONFIG_DM_MMC
    // Initialize the MMC system.
    ret = mmc_initialize(NULL);
    if (0 != ret)
        goto error;
#endif

#ifdef CONFIG_NET
    // Initialize the ethernet system.
    puts("Net:   ");
    eth_initialize();
#ifdef CONFIG_RESET_PHY_R
    debug("Reset Ethernet PHY\n");
    reset_phy();
#endif
#endif

    ...
}
</code></pre>
<p>Whether initialisation is required, and the required initialisation, can be determined by referencing U-Boot's own initialisation code held in U-Boot source file <code>common/board_r.c</code>.</p>
<h2 id="environment-variables-not-working"><a class="header" href="#environment-variables-not-working">Environment Variables Not Working</a></h2>
<p>Setting or changing certain environment variables in U-Boot can trigger callback routines. If these callback routines are not called then the setting of the environment variable will appear to have no effect.</p>
<p>Environment variable callbacks are declared by the U-Boot macro <code>U_BOOT_ENV_CALLBACK</code> and need to be referenced in the platform's <code>plat_driver_data.h</code> and <code>plat_driver_data.c</code> files, if required.</p>
<p>An example of this are the callbacks associated with networking related environment variables (e.g. setting of the IP address). The following excerpts from the Avnet MaaXBoard's <code>plat_driver_data.h</code> and <code>plat_driver_data.c</code> enable all networking related callbacks:</p>
<pre><code class="language-c">#define _u_boot_env_clbk_count 8
...
extern struct env_clbk_tbl _u_boot_env_clbk__ethaddr;
extern struct env_clbk_tbl _u_boot_env_clbk__ipaddr;
extern struct env_clbk_tbl _u_boot_env_clbk__gatewayip;
extern struct env_clbk_tbl _u_boot_env_clbk__netmask;
extern struct env_clbk_tbl _u_boot_env_clbk__serverip;
extern struct env_clbk_tbl _u_boot_env_clbk__nvlan;
extern struct env_clbk_tbl _u_boot_env_clbk__vlan;
extern struct env_clbk_tbl _u_boot_env_clbk__dnsip;
</code></pre>
<pre><code class="language-c">void initialise_driver_data(void) {
    ...
    driver_data.env_clbk_array[0] = _u_boot_env_clbk__ethaddr;
    driver_data.env_clbk_array[1] = _u_boot_env_clbk__ipaddr;
    driver_data.env_clbk_array[2] = _u_boot_env_clbk__gatewayip;
    driver_data.env_clbk_array[3] = _u_boot_env_clbk__netmask;
    driver_data.env_clbk_array[4] = _u_boot_env_clbk__serverip;
    driver_data.env_clbk_array[5] = _u_boot_env_clbk__nvlan;
    driver_data.env_clbk_array[6] = _u_boot_env_clbk__vlan;
    driver_data.env_clbk_array[7] = _u_boot_env_clbk__dnsip;
}
</code></pre>
<h2 id="incomplete-device-tree"><a class="header" href="#incomplete-device-tree">Incomplete Device Tree</a></h2>
<p>Device drivers commonly access settings stored within the platform's Device Tree. If the device does not appear to be functioning, it can be related to information missing from the Device Tree; such issues can be resolved by including the missing information in the platform's Device Tree overlay.</p>
<p>If the Device Tree is suspected of being incomplete it is suggested that the equivalent entries could be compared from Device Tree files for similar platforms (e.g. those using the same or similar SoC) held within the Linux and U-Boot repositories.</p>
<h3 id="example---dwc3-generic-usb-driver"><a class="header" href="#example---dwc3-generic-usb-driver">Example - DWC3 Generic USB Driver</a></h3>
<p>The widely used DWC3 USB device is supported by the DWC3 Generic USB driver. This driver has been found to expect a specific format of the USB device entries in the device tree with some settings held within a sub-node. Without the correct format, the USB device will not function.</p>
<p>An example of the required format is provided in the <a href="https://github.com/seL4/seL4/blob/master/src/plat/maaxboard/overlay-maaxboard.dts">overlay file for the Avnet MaaXBoard</a>.</p>
<h3 id="example---missing-pin-multiplexing-settings"><a class="header" href="#example---missing-pin-multiplexing-settings">Example - Missing Pin Multiplexing Settings</a></h3>
<p>Another potential reason for a non-functioning device is a failure to correctly configure the SoC's pin multiplexer, thereby failing to correctly connect the device to the external pins / pads on the SoC. This issue was encountered when adding SPI support for the Avnet MaaXBoard.</p>
<p>Pin multiplexing settings are held within <code>pinctrl-&lt;index&gt;</code> properties in the Device Tree, for example:</p>
<pre><code class="language-text">i2c@30a20000 {
    compatible = "fsl,imx8mq-i2c\0fsl,imx21-i2c";
    ...
    pinctrl-names = "default";
    pinctrl-0 = &lt;0x25&gt;;
</code></pre>
<p>Note that not all devices require pin multiplexer settings; e.g. device outputs may be routed to dedicated SoC pins / pads. The SoC's reference manual should be consulted to determine whether configuration is required for a device.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="guide-to-porting-sel4"><a class="header" href="#guide-to-porting-sel4">Guide to Porting seL4</a></h1>
<p>The level of work required and complexity of porting seL4 to a new platform is directly related to the level of similarity between the system to be ported and systems already supported by seL4. Porting seL4 to a new system based upon a SoC (system-on-chip) already supported by seL4 is likely to be relatively straightforward whilst porting seL4 to a system with a currently unsupported SoC is likely to require more work, e.g. requiring the addition of new serial and timer drivers.</p>
<p>As a starting point the user should read and understand the excellent guidance on porting supplied by the seL4 Foundation at <a href="https://docs.sel4.systems/projects/sel4/porting.html">this link</a>.</p>
<p>The remainder of this section does not seek to repeat any information in the seL4 documentation; instead it provides more detailed guidance and worked examples based upon the experience of porting seL4 to the Avnet MaaXBoard.</p>
<h2 id="device-tree-dts"><a class="header" href="#device-tree-dts">Device Tree (DTS)</a></h2>
<p>A device tree (DTS file) contains plain text data that describes a platform's hardware. A key requirement in porting seL4 to a new platform is the provision of a device tree describing the platform. A device tree can normally either be sourced from the Linux kernel or from a Linux distribution supplied by the platform manufacturer.</p>
<p>Device tree files are stored within the Linux kernel within the <code>/arch/&lt;arch_identifier&gt;/boot/dts</code> folders. For example, for ARM based devices DTS files may be retrieved from <a href="https://github.com/torvalds/linux/tree/master/arch/arm/boot/dts">this link</a>.</p>
<p>Support has not been incorporated into the mainline Linux kernel for the Avnet MaaXBoard, and therefore the device tree needed to be sourced from the platform-specific Linux distribution supplied by Avnet at <a href="https://github.com/Avnet/linux-imx/blob/maaxboard_5.4.24_2.1.0/arch/arm64/boot/dts/freescale/maaxboard-base.dts">this link</a>.</p>
<p>Once a DTS file has been located it needs to be processed into a form suitable for inclusion in seL4, e.g. to remove use of C-style includes and macros. For the Avnet MaaXBoard this processing was performed using the following commands to generate DTS file named <code>maaxboard.dts</code>. It is expected the commands should be easily modifiable for other boards and sources of the Linux kernel. The following commands to be are executed within the <a href="activity/guide_to_porting_seL4/../install_and_configure/build_environment_setup.html">build environment</a> (i.e. the Docker container).</p>
<pre><code class="language-text">git clone https://github.com/Avnet/linux-imx.git
cd linux-imx
cpp -nostdinc -I include -I arch -undef -x assembler-with-cpp \
   arch/arm64/boot/dts/freescale/maaxboard-base.dts temp.dts
dtc -o temp.dtb temp.dts
dtc -o maaxboard.dts temp.dtb
</code></pre>
<p>Following creation of the platform's DTS file it should be stored in the <code>boards</code> directory</p>
<h2 id="previous-worked-examples"><a class="header" href="#previous-worked-examples">Previous Worked Examples</a></h2>
<p>To help fully understand the guidance supplied by the seL4 documentation, it is informative to examine the changes made previously to the seL4 repositories to support new platforms. To that end the following links are to commits in the seL4 git repositories where support for platforms was added. It should be noted that to perform a basic port of seL4 to a new platform, i.e. sufficient to run and pass the seL4Test application, will require modification to the <a href="https://github.com/seL4/seL4"><code>seL4</code></a>, <a href="https://github.com/seL4/seL4_tools"><code>seL4_tools</code></a> and <a href="https://github.com/seL4/util_libs"><code>util_libs</code></a> git repositories.</p>
<ul>
<li>
<p>Avnet MaaXBoard - Port to platform with existing SoC support</p>
<ul>
<li><a href="https://github.com/seL4/seL4/commit/55fde27e103d7d4a3eda5eba2bf70fc4234b7e8f">seL4 commit</a></li>
<li><a href="https://github.com/seL4/seL4_tools/commit/2f15ba2dc6a08c30b74c722b0673131d2aab32ac">seL4_tools commit</a></li>
<li><a href="https://github.com/seL4/util_libs/commit/73d4ccaeca68dcda83eda49245d774cab73480c0">util_libs commit</a></li>
</ul>
</li>
<li>
<p>ODroid C4 - Port to platform using an SoC very similar to previously supported SoC</p>
<ul>
<li><a href="https://github.com/seL4/seL4/commit/76b1de0670fc09df279883be570f4a518bad4745">seL4 commit</a></li>
<li><a href="https://github.com/seL4/seL4_tools/commit/83c1891fb007c945e61d04887e49dd1a82eb9b69">seL4_tools commit</a></li>
<li><a href="https://github.com/seL4/util_libs/commit/8ed42ff66c586ab2b6dc32f678e00764453754f0">util_libs commit</a></li>
</ul>
</li>
<li>
<p>Raspberry Pi 4 - Port to new SoC requiring new serial and timer drivers</p>
<ul>
<li><a href="https://github.com/seL4/seL4/commit/2a0e5a2a1fbbb6706e79cf12d0efd7f1004b3389">seL4 commit</a></li>
<li><a href="https://github.com/seL4/seL4_tools/commit/f086b4b818d51519a6d00f6934d97c2a3a834cbe">seL4_tools commit</a></li>
<li><a href="https://github.com/seL4/util_libs/commit/b6f99879e59950f39ee35472ab15eac1efb0f139">util_libs commit</a></li>
</ul>
</li>
</ul>
<h2 id="testing-the-port-with-sel4test"><a class="header" href="#testing-the-port-with-sel4test">Testing the Port With seL4Test</a></h2>
<p>To confirm the correct functionality of a port it is recommended that the <a href="https://docs.sel4.systems/projects/sel4test/">seL4Test</a> test suite is executed.</p>
<p>To build and execute seL4Test for testing purposes against forks of the seL4 git repositories the following procedure can be used. For the purposes of this example it is envisioned that the developer has forked the <a href="https://github.com/seL4/seL4"><code>sel4</code></a>, <a href="https://github.com/seL4/seL4_tools"><code>seL4_tools</code></a> and <a href="https://github.com/seL4/util_libs"><code>util_libs</code></a> git repositories under GitHub account <code>work_account</code> and performed the required modifications under branches named <code>my_port</code>. When following the instructions the commands will need to be modified to match the name of the developer's GitHub account and branch name.</p>
<ol>
<li>
<p>Create a fork of the <a href="https://github.com/seL4/sel4test-manifest"><code>sel4test-manifest</code></a> repository through the GitHub web interface and create branch <code>my_port</code>.</p>
</li>
<li>
<p>Modify file <code>default.xml</code> in the <code>my_port</code> branch of the forked <code>sel4test-manifest</code> repository to point at the developer's forks / branches. This will require the following changes.</p>
<ul>
<li>
<p>Add a new <code>remote</code> to the manifest:</p>
<pre><code class="language-xml">&lt;remote name="work_account" fetch="https://github.com/work_account"/&gt;
</code></pre>
</li>
<li>
<p>For each modified repository update the associated <code>project</code> entry. For example, the entry for the <code>seL4</code> repository would be changed from:</p>
<pre><code class="language-xml">&lt;project name="seL4.git" path="kernel" revision="..." upstream="master" dest-branch="master"/&gt;
</code></pre>
<p>To the following:</p>
<pre><code class="language-xml">&lt;project name="seL4.git" path="kernel" remote="work_account" revision="my_port" upstream="my_port" dest-branch="my_port"/&gt;
</code></pre>
</li>
</ul>
</li>
<li>
<p>Modify the Makefile in the sel4devkit-maaxboard-first-boot-sel4test directory to clone the repositories for your port:</p>
<pre><code class="language-bash">cd ${TMP_PATH}/sel4test-manifest ; repo init --manifest-url "git@github.com:seL4/sel4test-manifest.git" -b my_port
</code></pre>
</li>
<li>
<p>Building and executing seL4Test can be performed by following the instructions previously provided in the <a href="activity/guide_to_porting_seL4/../../first_boot/sel4test.html">seL4test</a> and <a href="activity/guide_to_porting_seL4/../../first_boot/bootloader.html">Bootloader</a> sections with the build commands modified appropriately to target the newly added platform.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="spi-bus-bmp280-pressure-sensor"><a class="header" href="#spi-bus-bmp280-pressure-sensor">SPI Bus BMP280 Pressure Sensor</a></h1>
<p>Having added a Serial Peripheral Interface (SPI) driver, it was tested with a widely available and inexpensive board module that uses the <a href="https://www.bosch-sensortec.com/products/environmental-sensors/pressure-sensors/bmp280/">Bosch BMP280</a> barometric pressure / temperature sensor. Here is a link for a typical example, but there are many alternative sources: <a href="https://www.amazon.co.uk/AZDelivery-Generic-BMP280-Barometric-Pressure/dp/B07D8TPVVY">Amazon link</a>. You may also need some suitable cabling, such as female-to-female ribbon cable <a href="https://www.amazon.co.uk/UMTMedia-Dupont-Cables-Breadboard-Arduino/dp/B09MJZ8D61/ref=sr_1_10?crid=25HYJ98OWY607&amp;dib=eyJ2IjoiMSJ9.dajI1jr1pnKAHRRPg5jVeV16AJBbWbUOkq_1S6o_PISIxSCWvITMRJt_v1RMYUfo1qPpMy4Lz5FpSks35etKTZ0Ex0XrGyDAE1i90x7NK_7r7fM5HWuSjqsOHNTRnHdjgpxGVhbVfDNDapOTnl5ICxALBrXAaHTI2jdZPdaAT7QTIRIc2wLUEc7bxycPMMOzNUl6HyzfwhVv6ghtL3dPNItSiebcLvEKKUc40yu3I-93yKM1sT-i6uv-nJx_ynn1ilCITgq0nuQptgSKYYo-d-JwXcKyXSAg_9m6DBNyGBY.-vOZfJhVxSB99BAiI798WsI_CbM4ryCOFkwabxcYIi4&amp;dib_tag=se&amp;keywords=female+to+female+ribbon+cable&amp;qid=1724337680&amp;sprefix=female+to+female+ribbon+cable%2Caps%2C91&amp;sr=8-10">(example here)</a> and a soldering iron to connect the pin header.</p>
<p>If this sensor is connected, the <a href="activity/spi_bus_bmp280_pressure_sensor/../device_drivers/uboot-driver-example.html">uboot-driver-example test application</a> will use it (see <a href="activity/spi_bus_bmp280_pressure_sensor/../device_drivers/uboot_driver_usage.html">Using the U-Boot Driver Library</a>).</p>
<p>The wiring connections using the MaaXBoard's 40-pin GPIO connector are as follows, accompanied by some reference photographs.</p>
<div class="table-wrapper"><table><thead><tr><th>GPIO Pin</th><th>Sensor Pin</th></tr></thead><tbody>
<tr><td>17</td><td>VCC</td></tr>
<tr><td>19</td><td>SDA (MOSI)</td></tr>
<tr><td>20</td><td>GND</td></tr>
<tr><td>21</td><td>SDO (MISO)</td></tr>
<tr><td>23</td><td>SCL</td></tr>
<tr><td>24</td><td>CSB (SSO)</td></tr>
</tbody></table>
</div>
<p><img src="activity/spi_bus_bmp280_pressure_sensor/../spi_bus_bmp280_pressure_sensor/figures/SPI_side_view.png" alt="SPI GPIO view" />
<img src="activity/spi_bus_bmp280_pressure_sensor/../spi_bus_bmp280_pressure_sensor/figures/SPI_top_view.png" alt="SPI GPIO view" />
<img src="activity/spi_bus_bmp280_pressure_sensor/../spi_bus_bmp280_pressure_sensor/figures/SPI_sensor_top.png" alt="SPI sensor top view" />
<img src="activity/spi_bus_bmp280_pressure_sensor/../spi_bus_bmp280_pressure_sensor/figures/SPI_sensor_bottom.png" alt="SPI sensor bottom view" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="camkes-case-study-application"><a class="header" href="#camkes-case-study-application">CAmkES Case Study Application</a></h1>
<p>This section works through an example to show some of our device drivers being used within a larger application. It is nominally labelled as a 'security domain' demonstrator (named <code>security_demo</code>) but this is mainly in the context of being a keyboard-based encryption device that was inspired by an Enigma machine! It is intentionally simple and its main purpose is to show data separation and to provide worked examples of inter-component communications using different seL4 mechanisms.</p>
<p>Extra functionality within the demonstration application is deliberately kept to a minimum to leave the source code less cluttered, so that the developer can readily see the 'more interesting' seL4 inter-component and device interactions without too much extra, feature-supporting code. In line with the rest of the developer kit, the demonstration application is intended to be more of a springboard for a developer kit user than a polished product for an end user.
This case study works through an example to show some of our device drivers being used within a larger application. It is nominally labelled as a 'security domain' demonstrator (named <code>security_demo</code>) but this is mainly in the context of being a keyboard-based encryption device that was inspired by an Enigma machine! It is intentionally simple and its main purpose is to show data separation and to provide worked examples of inter-component communications using different seL4 mechanisms.</p>
<p>Extra functionality within the demonstration application is deliberately kept to a minimum to leave the source code less cluttered, so that the developer can readily see the 'more interesting' seL4 inter-component and device interactions without too much extra, feature-supporting code. In line with the rest of the developer kit, the demonstration application is intended to be more of a springboard for a developer kit user than a polished product for an end user.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="architecture"><a class="header" href="#architecture">Architecture</a></h1>
<p>We defer to the seL4 Foundation's documentation of CAmkES as the primary source of understanding of CAmkES, but this section will cover aspects of the use of CAmkES where appropriate.</p>
<h2 id="basic-description"><a class="header" href="#basic-description">Basic Description</a></h2>
<p>An operator types a plaintext message using a USB-connected keyboard. The application encrypts the message and transmits the resulting ciphertext via Ethernet to a client that has connected to a predetermined port. The application also records the ciphertext messages in a logfile on the SD card of the device.</p>
<h2 id="architecture-overview"><a class="header" href="#architecture-overview">Architecture Overview</a></h2>
<p>The architecture of the demonstrator is shown below.</p>
<p><img src="activity/camkes_case_study_application/../camkes_case_study_application/figures/encrypter_arch.png" alt="Demonstrator architecture" /></p>
<p>Blue blocks show CAmkES components created specifically for the security demonstrator (or previously created within the developer kit in the case of <a href="activity/camkes_case_study_application/../device_drivers/uboot_driver_usage.html#test-application-picoserver_uboot">EthDriverUboot</a>); grey blocks show CAmkES <a href="https://github.com/seL4/global-components">global components</a>.</p>
<p>Arrow directions show an abstracted view of data flow. Arrow labels refer to seL4 connector types (some concerned with data flow, some with control flow), which are elaborated in the key. More details about seL4 connector types may be found in the <a href="https://docs.sel4.systems/projects/camkes/manual.html">CAmkES manual</a>, but the fundamental types are <em>RPC</em> (Remote Procedure Call), <em>SharedData</em>, and <em>Notification</em> (see examples such as <code>seL4RPCCall</code> in the key).</p>
<p>As the KeyReader and Crypto components handle plaintext and cryptographic data (e.g. keys), they are considered as 'high-side' in terms of security and must be kept separate from the downstream 'low-side' components that handle ciphertext. It is not the role of this developer kit to re-justify the credentials of seL4 (the <a href="https://sel4.systems/About/seL4-whitepaper.pdf">seL4 whitepaper</a> is a good starting point), but suffice to say that seL4's capability-based access controls guarantee protection and separation between all components, regardless of the notional high and low sides that we have overlaid, only allowing interactions between components where explicitly established via the seL4 connector types.</p>
<p>The following paragraphs briefly describe the data flow, from left to right, highlighting the different seL4 mechanisms used for inter-component communications.</p>
<h3 id="components-and-connector-types"><a class="header" href="#components-and-connector-types">Components and Connector Types</a></h3>
<p>Plaintext characters are typed on a keyboard and read by the KeyReader component. These characters are then 'encrypted' by the Crypto component to transform them into ciphertext. <em>RPC</em> is an appropriate connector type for the character-by-character data flow between KeyReader and Crypto (labelled as RPC-1 on the diagram), employing <code>seL4RPCCall</code>. Since this application is more concerned with demonstrating seL4 concepts than crypto-algorithms, the Enigma machine's rotors and plugboard are replaced with a simple <a href="https://en.wikipedia.org/wiki/ROT13">ROT13</a> algorithm!</p>
<p>The encrypted characters are transferred to the Transmitter component via a shared circular buffer, where Crypto writes to the <em>head</em> of the buffer and Transmitter reads from its <em>tail</em>. The buffer is implemented as a <em>SharedData</em> connection (labelled as SharedData-1 on the diagram) using <code>seL4SharedData</code>. (Note that within CAmkES, shared memory is abstracted as a <em>Dataport</em>, so this terminology is often seen associated with this connection type.)</p>
<p>If the buffer is full, Crypto discards characters; otherwise, each time Crypto writes a character to the buffer, it sends a <em>Notification</em> to Transmitter (labelled as Notification-1 on the diagram) to signify that there is data to read, using <code>seL4Notification</code>. Transmitter acts upon notifications by reading all available characters until the buffer is empty.</p>
<p>The shared buffer is protected from concurrent access by use of a <a href="https://en.wikipedia.org/wiki/Lock_(computer_science)">mutex</a>. The mutex is owned by Crypto, and Transmitter accesses its lock and unlock operations via an <em>RPC</em> connection (labelled as RPC-2); note that this is a control flow and is in the opposite direction to the arrow, which shows the data flow of encrypted characters.</p>
<p>The Transmitter component interfaces to PicoServer via three connections, as shown in the <code>picoserver_uboot</code> <a href="activity/camkes_case_study_application/uboot_driver_usage.html#test-application-picoserver_uboot">test application diagram</a>: <code>send</code>, <code>receive</code>, and <code>control</code>. The <code>send</code> and <code>receive</code> connections are defined as global connector type <code>seL4PicoServer</code>, which is fundamentally <code>seL4RPCDataport</code> (<em>SharedData</em> combined with <em>RPC</em>). The <code>control</code> connection has a global connector type of <code>seL4PicoServerSignal</code>, which is fundamentally <code>seL4RPCCallSignal</code> (<em>RPC</em> combined with <em>Notification</em>). Note that although the interface between Transmitter and PicoServer configures <code>receive</code> in order to satisfy the CAmkES connections, the application does not process any Ethernet traffic in this direction, and only <code>send</code> is used.</p>
<p>The interface between PicoServer and EthDriverUboot uses the <code>seL4Ethdriver</code> global connector type, which is fundamentally another instance of <code>seL4RPCDataport</code> (<em>SharedData</em> combined with <em>RPC</em>).</p>
<p>TimeServer, which supports timing functionality for PicoServer, uses the <code>seL4TimeServer</code> global connector type, which is fundamentally another instance of <code>seL4RPCCallSignal</code> (<em>RPC</em> combined with <em>Notification</em>).</p>
<h3 id="device-drivers-1"><a class="header" href="#device-drivers-1">Device Drivers</a></h3>
<p>As can be seen from the architecture diagram, three hardware devices are involved in the operation of the application.</p>
<ol>
<li>
<p>The KeyReader component requires access to the USB device to allow for plaintext characters to be input from a USB keyboard.</p>
</li>
<li>
<p>The Transmitter component requires access to the SD/MMC device to allow for the ciphertext message to be output to a log file.</p>
</li>
<li>
<p>The EthDriverUboot component requires access to the Ethernet device to allow for ciphertext message to be output to the network.</p>
</li>
</ol>
<p>Device drivers for the required hardware access are supplied by the <a href="activity/camkes_case_study_application/../device_drivers/uboot_driver_library.html">U-Boot Driver Library</a> previously introduced by this development kit.</p>
<p>Three separate instances of the library are used by the application, one per component with a need for hardware device access. The capabilities of each component, and their associated library instances, are configured such that each component is only capable of accessing the minimum set of hardware devices required to perform the desired function.</p>
<p>For example, the Transmitter component only has a need to access the SD/MMC device to write the ciphertext log file. As such, the capabilities of the Transmitter component permit it to access the memory-mapped interface of the SD/MMC device; however no such capabilities are provided for the USB or Ethernet devices. Any attempt by the Transmitter component to access the memory-mapped interface of the USB device (e.g. in an attempt to read the plaintext keypresses) would therefore be prevented by seL4.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="design-detail"><a class="header" href="#design-detail">Design Detail</a></h1>
<p>Following on from the <a href="activity/camkes_case_study_application/architecture.html">Architecture document</a>, this section provides further details on the design and functionality of the 'security domain' demonstrator application.</p>
<p>It is expected that the reader is familiar with the <a href="https://docs.sel4.systems/projects/camkes/manual.html">seL4 CAmkES manual</a>.</p>
<h2 id="code-structure-1"><a class="header" href="#code-structure-1">Code Structure</a></h2>
<p>The application is held within the following structure (all within the <code>camkes/apps</code> folder), with key folders and files shown:</p>
<pre><code class="language-text">security_demo
│
├───components
│   ├───&lt;component_1&gt;
│   │   ├───src
│   │   │   └───&lt;component_source_file&gt;.c
│   │   └───&lt;component_camkes_file&gt;.camkes
│   ...
│   └───&lt;component_n&gt;
│       ├───src
│       │   └───&lt;component_source_file&gt;.c
│       └───&lt;component_camkes_file&gt;.camkes
│
├───include
│   └───plat
│       ├───&lt;platform&gt;
│       │   ├───eth_platform_devices.h
│       │   ├───mmc_platform_devices.h
│       │   └───usb_platform_devices.h
│       └───dataport_buffer.h
│
├───interfaces
│   ├───Character_RPC.idl4
│   └───Lock_RPC.idl4
│
├───CMakeLists.txt
└───security_demo.camkes
</code></pre>
<ul>
<li><code>CMakeLists.txt</code>: Application build file.</li>
<li><code>security_demo.camkes</code>: Top-level CAmkES file for the project, declaring the application's CAmkES 'assembly' including declaration of all inter-component connections.</li>
<li><code>components/&lt;component&gt;/&lt;component_camkes_file&gt;.camkes</code>: A component's CAmkES file, declaring the component's attributes including declaration of all interfaces (i.e. exposed inter-component interaction points).</li>
<li><code>interfaces/Character_RPC.idl4</code>: Declaration of a remote procedure call method used to communicate a character between components.</li>
<li><code>interfaces/Lock_RPC.idl4</code>: Declaration of remote procedure call methods used to access a mutex held by another component.</li>
<li><code>include/dataport_buffer.h</code>: Declaration of a C data type for a circular buffer to be stored in a dataport.</li>
<li><code>include/&lt;platform&gt;/&lt;eth|mmc|usb&gt;_platform_devices.h</code>: Declaration of (platform specific) CAmkES attributes to grant a component with capabilities access to a hardware device.</li>
</ul>
<h2 id="concurrency-model"><a class="header" href="#concurrency-model">Concurrency Model</a></h2>
<p>From a concurrency perspective, the security demonstrator can be summarised as threads of execution on the 'high-side' managing plaintext data running asynchronously to threads of execution on the 'low-side' managing ciphertext data.</p>
<p>Threads of execution on the high-side perform the following functions:</p>
<ol>
<li>Reading plaintext keypresses from the USB keyboard;</li>
<li>Encrypting those keypresses from plaintext to ciphertext; and</li>
<li>Placing ciphertext keypresses into a shared circular buffer between the high-side and low-side.</li>
</ol>
<p>Asynchronously, threads of execution on the low-side perform the following functions:</p>
<ol>
<li>Reading ciphertext keypresses from a shared circular buffer between the high-side and low-side;</li>
<li>Periodically writing received ciphertext to a log file; and</li>
<li>Outputting ciphertext to a network socket (if connected).</li>
</ol>
<p>All data is passed from the high-side to the low-side through a shared circular buffer stored within a dataport. It is this circular buffer between the high-side and low-side that permits:</p>
<ol>
<li>Data transfer from the high-side to the low-side; and</li>
<li>Threads of execution on the high-side and threads of execution on the low-side to run asynchronously.</li>
</ol>
<h2 id="example-of-inter-component-communication"><a class="header" href="#example-of-inter-component-communication">Example of Inter-Component Communication</a></h2>
<p>The circular buffer shared between the Crypto component (high-side) and the Transmitter component (low-side) is used in this section as a detailed worked example of CAmkES inter-component data flow and control flow.</p>
<p>The buffer has been deliberately designed for the purpose of this worked example to use of all three types of component interface listed in the <a href="https://docs.sel4.systems/projects/camkes/manual.html">seL4 CAmkES manual</a>, i.e. <em>procedure</em>, <em>event</em> and <em>port</em>.</p>
<h3 id="port"><a class="header" href="#port">Port</a></h3>
<p>At its core the circular buffer is a simple character array with <em>head</em> and <em>tail</em> holding indexes associated with the start and end of the used portion of the array.</p>
<ul>
<li>Further details are documented alongside the definition of the <code>dataport_buffer_t</code> type definition in <code>include/dataport_buffer.h</code>.</li>
<li><em>Port</em> interfaces of data type <code>dataport_buffer_t</code> are declared in the Crypto and Transmitter component CAmkES files.</li>
<li>An <code>seL4SharedData</code> connection between the two <em>port</em> interfaces is then declared in the CAmkES assembly (see <code>security_demo.camkes</code>).</li>
</ul>
<p>This results in an instance of the circular buffer type being made available in an area of memory shared by both the Crypto and Transmitter components.</p>
<h3 id="procedure"><a class="header" href="#procedure">Procedure</a></h3>
<p>Reading data from, or writing data to, the circular buffer requires the data array, <em>head</em> index, and <em>tail</em> index to be modified. Such modification of the buffer cannot be allowed to occur concurrently by both the Crypto and Transmitter components, otherwise corruption of the buffer may occur. Access to the buffer by the two components must therefore be protected to avoid concurrent access.</p>
<p>Within the security demonstrator, a mutex is used to enforce this critical section; each component must hold the lock on the mutex prior to accessing the circular buffer, and must release the lock when access to the circular buffer has been completed.</p>
<p>The mutex is owned by the Crypto component; see definition of <code>circular_buffer_mutex</code> in the Crypto component's CAmkES file. To allow the Transmitter component to access the mutex, a <em>procedure</em> interface is used providing <code>lock</code> and <code>unlock</code> routines.</p>
<ul>
<li>Declaration of the <code>lock</code> and <code>unlock</code> <em>procedure</em> templates are provided by <code>interfaces/Lock_RPC.idl4</code>.</li>
<li><em>Procedure</em> interfaces using the <code>lock</code> and <code>unlock</code> templates are declared in the Crypto and Transmitter component CAmkES files.</li>
<li>An <code>seL4RPCCall</code> connection between the two <em>procedure</em> interfaces is then declared in the CAmkES assembly (see <code>security_demo.camkes</code>).</li>
</ul>
<p>This results in the Crypto component being supplied with a mutex and remote procedure call interfaces being supplied to the Transmitter component to allow it to access the mutex.</p>
<h3 id="event"><a class="header" href="#event">Event</a></h3>
<p>Whilst a functional system could be produced with just the <em>port</em> and <em>procedure</em> interfaces described above, there would be no mechanism for the Transmitter component to determine whether the circular buffer contains any data other than to periodically poll the contents of the circular buffer; this would be needlessly inefficient.</p>
<p>Instead, an <em>event</em> interface is used to allow the Crypto component to notify Transmitter when a character has been written into the circular buffer. This allows the Transmitter component to wait or poll for such a notification before locking the mutex and accessing the circular buffer.</p>
<ul>
<li><em>Event</em> interfaces, with the Crypto component as the emitter and Transmitter as the consumer, are declared in the Crypto and Transmitter component CAmkES files.</li>
<li>An <code>seL4Notification</code> connection between the two <em>event</em> interfaces is then declared in the CAmkES assembly (see <code>security_demo.camkes</code>).</li>
</ul>
<p>This results in the creation of a notification that can be emitted from the Crypto component and can be either waited on, or polled, by the Transmitter component.</p>
<h3 id="summary"><a class="header" href="#summary">Summary</a></h3>
<p>Putting all three interface types (<em>port</em>, <em>procedure</em>, and <em>event</em>) together results in:</p>
<ul>
<li>A shared circular buffer;</li>
<li>A mutex which can be accessed via remote procedure calls to protect the buffer against concurrent access; and</li>
<li>A notification mechanism to allow the producer to notify the consumer when new data is available.</li>
</ul>
<p>This thereby allows asynchronous data transfer and buffering between components such that the producer and consumer can work concurrently.</p>
<p>The example source code for the producer component demonstrating use of these inter-component communication mechanisms can be found in <code>components/Crypto/src/crypto.c</code>. The source code for the consumer component can be found in <code>components/Transmitter/src/transmitter.c</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="building-and-running"><a class="header" href="#building-and-running">Building and Running</a></h1>
<p>This section builds and runs the <code>security_demo</code> demonstration application described in <a href="activity/camkes_case_study_application/architecture.html">Architecture document</a>. All the host machine and target platform requirements described previously in this developer kit documentation are assumed.</p>
<h2 id="building-the-application"><a class="header" href="#building-the-application">Building the Application</a></h2>
<p>As usual, this assumes that the user is already running a Docker container within the <a href="activity/camkes_case_study_application/../../install_and_configure/build_environment_setup.html">build environment</a>, where we can create a directory and clone the code and dependencies.</p>
<pre><code class="language-text">mkdir /host/security_demo
cd /host/security_demo
</code></pre>
<pre><code class="language-bash">repo init -u https://github.com/sel4devkit/sel4devkit-maaxboard-camkes-manifest.git
</code></pre>
<pre><code class="language-bash">repo sync
</code></pre>
<p>The application requires an IP address to be allocated to PicoServer. This should be substituted for <code>xxx.xxx.xxx.xxx</code> below. From the <code>/host/security_demo</code> directory, we execute the following commands:</p>
<pre><code class="language-text">mkdir build
cd build
</code></pre>
<pre><code class="language-bash">../init-build.sh -DCAMKES_APP=security_demo -DPLATFORM=maaxboard -DPICOSERVER_IP_ADDR=xxx.xxx.xxx.xxx
</code></pre>
<p>This command should be repeated as a workaround - see the <a href="activity/camkes_case_study_application/build.html#implementation-note">implementation note</a> below:</p>
<pre><code class="language-bash">../init-build.sh -DCAMKES_APP=security_demo -DPLATFORM=maaxboard -DPICOSERVER_IP_ADDR=xxx.xxx.xxx.xxx
</code></pre>
<p>Then run <code>ninja</code> as usual:</p>
<pre><code class="language-bash">ninja
</code></pre>
<h3 id="implementation-note-1"><a class="header" href="#implementation-note-1">Implementation note</a></h3>
<p>There is a known race condition with the CMake configuration of picoserver, which, if only run once, results in <code>fatal error: pico_device.h: No such file or directory</code>. A workaround is to run the command twice, or run CMake again, by typing <code>cmake .</code> (see <a href="https://lists.sel4.systems/hyperkitty/list/devel@sel4.systems/thread/O5B42BFF4FZ2WSCPUK6C6QUAJHD6DETN/">here</a>).</p>
<h2 id="preparing-to-run"><a class="header" href="#preparing-to-run">Preparing to Run</a></h2>
<p>A successful build will result in an executable file called <code>capdl-loader-image-arm-maaxboard</code> in the <code>images</code> subdirectory. This should be copied to a file named <code>sel4_image</code> and then made available to the preferred loading mechanism, such as TFTP, as per <a href="activity/camkes_case_study_application/execution_on_target_platform.html">Execution on Target Platform</a>.</p>
<p>Running the <code>security_demo</code> application requires the following:</p>
<ul>
<li>Connect a keyboard to the USB socket<sup class="footnote-reference"><a href="#1">1</a></sup> of the MaaXBoard;</li>
<li>Establish an Ethernet connection between the MaaXBoard and the host machine, which can be direct or via a network, as outlined in <a href="activity/camkes_case_study_application/bootloader.html#loading-via-tftp">an earlier section</a> (e.g. it will already be in place if TFTP is being used to transfer executables).</li>
</ul>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Note: Currently, only the upper USB port on the Avnet MaaXBoard is active (i.e. the port furthest away from the PCB); the lower USB port does not function. This is a feature of the power domains on the board, not the USB driver.</p>
</div>
<p>If the user has experience of running the <a href="activity/camkes_case_study_application/uboot_driver_usage.html#test-application-picoserver_uboot"><code>picoserver_uboot</code> test application</a>, then elements of the <code>security_demo</code> application will be familiar. For example, from a terminal window on the host machine, we will use the <code>netcat</code> (<code>nc</code>) command (native to Linux or macOS, or available as a <a href="https://nmap.org/ncat/">download</a> for Windows) to connect to the MaaXBoard, so this should be prepared.</p>
<h2 id="running-the-application"><a class="header" href="#running-the-application">Running the Application</a></h2>
<p>The application invokes three instances of the <a href="activity/camkes_case_study_application/uboot_driver_library.html">U-Boot Driver Library</a>, so various sets of diagnostic messages are repeated on the CoolTerm display as the application starts. We should not be unduly concerned with some of the individual messages, such as <code>No ethernet found</code>, since in this case only one of the library instances is configured to use Ethernet (i.e. the library invoked by the EthDriverUboot component), and amongst the other messages there should be confirmation that it was successful, e.g. <code>Assigned ipv4 xxx.xxx.xxx.xxx to device eth0</code>. There are also some <code>clk_register: failed ... (parent ...)</code> messages, which are harmless (a fault in U-Boot's clock driver for the MaaXBoard).</p>
<p>When the application's initialisation has completed, we should see:</p>
<pre><code class="language-text">run_uboot_command@uboot_wrapper.c:176 --- running command 'fatrm mmc 0:2 transmitter_log.txt' ---
Net:   transmitter_log.txt: doesn't exist
run_uboot_command@uboot_wrapper.c:181 --- command 'fatrm mmc 0:2 transmitter_log.txt' completed with return code 1 ---
</code></pre>
<p>Note that on subsequent runs, the log file will exist (unless the user has intentionally deleted it), and the output will instead read:</p>
<pre><code class="language-text">run_uboot_command@uboot_wrapper.c:176 --- running command 'fatrm mmc 0:2 transmitter_log.txt' ---
run_uboot_command@uboot_wrapper.c:181 --- command 'fatrm mmc 0:2 transmitter_log.txt' completed with return code 0 ---
</code></pre>
<p>In either scenario, this is housekeeping by the application to delete any previous Transmitter logfile from the SD card, before it starts writing new log data. The logfile is named <code>transmitter_log.txt</code> and is expected on the third partition of the SD card - see the FAT partition <code>FILESYS</code> established during the <a href="activity/camkes_case_study_application/appendices/partitioning_sd_card.html">Partitioning the SD Card appendix</a>.</p>
<p>Just as with the <a href="activity/camkes_case_study_application/uboot_driver_usage.html#test-application-picoserver_uboot"><code>picoserver_uboot</code> test application</a>, the application may sporadically display <code>No such port ....</code> messages as it monitors traffic on the network. This is expected diagnostic behaviour that may be ignored; indeed, the lack of any such messages may indicate for example that the Ethernet driver has not initialised properly.</p>
<p>The application is now ready to perform various actions concurrently:</p>
<ol>
<li>If a key is pressed, the plaintext character will be encrypted into a ciphertext character;</li>
<li>If a client requests an Ethernet connection on port 1234, the application will establish the connection and transmit ciphertext to the client, continuing to do so until the client closes the connection;</li>
<li>Every 30 seconds, if there are any ciphertext characters that it has not yet logged to file, the application will append them to the logfile on the SD card.</li>
</ol>
<p>For item (2), from a terminal window on the host machine, start <code>netcat</code> with the command:</p>
<pre><code class="language-bash">nc xxx.xxx.xxx.xxx 1234
</code></pre>
<p>where <code>xxx.xxx.xxx.xxx</code> is the IP address of the MaaXBoard, as previously specified in the <code>init_build</code> call, and 1234 is the port number that has been programmed into the application.</p>
<p>In the CoolTerm window, a message such as the following will signify a successful connection:</p>
<pre><code class="language-text">transmitter: Connection established with yyy.yyy.yyy.yyy on socket 1
</code></pre>
<p>where <code>yyy.yyy.yyy.yyy</code> is the IP address of the host machine.</p>
<p>If this connection is not established promptly, please refer to the previous <a href="activity/camkes_case_study_application/uboot_driver_usage.html#implementation-note">implementation note</a> relating to network connection delays.</p>
<p>If characters have been typed at the USB keyboard before making the <code>netcat</code> connection, then (ciphertext) characters will appear straightaway on the host machine, since the application stores characters in a buffer while they cannot be sent.</p>
<p>Plaintext messages may be typed on the keyboard (note that these are not displayed anywhere), for example:</p>
<pre><code class="language-text">Hello world, testing 123. We love seL4!
</code></pre>
<p>Within the host machine's <code>netcat</code> session, the corresponding ciphertext message should appear:</p>
<pre><code class="language-text">Uryyb jbeyq, grfgvat 123. Jr ybir frY4!
</code></pre>
<p>Periodically, the CoolTerm window will show diagnostic messages concerning the logfile, such as:</p>
<pre><code class="language-text">run_uboot_command@uboot_wrapper.c:176 --- running command 'fatwrite mmc 0:2 0x55b010 transmitter_log.txt 26 1' ---
38 bytes written in 5 ms (6.8 KiB/s)
run_uboot_command@uboot_wrapper.c:181 --- command 'fatwrite mmc 0:2 0x55b010 transmitter_log.txt 26 1' completed with return code 0 ---
</code></pre>
<p>The application will continue indefinitely. <code>netcat</code> sessions on the host machine may be terminated (Ctrl-C) and restarted, whereupon the application will establish a new connection (buffering output in the meantime).</p>
<p>If the MaaXBoard is powered off and its SD card removed and transferred to the host machine, the <code>transmitter_log.txt</code> can be accessed from the <code>FILESYS</code> partition as one would expect.</p>
<p>To reduce the risk of corrupting the SD card, it is advisable to avoid powering off the MaaXBoard during a write operation of the logfile. As this operation lasts in the order of 10 ms and only occurs every 30 seconds (and only then if there are any ciphertext characters that have not yet been logged to file), the risk is both remote and avoidable (e.g. power off soon after a <code>fatwrite</code> command message, or wait for &gt;30 seconds after the last <code>fatwrite</code> command message).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="microkit-case-study-application"><a class="header" href="#microkit-case-study-application">Microkit Case Study Application</a></h1>
<p>This section works through the changes completed to port the case study application to Microkit.</p>
<p>As well as the changes to the <a href="activity/microkit_case_study_application/architecture.html">Architecture</a> and <a href="activity/microkit_case_study_application/detail.html">Design</a>, other infrastructure changes had to be made to make the case study compatible with Microkit:</p>
<h2 id="picolibc"><a class="header" href="#picolibc">Picolibc</a></h2>
<p>Microkit does not contain a bundled libc; therefore, it was decided to port picolibc to Microkit. Picolibc is a C library specifically designed for use in embedded systems, providing a lightweight and efficient implementation of the C standard library functions. This makes it an ideal choice to complement Microkit, enhancing its capabilities without adding unnecessary overhead.</p>
<p>The ported picolibc for Microkit is linked <a href="https://github.com/sel4devkit/picolibc">here</a> with instructions for building and linking with Microkit. To use dynamic memory allocation (malloc) the __heap_start and __heap_end symbols (defined in the system file) needed to be added to the picosbrk.c file. This tells picolibc where the memory location of the heap.</p>
<h2 id="u-boot"><a class="header" href="#u-boot">U-Boot</a></h2>
<p><a href="https://github.com/sel4devkit/u-boot/tree/microkit">U-boot</a> has been ported to be used with Microkit using the fork and patch method. The majority of the changes were made to remove name space clashes with picolibc.</p>
<h2 id="device-tree"><a class="header" href="#device-tree">Device tree</a></h2>
<p>Inline assembly is used to import the device tree to Microkit:</p>
<pre><code class="language-c">#define STR2(x) #x
#define STR(x) STR2(x)
#define INCBIN_SECTION ".rodata"
#define INCBIN(name, file) \
    __asm__(".section " INCBIN_SECTION "\n" \
            ".global incbin_" STR(name) "_start\n" \
            ".balign 16\n" \
            "incbin_" STR(name) "_start:\n" \
            ".incbin \"" file "\"\n" \
            \
            ".global incbin_" STR(name) "_end\n" \
            ".balign 1\n" \
            "incbin_" STR(name) "_end:\n" \
            ".byte 0\n" \
    ); \
    extern __attribute__((aligned(16))) const char incbin_ ## name ## _start[]; \
    extern                              const char incbin_ ## name ## _end[] 
INCBIN(device_tree, DTB_PATH); 

const char* _end = incbin_device_tree_end;
</code></pre>
<h2 id="dma-library"><a class="header" href="#dma-library">DMA library</a></h2>
<p>The CAmkES dma allocated has been adapted to work with Microkit. The initialisation of the DMA library was separated out from the IO operations of CAmkES. The CAmkES DMA library allocated multiple pools of dma to be used in each component however in Microkit multiple pools of DMA can be assigned and allocated in the system file therefore the library was adapted so only one pool of DMA memory is allocated. The address and size of the DMA pool are also configured in the <a href="https://github.com/sel4devkit/sel4devkit-maaxboard-microkit-security-demo-example/blob/main/security_demo.system">system file</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="architecture-overview-1"><a class="header" href="#architecture-overview-1">Architecture Overview</a></h1>
<p>It is assumed the CAmkES case study <a href="activity/microkit_case_study_application/../camkes_case_study_application/architecture.html">architecture document</a> had been read previous to reading this document.</p>
<p>The architecture of the Microkit demonstrator is shown below.</p>
<p><img src="activity/microkit_case_study_application/../microkit_case_study_application/figures/encrypter_arch.png" alt="Demonstrator architecture" /></p>
<p>The Microkit architecture is different to the CAmkES architecture as it does not include the picoserver, Timeserver or EthDriverUboot modules because there is no ethernet capability in the Microkit case study. Arrow labels refer to Microkit connector types (some concerned with data flow, some with control flow), which are elaborated in the key. More details about Microkit connector types may be found in the Microkit manual, but the fundamental types are Protected procedure and Notification (see examples such as Protected procedure in the key).</p>
<h2 id="protection-domains-and-connector-types"><a class="header" href="#protection-domains-and-connector-types">Protection domains and Connector Types</a></h2>
<p>Protected procedure is an appropriate connector type for the character-by-character data flow between KeyReader and Crypto because it sends a singular message when invoked. The encrypted characters are transferred to the Transmitter PD via a shared circular buffer, where Crypto writes to the head of the buffer and Transmitter reads from its tail. The buffer is implemented as a shared memory region. When there is data to be read in the buffer Crypto notifies Transmitter that data needs to be read via the notification mechanism. Transmitter acts upon notifications by reading all available characters until the buffer is empty.</p>
<h2 id="device-drivers-2"><a class="header" href="#device-drivers-2">Device Drivers</a></h2>
<p>The Microkit case study only requires two hardware devices compared with CAmkES's three. This is because the ethernet device is not needed.</p>
<p>As can be seen from the architecture diagram, the two hardware devices needed are:</p>
<ol>
<li>
<p>The USB device in the KeyReader protection domain</p>
</li>
<li>
<p>The SD/MMC device in the Transmitter protection domain</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="design-detail-1"><a class="header" href="#design-detail-1">Design Detail</a></h1>
<p>Following on from the <a href="activity/microkit_case_study_application/architecture.html">architecture document</a>, this section provides further details on the design and functionality of the 'security domain' demonstrator application.</p>
<p>It is expected that the reader is familiar with the <a href="https://github.com/seL4/microkit/blob/main/docs/manual.md">seL4 Microkit manual</a>.</p>
<h2 id="code-structure-2"><a class="header" href="#code-structure-2">Code Structure</a></h2>
<p>The application is held within the following structure with key folders and files shown:</p>
<pre><code class="language-text">root
│    
project_libs
│   │
│   │      
│   ├───include
│   │   └───plat
│   │       └───&lt;platform&gt;
│   │            ├───mmc_platform_devices.h
│   │            └───usb_platform_devices.h
│   │
│   └───CMakeLists.txt
│
└───examples
    └───&lt;platform&gt;
          └───security_demo
              ├───security_demo.system
              ├───crypto
              │    └───crypto.c
              ├───keyreader
              │   └───keyreader.c
              └───transmitter
                  └───transmitter.c
      
</code></pre>
<ul>
<li><code>CMakeLists.txt</code>: Application build file.</li>
<li><code>security_demo.system</code>: Microkit file for the project, declaring the application's protection domains including declaration of all protection domain channels.</li>
<li><code>include/plat/&lt;mmc|usb&gt;_platform_devices.h</code>: Declaration of (platform specific) Microkit attributes to grant a protection domain with capabilities access to a hardware device.</li>
</ul>
<h2 id="concurrency-model-1"><a class="header" href="#concurrency-model-1">Concurrency Model</a></h2>
<p>From a concurrency perspective, the security demonstrator can be summarised as threads of execution on the 'high-side' managing plaintext data running asynchronously to threads of execution on the 'low-side' managing ciphertext data.</p>
<p>Threads of execution on the high-side perform the following functions:</p>
<ol>
<li>Reading plaintext keypresses from the USB keyboard;</li>
<li>Encrypting those keypresses from plaintext to ciphertext; and</li>
<li>Placing ciphertext keypresses into a shared circular buffer between the high-side and low-side.</li>
</ol>
<p>Asynchronously, threads of execution on the low-side perform the following functions:</p>
<ol>
<li>Reading ciphertext keypresses from a shared circular buffer between the high-side and low-side;</li>
<li>Periodically writing received ciphertext to a log file.</li>
</ol>
<p>All data is passed from the high-side to the low-side through a shared circular buffer stored within a dataport. It is this circular buffer between the high-side and low-side that permits:</p>
<ol>
<li>Data transfer from the high-side to the low-side; and</li>
<li>Threads of execution on the high-side and threads of execution on the low-side to run asynchronously.</li>
</ol>
<h2 id="example-of-protection-domain-communication"><a class="header" href="#example-of-protection-domain-communication">Example of Protection Domain Communication</a></h2>
<p>The circular buffer shared between the Crypto protection domain (high-side) and the Transmitter protection domain (low-side) is used in this section as a detailed worked example of Microkit data control flow.</p>
<p>The buffer has been deliberately designed for the purpose of this worked example to use two types of protection domain interface listed in the <a href="https://github.com/seL4/microkit/blob/main/docs/manual.md">seL4 Microkit manual</a>, i.e. Memory region and Notification.</p>
<h3 id="memory-region"><a class="header" href="#memory-region">Memory Region</a></h3>
<p>A memory region is a contiguous range of physical memory and the memory region for the circular buffer is mapped onto both the Crypto and Transmitter protection domains. A virtual address, caching attributes and permissions (read, write and execute) are given to each protection domain. At its core the circular buffer is a simple character array with <em>head</em> and <em>tail</em> holding indexes associated with the start and end of the used portion of the array.</p>
<h3 id="procedure-1"><a class="header" href="#procedure-1">Procedure</a></h3>
<p>Reading data from, or writing data to, the circular buffer requires the data array, <em>head</em> index, and <em>tail</em> index to be modified. Such modification of the buffer cannot be allowed to occur concurrently by both the Crypto and Transmitter protection domains, otherwise corruption of the buffer may occur. Access to the buffer by the two protection domains must therefore be protected to avoid concurrent access.</p>
<p>Within the security demonstrator, cache invalidates and flushes are used to enforce this critical section. These make sure that the cpu is reading the most up to date data. Each protection domain performs a cache invalidate prior to accessing or writing the circular buffer, and must flush the cache when access or writing to the circular buffer has been completed.</p>
<ul>
<li>Function implementations for the circular buffer are included in <code>src/circular_buffer.c</code>.</li>
</ul>
<p>This results in an instance of the circular buffer type being made available in an area of memory shared by both the Crypto and Transmitter protection domains.</p>
<h3 id="notification"><a class="header" href="#notification">Notification</a></h3>
<p>A mechanism for the Transmitter protection domain to determine whether the circular buffer contains any data.</p>
<p>A Notification interface is used to allow the Crypto protection domain to notify Transmitter when there is data to be read in the circular buffer. This allows the Transmitter protection domain to wait or poll for such a notification before accessing the circular buffer.</p>
<ul>
<li>Channels are set up between the Crypto and Transmitter protection domains in the applications system file which allow the protection domains to notify each other when there is data to read in a shared buffer.</li>
</ul>
<p>This results in the creation of a notification that can be emitted from the Crypto protection domain and can be either waited on, or polled, by the Transmitter protection domain.</p>
<h3 id="summary-1"><a class="header" href="#summary-1">Summary</a></h3>
<p>Putting the two interface types (Memory region and Notification) together results in:</p>
<ul>
<li>A shared circular buffer;</li>
<li>A notification mechanism to allow the producer to notify the consumer when new data is available.</li>
</ul>
<p>This thereby allows asynchronous data transfer and buffering between protection domains such that the producer and consumer can work concurrently.</p>
<p>The example source code for the producer protection domain demonstrating use of these communication mechanisms can be found in <code>crypto/crypto.c</code>. The source code for the consumer protection domain can be found in <code>transmitter/transmitter.c</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="building-and-running-1"><a class="header" href="#building-and-running-1">Building and Running</a></h1>
<p>All the host machine and target platform requirements described previously in this manual are assumed.</p>
<h2 id="building-the-application-1"><a class="header" href="#building-the-application-1">Building the Application</a></h2>
<p>As usual, this assumes that the user is already running a Docker container within the <a href="activity/microkit_case_study_application/../../install_and_configure/build_environment_setup.html">build environment</a>, where we can create a directory and clone the code and dependencies.</p>
<pre><code class="language-text">mkdir /host/security_demo
cd /host/security_demo
</code></pre>
<pre><code class="language-bash">repo init -u git@github.com:sel4devkit/sel4devkit-maaxboard-microkit_manifest.git
</code></pre>
<pre><code class="language-bash">repo sync
</code></pre>
<p>From the <code>/host/security_demo</code> directory, we execute the following commands:</p>
<pre><code class="language-text">cd project_libs
</code></pre>
<pre><code class="language-bash">./init-build.sh -DMICROKIT_APP=security_demo -DPLATFORM=maaxboard
</code></pre>
<p>Once build there is an option to rebuild the entire project using the below command:</p>
<pre><code class="language-bash">./init-build.sh -DMICROKIT_APP=security_demo -DPLATFORM=maaxboard -DBUILD_TYPE=rebuild
</code></pre>
<h2 id="preparing-to-run-1"><a class="header" href="#preparing-to-run-1">Preparing to Run</a></h2>
<p>A successful build will result in an executable file called <code>sel4_image</code> in the <code>example/&lt;platform&gt;/security_demo/example-build</code> subdirectory. This file should be made available to the preferred loading mechanism, such as TFTP, as per <a href="activity/microkit_case_study_application/execution_on_target_platform.html">Execution on Target Platform</a>.</p>
<p>Running the <code>security_demo</code> application requires the following:</p>
<ul>
<li>Connect a keyboard to the USB socket<sup class="footnote-reference"><a href="#1">1</a></sup> of the MaaXBoard;</li>
</ul>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Note: Currently, only the upper USB port on the Avnet MaaXBoard is active (i.e. the port furthest away from the PCB); the lower USB port does not function. This is a feature of the power domains on the board, not the USB driver.</p>
</div>
<h2 id="running-the-application-1"><a class="header" href="#running-the-application-1">Running the Application</a></h2>
<p>The application invokes two instances of the <a href="activity/microkit_case_study_application/../device_drivers/uboot_driver_library.html">U-Boot Driver Library</a>, so various sets of diagnostic messages are repeated on the CoolTerm display as the application starts. We should not be unduly concerned with some of the individual messages, such as <code>No ethernet found</code>, since in this case none of the library instances are configured to use ethernet. There are also some <code>clk_register: failed ... (parent ...)</code> messages, which are harmless (a fault in U-Boot's clock driver for the MaaXBoard).</p>
<p>When the application's initialisation has completed, we should see:</p>
<pre><code class="language-text">run_uboot_command@uboot_wrapper.c:176 --- running command 'fatrm mmc 0:2 transmitter_log.txt' ---
Net:   transmitter_log.txt: doesn't exist
run_uboot_command@uboot_wrapper.c:181 --- command 'fatrm mmc 0:2 transmitter_log.txt' completed with return code 1 ---
</code></pre>
<p>Note that on subsequent runs, the log file will exist (unless the user has intentionally deleted it), and the output will instead read:</p>
<pre><code class="language-text">run_uboot_command@uboot_wrapper.c:176 --- running command 'fatrm mmc 0:2 transmitter_log.txt' ---
run_uboot_command@uboot_wrapper.c:181 --- command 'fatrm mmc 0:2 transmitter_log.txt' completed with return code 0 ---
</code></pre>
<p>In either scenario, this is housekeeping by the application to delete any previous Transmitter logfile from the SD card, before it starts writing new log data. The logfile is named <code>transmitter_log.txt</code> and is expected on the third partition of the SD card - see the FAT partition <code>FILESYS</code> established during the <a href="activity/microkit_case_study_application/partitioning_sd_card.html">Partitioning the SD Card appendix</a>.</p>
<p>The application is now ready to perform various actions concurrently:</p>
<ol>
<li>If a key is pressed, the plaintext character will be encrypted into a ciphertext character;</li>
<li>When the circular buffer is full, the application will append them to the logfile on the SD card.</li>
</ol>
<p>Periodically, the CoolTerm window will show diagnostic messages concerning the logfile, such as:</p>
<pre><code class="language-text">run_uboot_command@uboot_wrapper.c:176 --- running command 'fatwrite mmc 0:2 0x55b010 transmitter_log.txt 26 1' ---
38 bytes written in 5 ms (6.8 KiB/s)
run_uboot_command@uboot_wrapper.c:181 --- command 'fatwrite mmc 0:2 0x55b010 transmitter_log.txt 26 1' completed with return code 0 ---
</code></pre>
<p>The application will continue indefinitely.</p>
<p>If the MaaXBoard is powered off and its SD card removed and transferred to the host machine, the <code>transmitter_log.txt</code> can be accessed from the <code>FILESYS</code> partition as one would expect.</p>
<p>To reduce the risk of corrupting the SD card, it is advisable to avoid powering off the MaaXBoard during a write operation of the logfile. As this operation lasts in the order of 10 ms, the risk is both remote and avoidable (e.g. power off soon after a <code>fatwrite</code> command message).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="microkit-xhci-usb-driver"><a class="header" href="#microkit-xhci-usb-driver">Microkit xHCI USB Driver</a></h1>
<h2 id="introduction-1"><a class="header" href="#introduction-1">Introduction</a></h2>
<p>For this activity the goal was to create an Sel4 native xHCI driver. We opted to re-work an existing solution, because writing an entire xHCI driver from scratch would be a long and complicated task. We chose to use NetBSD's xHCI driver because it has good portability, supports a wide range of hardware, is BSD licenced, is updated often, and makes use of interrupts which are more performant compared to other solutions that use polling. The plan was to use this as a base to pull drivers from in the future.</p>
<p>The repository can be found <a href="https://github.com/sel4devkit/sel4devkit-maaxboard-microkit-xhci-driver">here</a>.</p>
<h2 id="xhci"><a class="header" href="#xhci">xHCI</a></h2>
<p>xHCI is a standardised interface used for USB host controllers. Also known as the USB 3.0 host controller specification, it is designed to be backward compatible, supporting a wide range of USB devices from older USB 1.x to the more recent USB 3.x versions. Compared to its predecessors (OHCI, UHCI and EHCI) it is designed to handle multiple data transfer speeds within a single unified standard, making it more efficient at handling computer resources. The standard describes the basic communication between the software and the host controller including memory layout, data structures, MMIO and DMA.</p>
<h2 id="camkes-5"><a class="header" href="#camkes-5">CAmkES</a></h2>
<p>For our initial development we used CAmkES with the first goal of interfacing with the hardware. We compiled NetBSD, then traced the initialisation of the xHCI, noting down the input/output read and write commands. We then hardcoded the necessary memory register addresses and worked out the changes that we needed to make to the driver so that it was compatible with seL4 and CAmkES. We were then able to initialise the host controller by setting up the correct memory registers, DMA and interrupts. Once we got it to this point we decided to port the example to Microkit.</p>
<h2 id="microkit-5"><a class="header" href="#microkit-5">Microkit</a></h2>
<p>The first goal was to understand the differences between CAmkES and Microkit and become familiar with its features. Compared to CAmkES, Microkit has no standard libraries which meant that we had to export libraries for simple functionality such as logging and memory handling. We also had to create a simple DMA handler, and in the absence of a build system we opted to use GNU Make. Once we had an understanding of Microkit we got our new example to initialise the host controller as we did with CAmkES.</p>
<p>We created a separate DMA library which can be found <a href="https://github.com/sel4devkit/libmicrokitdma">here</a></p>
<h3 id="architecture-1"><a class="header" href="#architecture-1">Architecture</a></h3>
<p><img src="activity/microkit_usb_driver/../microkit_usb_driver/figures/system_architecture.png" alt="screenshot" /></p>
<p>One Protection Domain (PD) acts as a central driver which handles all of the initialization and communicates with the hardware via MMIO. There are additional PD's for the memory handler, software interrupts and hardware interrupts.</p>
<h3 id="memory-considerations"><a class="header" href="#memory-considerations">Memory Considerations</a></h3>
<p>Between the core driver PD and the software interrupt PD there are some function pointers to callback functions. In NetBSD's implementation it expects these function callbacks to be running in the same memory address space. However, with our setup this part of the communication is done between PD's, meaning that they don't have access to the same blocks of memory. Our first attempt at resolving this solution involved using a master PD that handled all of these functions, where the driver would call into the master PD, then the master PD would call into the software interrupt PD. This however was not a viable solution because the software interrupt PD was of a lower priority than the driver PD resulting in an affect on performance. Instead we opted to use a context switch, where both PD's at initialisation notify each other of the memory addresses that they will be using for the function pointers. The appropriate memory address is then selected during the function callback.</p>
<h3 id="devices"><a class="header" href="#devices">Devices</a></h3>
<p>Once we initialised host controller we moved onto devices. We started with keyboard as it was straightforward to get an example up and running and easy to test as it is a human interface device. Next we added a mouse which was conceptually very similar to the keyboard as they were both human interface devices and had the same fundamental layer. Additionally we just needed to include the mouse set up files from NetBSD. We also added touchscreen support by making use of the generic code for the mouse and by implementing extra functionality to account for the Z axis. When probing the bus for drivers we needed to state what device was being attached. This meant modifying the code and recompiling the program when switching between devices. To resolve this we introduced NetBSD's autoconfiguration which reads from a  prebuilt list of devices created at kernel compile time to evaluate which USB devices drivers should be assigned.</p>
<h2 id="project-layout"><a class="header" href="#project-layout">Project Layout</a></h2>
<p>This project uses a single 'make get' command to download and configure the dependencies for the project. Then a build script is used to build each separate example.</p>
<p>The dependant projects can be found at:</p>
<ul>
<li><a href="https://github.com/sel4devkit/sel4devkit-maaxboard-microkit-dev">Microkit</a></li>
<li><a href="https://github.com/sel4devkit/sel4devkit-maaxboard-microkit-netbsd-fork">Fork of NetBSD</a></li>
<li><a href="https://github.com/sel4devkit/sel4devkit-maaxboard-microkit-picolibc">C library</a></li>
</ul>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<p>The following examples have been provided:</p>
<ul>
<li><strong>FatFs</strong> - Demonstrates usage using our seL4 xHCI driver and API to communicate with a USB mass storage device on a block level.</li>
<li><strong>Shell</strong> - This example shows off all of the capabilities of the xHCI API by providing a shell interface to interact with.</li>
<li><strong>Empty Client</strong> - This example shows the usage of the driver as an empty API. This can be used as a skeleton to create a new API user.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="adding-a-new-device"><a class="header" href="#adding-a-new-device">Adding a new device</a></h1>
<p>Adding a new device requires several steps. The main file that allows importing of a new device is <code>ioconf.c</code>, and this file houses all of the structures that the <code>autoconf.c</code> autoconfiguration will use to construct a library of drivers and associated functions. This file has 9 distinct sections:</p>
<ol>
<li><code>*_iattrdata</code>: information about the attribute data. No devices have been removed from this original set of structures, and you are free to leave this device as is.</li>
<li><code>*_attrs</code> : creates a structure from the <code>*_iattrdata</code> information for use by drivers. Again, this is the original set and is free to be left alone</li>
<li><code>cfdriver_list_initial[]</code>: unused and unedited.</li>
<li><code>cfattach *_ca</code>: references to the data structures created by each drivers <code>CFATTACH_*</code> macro that appears at the top of driver files (e.g. <code>umass.c:278</code>)</li>
<li>Locators. This is unedited and can be ignored.</li>
<li><code>cfparent</code>: defines hierarchy between different driver classes where necessary. This is unedited and can be ignored</li>
<li><code>cfdata</code>: A list of drivers that will actually be used by the system. <code>ioconf.c</code> has a minimal set of drivers enabled for different devices. To add a device that is unsupported by this list, find the relevant entry in <code>ioconf-template.c</code>, which has a full list of devices. This list has been generated from a real build of NetBSD, and can be regenerated at any time by performing a build of a live system. The template file is included here as a shortcut to avoid a full rebuild.
<ol>
<li>Note that if a rebuild is executed, the entire <code>ioconf.c</code> file should be replaced as often the previous (unedited) steps will be out of sync.</li>
</ol>
</li>
<li><code>*_cfattachinit</code>: information for the match and attach functions. This can again be pulled from the <code>ioconf-template.c</code> for the device required.</li>
<li><code>cfattachinit[]</code>: list comprised of the above structures. Must end in <code>{NULL, NULL}</code>.</li>
</ol>
<p>Upon successfully adding the device to the required sections, include the necessary C files from the NetBSD source. This must include a file that has the <code>CFATTACH_DECL[0-3]_NEW</code> macro that exposes the attach and match functions to the autoconfiguration routines. Note that some header file and several global variables may need to be stubbed out for the file to compile initially. In the past, we tried to stub out as much as possible and then incrementally add back required functionality to avoid pulling in too much of the NetBSD source.</p>
<p>With the device now able to be matched and attached, the final piece of the puzzle is to implement the interrupt function. As discussed in a previous section, the setup for a device occurs in the main driver PD, but the interrupt handling will always occur in the soft interrupt PD. to avoid memory address issues, a structure of function pointers called <code>intr_ptrs</code> is created in the initialisation sequence of soft interrupt. Simply add a new entry for the new device, locate where the interrupt function pointer is set (often in a function call ending in <code>*_open</code>), and change this to use the <code>intr_ptrs-&gt;[NEW_DEV]</code> pointer instead.</p>
<p>For example, when adding <code>uts</code> to the supported drivers list, the interrupt pointer is set in <code>uts.c:353</code> , where the hardcoded <code>&amp;uts_intr</code> has been replaced with <code>intr_ptrs-&gt;uts</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="common-errors"><a class="header" href="#common-errors">Common errors</a></h1>
<h2 id="looping-sleeping-on-xfer"><a class="header" href="#looping-sleeping-on-xfer">Looping "sleeping on xfer"</a></h2>
<p><strong>Symptoms</strong>: when running on debug, seeing <code>sleeping on xfer ...</code> looped in output. Without debug, output will seem to freeze.</p>
<p><strong>Possible causes</strong>: Race condition caused by <code>xfer-&gt;ux_done</code> being set to false AFTER the transfer has finished (overwriting the real value (true)), meaning the while loop in <code>usbdi.c:499</code> never resolves. It can also be caused by the driver being stuck in the loop and never allowing computation to complete the transfer, but this should never happen, since the transfer is set to done during software interrupt which is higher priority.</p>
<p><strong>Possible Solutions</strong>: Can be caused by modified NetBSD code <code>xhci.c:4680</code>. The status is set to in progress before doing anything else. Also, the transfer is never timed out, which could be potentially dangerous in the future for devices that stop responding as it will freeze the whole driver. Sometimes, increasing the <code>usbd_delay_ms()</code> in various places in <code>xhci.c</code> allows the xfer to complete setup before it gets overwritten</p>
<h2 id="monerror-"><a class="header" href="#monerror-">MON|Error ...</a></h2>
<p><strong>Symptoms</strong>: Monitor error causing program to crash</p>
<p><strong>Possible causes</strong>: Could be a lot of different things, as it just means that memory has been accessed that has not been allocated. Check structures to ensure memory allocation has happened where it should have, or shared memory has been properly shared between all PDs. Can also be caused by stack overflows or buffer overflows.</p>
<p>However, once all obvious causes have been exhausted, these are some possible causes that are specific to this driver:</p>
<ul>
<li>Function pointers being called where they have been setup in a different PD to the one executing. Particularly common offenders include:
<ul>
<li><code>usbdi.c:1207 upm_done</code></li>
<li><code>usbdi.c:457 upm_transfer</code></li>
<li>Function pointers that are setup in main driver PD and always called from software PD
<ul>
<li>Any interrupt pointer call (e.g. setup in <code>uts.c:353</code> and called in <code>uhidev.c:624</code>)</li>
<li>Any callback call (e.g. setup in <code>umass_scsipi.c:334</code> and called in <code>umass.c:1100</code>)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Possible solutions</strong>: Make sure that the function is being called using <code>get_up_methods()</code> or using the <code>intr_ptrs</code> structure for functions that are always called in software. Sometimes, observing the actual incorrectly invoked memory address can give a clue as to what exactly is going wrong (see Monitor Errors  section)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="flattened-device-tree"><a class="header" href="#flattened-device-tree">Flattened Device Tree</a></h1>
<p>The Flattened Device Tree (FDT) functionality allows much more flexibility and generic usage of our driver. We use the libfdt library provided by NetBSD (but also available as a stand-alone library) to traverse and process the tree which lowers the amount of the driver that needs to be statically programmed.</p>
<p>Due to Microkit lacking the ability to load the utilised device tree (for some reason) we have to load in the binary using inline assembly. This can be seen in the memory handler PD:</p>
<pre><code class="language-C">// this aligns start address to 16 and terminates byte array with explicit 0
// which is not really needed, feel free to change it to whatever you want/need
#define INCBIN(name, file) \
    __asm__(".section " INCBIN_SECTION "\n" \
            ".global incbin_" STR(name) "_start\n" \
            ".balign 16\n" \
            "incbin_" STR(name) "_start:\n" \
            ".incbin \"" file "\"\n" \
            \
            ".global incbin_" STR(name) "_end\n" \
            ".balign 1\n" \
            "incbin_" STR(name) "_end:\n" \
            ".byte 0\n" \
    ); \
    extern __attribute__((aligned(16))) const char incbin_ ## name ## _start[]; \
    extern                              const char incbin_ ## name ## _end[]
</code></pre>
<p>This memory address is then distributed throughout the other protection domains where it can be used with libfdt. This has currently only been tested with a MaaXBoard by virtue of hardware availability, but the FDT traversal will work with any device tree. The FDT is then initialised and can be called by initialisation functions to extract device specific information without the need for static configuration of the driver for each unique device, lowering the barrier for use.</p>
<p>Traversal of the FDT can take some time, so I have included the possibility to set the offset manually to skip traversal (since the traversal is only required to calculate the offset of the dwc3 node). To disable manual usage, set <code>offset</code> to <code>-1</code>. The debug output will include the offset that can be used to skip the traversal for future usage.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="memory-sharing"><a class="header" href="#memory-sharing">Memory sharing</a></h1>
<p>As part of the implementation in Microkit, one of the more difficult parts that we found was the issue of memory isolation between PDs. Due to the fact that NetBSD expects code to all be executing in the same working memory regions, it uses a lot of function pointers. This translates just fine to Microkit as long as the function pointers are used in the same protection domain as they are defined.</p>
<p>One of the earliest memory region shares is the duplication of the <code>xhci_softc</code> data structure. <code>*_softc</code> structures in NetBSD are the structures that are used to contain information about the devices attached, and therefore sharing this structure between the two main PDs is paramount, such that the configuration and changes to the structure retain integrity.</p>
<p>A further example of this is the setup of the <code>*_pointer</code> and <code>*_pointer_other</code> methods. Although not ideal, we have set up the driver such that in initialisation phase, the main PD queries the interrupt PD for memory addresses of various functions, and assigns these to global variables. Then, when the function pointer would be incurred, the value of the memory address is compared against each function pointer, and corrected if the memory address points to a region in the alternate PD. That is to say:</p>
<pre><code class="language-C">(main driver)
...
if (func_addr == func_pointer_other) {
	func_addr = func_pointer; //correct memory address of function pointer to use function in memory region
}
(usb_sc-&gt;func_addr)(args); //call function with required args. This is unmodified NetBSD code
...
</code></pre>
<p>A better use of this would be to instead create a structure with all the used functions, and then instead of using function pointers, use an index, such that less initial setup is required, and there is no need for RPCs. For reference, here is what NetBSD looks like currently at setup (with added comments for readability). This snippet is from <code>xhci.c:2167</code></p>
<pre><code class="language-C">//This initialisation happens in the main driver PD.
//setup (xhci.c:2167)
...
switch (xfertype) {
case UE_CONTROL:
	pipe-&gt;up_methods = &amp;xhci_device_ctrl_methods; //this function pointer will be compared with a global pointer
	break;
...
case UE_BULK:
	pipe-&gt;up_methods = &amp;xhci_device_bulk_methods;
	break;
case UE_INTERRUPT:
	pipe-&gt;up_methods = &amp;xhci_device_intr_methods;
	break;
...
}
...


//usage (from usbdi.c:469). This will be used in both PDs
...
} else if (pipe-&gt;up_methods == device_ctrl_pointer_other) {
	pipe-&gt;up_methods = device_ctrl_pointer; //this is a pointer to xhci_device_ctrl_methods in the current PD
}
err = pipe-&gt;up_methods-&gt;upm_transfer(xfer); //call function
</code></pre>
<p>Instead, it could look something like</p>
<pre><code class="language-C">// setup in the init() function of each PD
void *get_up_methods(int ptr) {
	switch (ptr) {
	case 0:
		xhci_device_control_methods;
	case 1:
		xhci_device_bulk_methods;
	case 2:
		xhci_device_intr_methods;
		...
	}
}

//setup (xhci.c:2167)
...
switch (xfertype) {
case UE_CONTROL:
	pipe-&gt;up_methods = 0; //instead of being a function pointer, it is now an index
	break;
...
case UE_BULK:
	pipe-&gt;up_methods = 1;
	break;
case UE_INTERRUPT:
	pipe-&gt;up_methods = 2;
	break;
...
}

// usage (usbdi.c:469 ish)
...
err = get_up_methods(pipe-&gt;up_methods)-&gt;upm_transfer(xfer); //call function
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="microkit-monitor-errors"><a class="header" href="#microkit-monitor-errors">Microkit Monitor Errors</a></h1>
<p>We found these errors to be difficult to understand for a while, so here is the general format:</p>
<h3 id="invalid-channel-id"><a class="header" href="#invalid-channel-id">Invalid channel ID</a></h3>
<p>If a channel ID number is called that is not defined in the system file, the following error can be seen:</p>
<pre><code>&lt;&lt;seL4(CPU 0) [receiveIPC/142 T0x80bffe7400 "rootserver" @8a000318]: Reply object already has unexecuted reply!&gt;&gt;
</code></pre>
<p>This will not halt execution, but since the notification does not trigger, unintended results may occur. Can normally be fixed by checking all notifications or ppcalls and making sure they are correctly mapped in the <code>.system</code> file. If the stack is too small and overflows, this can cause the notifications channel IDs to get all messed up and this can cause an invalid channel ID error without any (logical) reason.</p>
<h3 id="invalid-memory-address"><a class="header" href="#invalid-memory-address">Invalid memory address</a></h3>
<pre><code>MON|ERROR: received message 0x00000006  badge: 0x0000000000000001  tcb cap: 0x80000000000065c4  
MON|ERROR: faulting PD: xhci_stub  
Registers:  
pc : 0x000000000026a474  
spsr : 0x0000000020000040  
x0 : 0x4998000000000028  
x1 : 0x4998000000000027  
x2 : 0x4998000000000028  
x3 : 0x0000000000000000  
x4 : 0x0000000000000000  
x5 : 0x0000000000000000  
x6 : 0x0000000000000000  
x7 : 0xfffffffffffffff4  
MON|ERROR: VMFault: ip=0x000000000026a474  fault_addr=0x4998000000000028  fsr=0x0000000092000000  (data fault)  
MON|ERROR:    ec: 0x00000024  Data Abort from a lower Exception level   il: 1   iss: 0x00000000  
MON|ERROR:    dfsc = address size fault, level 0 (0x00000000)
</code></pre>
<p>When a memory address that is not supposed to be accessed by a given memory address is accessed, this error can be observed. This error halts execution. The faulting PD is named at the top (<code>xhci_stub</code> in this instance) and the memory address that has been accessed is shown by <code>ip=xxxx</code>.</p>
<p>In general, there are two main causes for this fault. One is that a region of memory has not been mapped into the PD that is trying to access it. The other is that a structure has been passed from one PD to another with a locally defined variable/function pointer. In this case, the fault address defined by <code>ip=xxxx</code> takes the form of the above message (similar to <code>0x...26a474</code>), since this will not resemble any of the addresses defined by the system file.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="extra-notes"><a class="header" href="#extra-notes">Extra notes</a></h1>
<h2 id="machine-directory"><a class="header" href="#machine-directory">Machine Directory</a></h2>
<p>NetBSD expects some machine specific includes and defines to be in the <code>machine</code> directory. In an ordinary build, this folder is created by the Makefile. To replicate this, the driver Makefile creates a similar directory, stored in the <code>mach_include</code> directory, and creates a symlink of the include directory of the used architecture (in the example of the MaaXBoard: <code>{NETBSD_ROOT}/sys/arch/evbarm/include/)</code>. Our Makefile also creates a symlink of various architecture specific files in the <code>mach_include</code> directory.</p>
<h2 id="memory"><a class="header" href="#memory">Memory</a></h2>
<p>In order to share memory between domains, We created a separate PD called mem_handler that manages the free lists between the two main threads. Any calls to <code>kem_alloc</code> (normally allocating kernel memory) are rerouted to this protection domain which allocates memory from a shared region of memory. This memory region is not shared with the client and is reserved for device specific structures and data.</p>
<h2 id="hot-plugging"><a class="header" href="#hot-plugging">Hot Plugging</a></h2>
<p>Hot plugging is the ability to set up a USB device while the system is running. This driver is able to support this, and works by calling <code>microkit_notify(HOTPLUG)</code> in software interrupts after a regular software interrupt (line 136). The main driver will check if there is an explore pending and attach the device if necessary. Without this call, any extra device connections are not processed past acknowledging the interrupt.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hdmi-driver"><a class="header" href="#hdmi-driver">HDMI Driver</a></h1>
<h2 id="introduction-2"><a class="header" href="#introduction-2">Introduction</a></h2>
<p>For this task the aim was to create an HDMI display driver. For inspiration we looked at U-Boot’s imx8m display driver because it is BSD licensed and minimally featured which was useful to use as an initial foundation to build upon. We opted to copy the code into our repository rather than have a fork like we did with the xHCI driver. This is because we used a minimal amount of U-Boot's code and it was easier to manage compared to keeping a fork of a large repository up to date.</p>
<p>The repository for this project is located <a href="https://github.com/sel4devkit/sel4devkit-maaxboard-microkit-hdmi-driver">here</a>.</p>
<h2 id="displaying-a-static-image"><a class="header" href="#displaying-a-static-image">Displaying a Static Image</a></h2>
<p>The first goal was to understand U-Boot’s display driver and to set up our memory regions for the frame buffer and the physical devices required by the driver. After building and running the U-Boot example, we looked through the source code and found relevant sections in IMX8M technical specification to get a better understanding of how to write the display driver. We currently rely on the firmware provided by U-Boot which needs to be configured when setting up the development environment.</p>
<p>Through reading the technical specification we learnt that the two main components of the Maaxboard needed for the driver are the DCSS (Display Controller Subsystem) and the HDMI TX Controller. With this information we were able to understand the purpose of the memory register read and write operations and which register bits needed to be set for specific functionality. We decided to use one protection domain for the simplicity of having one area to handle all operations.</p>
<p>After gaining a deeper understanding of Maaxboard and U-Boots implementation, we set values for the essential memory registers including where to set the address of the frame buffer to. For the frame buffer, we defined a region of memory that was large enough for our currently selected screen resolution and bit depth.</p>
<p>In order to read and write from specific memory registers, they must be explicitly defined in the system file for the PD that they are being accessed from. This is an essential concept to grasp when working with Microkit. The majority of the code was taken from U-Boot, so the main focus of this part of the task was to set up the parts of the code that directly interfaced with the hardware. For other projects this could include registering and handling interrupts.</p>
<p>Our initial display configuration had a screen resolution of 1280x720 and a colour depth of 32 bit RGB. This meant that each pixel was composed of 32 bits (8 bits reserved for each colour and an additional alpha channel for colour transparency). With this information, we were able to display four equally spaced bars across the screen as red, green, blue and white. We then experimented with different screen resolutions which involved re-defining the size of the frame buffer so that it could accommodate larger screen resolutions.</p>
<h2 id="displaying-a-moving-image"><a class="header" href="#displaying-a-moving-image">Displaying a Moving Image</a></h2>
<p>The next goal was to display a moving image, which first involved learning about the theory of double buffering and understanding the capabilities of the Maaxboard’s DCSS. Double buffering makes use of two buffers. The first buffer stores the current frame and the second buffer stores the next frame. Whilst the current frame is being displayed the second buffer is being written to. During the window of time where the image on screen is not actively being redrawn, the pointers to each buffer are swapped.</p>
<p>U-Boot’s implementation did not provide any capability to drive video, so we needed to investigate and understand the technical specification in greater detail. We found a component of the DCSS called the Context Loader which can be configured to change various parts of the display state at specific timing intervals. This would act as the trigger to switch the pointers to each frame buffer.</p>
<p>For our implementation we decided to use two PD’s. One PD contains the display driver, consisting of the DCSS and the HDMI TX Controller. The other PD contains the API and examples which demonstrate different use cases of the driver. The system is designed such that the two PD’s communicate with each other through notifications and make use of a single shared DMA memory region. This memory region is split into different parts which are accessed by a pointer with a specific offset for different parts of the memory e.g frame buffer 1, frame buffer 2. This approach was implemented for simplicity so that the memory is easily accessible, however it would be better to define individual DMA regions for specific tasks, so that certain parts of the memory are only exposed to the PD that should have access to it.</p>
<p>The initial time to redraw the buffer was slow because we were writing 8 bits of the 32 bit pixel at a time. To combat this we optimised the code logic reducing loops and where possible, we wrote 16, 32 or 64 bits at a time to minimise the amount of separate CPU instructions. This example is limited by the technology that we have available to us. For fully-fledged display drivers, there will be extra bits of hardware that will be able to handle the different stages of processing video, drastically increasing performance.</p>
<p>For moving images there is a visible redraw of the screen when switching between frames. This is most noticeable when the whole screen has changed. Multiple attempts have been made to combat this issue, which have been listed in the repo for this activity.</p>
<h2 id="examples-1"><a class="header" href="#examples-1">Examples</a></h2>
<p>The API contains the following examples:</p>
<ul>
<li>static_image - Displays 4 colour bars on the screen.</li>
<li>resolution_change - Displays a square of the same size in pixels one after another at three different resolutions.</li>
<li>rotating_bars - Displays 4 colour bars rotating across the screen.</li>
<li>moving_square - A small square that moves around the screen, changing direction each time it hits the side of the screen.</li>
</ul>
<p>Currently the project is built using a build script that calls make. The dependencies are also built separately with a script for Picolibc and a Makefile for Microkit. For information on how to build and run the examples see:</p>
<p><a href="https://github.com/sel4devkit/sel4devkit-maaxboard-microkit-hdmi-driver">sel4devkit-maaxboard-microkit-hdmi-driver</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="single-linux-guest"><a class="header" href="#single-linux-guest">Single Linux guest</a></h1>
<h2 id="introduction-3"><a class="header" href="#introduction-3">Introduction</a></h2>
<p>For this task, the goal was to load up a virtual machine (VM) on a host with serial TTY pass-through. This was with the intended goal of performing I/O with the Linux guest. Our starting point for this activity was to rework an example from the Trustworthy Systems Libvmm repository so that it runs on the Maaxboard. This repo contains a virtual machine monitor for the seL4 microkernel with various examples built for the Odroid board and the open source emulator Qemu. Libvmm provides a virtual machine monitor (VMM) which is used to start and manage the guest VM.</p>
<p>The repository for this project is located <a href="https://github.com/sel4devkit/sel4devkit-maaxboard-microkit-vmm-single-linux-guest">here</a>.</p>
<p>The Trustworthy Systems Libvmm repository can be found <a href="https://github.com/au-ts/libvmm/tree/main">here</a>.</p>
<h2 id="design-1"><a class="header" href="#design-1">Design</a></h2>
<p>One Protection Domain (PD) is used which contains a virtual machine and physical devices such as the UART which are passed through to the Linux guest. This means that no driver code is needed in seL4 as the Linux guest will contain the driver and communicate directly with the Maaxboard's hardware.</p>
<h2 id="buildroot"><a class="header" href="#buildroot">Buildroot</a></h2>
<p>To create the Linux kernel image and the root filesystem we used Buildroot. It is an open source project that automates the process of building a complete and bootable Linux environment for an embedded system. We chose Buildroot because it makes the process to create a basic Linux kernel images straightforward. In this project the Linux kernel image, the root filesystem and the device tree are linked into the PD's image file.</p>
<p>Our buildroot repository can be found <a href="https://github.com/sel4devkit/sel4devkit-maaxboard-linux-guest/blob/main/doc/MANUAL.md">here</a>.</p>
<h2 id="virtual-memory-faults"><a class="header" href="#virtual-memory-faults">Virtual Memory Faults</a></h2>
<p>The VM doesn’t necessarily know it's being virtualised, so it may try to perform read and write operations on certain devices and memory regions that it doesn’t have access to. When setting up the project there were a number of virtual memory faults, which were caused by the guest VM trying to access devices that it was not exposed to in the system file. Generally, there are three approaches to fix this.</p>
<ul>
<li>Disable the device node in the device tree so that it does not try to access the device. This approach may not be feasible because the memory region may be required by a specific process in your system or dependent on another device in order to function.</li>
<li>Disable the device driver in the guest configuration (This can be configured with Buildroot).</li>
<li>Utilise device “pass-through” which is where the address of the device is mapped into the guest VM allowing access directly to the device. Ideally, in a virtualised environment the guest VM shouldn’t have access to physical devices. However, for simplicity and with the absence of a serial driver it was necessary to pass through the serial device and the devices that depend on it.</li>
</ul>
<h2 id="pass-through"><a class="header" href="#pass-through">Pass-through</a></h2>
<p>Two memory regions that are required to be passed through for the use of Libvmm and our example are the RAM and the Generic Interrupt Controller Virtual CPU (GIC-VCPU). In order for the Linux guest to be able to run, it needs to have an area of contiguous space directly allocated for its own RAM. In its current implementation Libvmm expects the physical memory address and the virtual memory area for the RAM to be at the same address. At a minimum there needs to be enough memory to load the kernel image and other associated binaries. The size and position of this memory need to reflect the memory node in the device tree. The GIC-VCPU is used to signal virtual interrupts. Libvmm provides a driver to handle this device which is necessary for running any guest operating system with Libvmm.</p>
<h2 id="memory-considerations-1"><a class="header" href="#memory-considerations-1">Memory Considerations</a></h2>
<p>In the current release of Microkit (1.2.6 At the time of writing), the way that Microkit allocates memory for untyped regions is not optimal for large amounts of memory. All of memory, including RAM, is split into regions based on some rules and then Microkit allocates kernel objects from those untypeds. It is thought that the Microkit allocator is for some reason only allocating from a maximum of one untyped for a single allocation. This means that for example, if you want 3GB of RAM then it will be split over a couple of untypeds. So if you're trying to create an MR of 512MiB, and the biggest untyped is only 256MB, then Microkit is failing even though technically there is 3GB of space.</p>
<p>An initramfs (initial ram file system) is used to prepare Linux systems during boot before the init process starts. If the memory allocated for the ram isn't big enough then this process will fail. It is not known why exactly, but currently the size is 0xf000000 because 0x9000000 was too small.</p>
<h2 id="smc-issue"><a class="header" href="#smc-issue">SMC Issue</a></h2>
<p>Whilst developing this project, we came across an error when trying to boot up the VM:</p>
<p><code>VMM|ERROR: Unhandled SMC: unknown value service: 0x2, function number: 0x6</code></p>
<p>The MaaxBoard Firmware provides a small set of SiP Function Identifiers. The Linux Driver "drivers/soc/imx/soc-imx8m.c" compatible with "fsl,imx8mp" leverages MaaxBoard Firmware SiP Function Identifier "0xc2000006" to get version information. If SMC properly declares that "0xc2000006" is absent, this would be interpreted as detecting an earlier version of the Board (that lacked the Function Identifier). A work around has been implemented to handle this service which suppresses the error.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="vmm-with-dual-linux-guests-and-tty-multiplex"><a class="header" href="#vmm-with-dual-linux-guests-and-tty-multiplex">VMM with dual linux guests and TTY Multiplex</a></h1>
<h2 id="introduction-4"><a class="header" href="#introduction-4">Introduction</a></h2>
<p>For this activity the goal was to load two Linux Virtual Machines (VM) on one host. We built upon our previous single guest example and took inspiration from an existing <a href="https://github.com/au-ts/libvmm">Libvmm</a> contribution that makes use of VirtIO console.</p>
<p>The repository for this project is located <a href="https://github.com/sel4devkit/sel4devkit-maaxboard-microkit-vmm-dual-linux-guest-tty-multiplex">here</a>.</p>
<h2 id="design-2"><a class="header" href="#design-2">Design</a></h2>
<p>For this example five Protection Domains (PD) are used. Two PD’s are used for each virtual machine, one for the UART serial driver and the remaining two for the transmit (TX) and receive (RX) communication channels to handle the serial data. Input is routed to only one virtual machine and output from both VM's is seen regardless of which VM is currently being controlled. Currently there are only two VM's set up, but this can be tweaked to have multiple VM's running simultaneously.</p>
<h3 id="rx"><a class="header" href="#rx">RX</a></h3>
<p>For RX communication, an interrupt is generated by a key press that is processed by the driver. The driver then adds the keypress to a shared queue and notifies the RX PD to read from the queue and place the key press into a new shared queue with the virtual machine PD. The RX PD will then notify the virtual machine PD that there is data in the queue. In the virtual machine PD this then notifies the VirtIO console to handle the RX data ready to be processed in the guest VM.</p>
<h3 id="tx"><a class="header" href="#tx">TX</a></h3>
<p>For TX communication, the Linux guest puts data in a shared queue through VirtIO. The virtual machine PD receives a notification from the guest and the data is read from the queue and placed in a shared queue with TX PD. A notification is then sent to the TX PD so that it can read this data and place it in a shared queue with the driver. The driver then reads the data from the queue and outputs it to the hosts serial port.</p>
<h2 id="virtio"><a class="header" href="#virtio">VirtIO</a></h2>
<p>VirtIO is an interface used by virtual machines to use its hosts’ devices through the means of virtual devices. The main role of these devices is to get data to and from the hosts physical hardware. VirtIO consists of three main parts: front-end drivers, back-end devices, and VirtQueues.</p>
<h3 id="front-end-drivers"><a class="header" href="#front-end-drivers">Front-end Drivers</a></h3>
<p>Typically, the front-end drivers exist in the hosts kernel. These can be turned on in the config file when creating a Linux kernel with buildroot. They are responsible for accepting I/O requests from user processes, transferring I/O requests to its corresponding back-end VirtIO device and retrieving completed requests from the back-end device.</p>
<h3 id="back-end-devices"><a class="header" href="#back-end-devices">Back-end Devices</a></h3>
<p>The back-end devices typically exist in the VMM. Libvmm provides implementations for console, network, block and sound devices. They are responsible for accepting I/O requests from the corresponding front-end driver,handling the requests by offloading the I/O operations to the host’s physical hardware, and making the processed and requested data available to the VirtIO driver.</p>
<h3 id="virtqueues"><a class="header" href="#virtqueues">VirtQueues</a></h3>
<p>VirtQueues are shared memory regions that are used by a VirtIO front-end driver and back-end device pair. A VRing is a data structure contained within the VirtQueue that facilitates data transfer between the VirtIO device and driver. Libvmm follows version 1.2 of the VirtIO specification and uses the seL4 Device Driver Framework (<a href="https://github.com/au-ts/sddf">SDDF</a>) to implement the VirtQueues for specific devices.</p>
<h3 id="virtio-console"><a class="header" href="#virtio-console">VirtIO Console</a></h3>
<p>In our example we make use of the VirtIO Console device to handle serial I/O data. To use VirtIO Console a node was created in the device tree and a multiple settings turned on in the Linux kernel config file. In the “chosen” node of the device tree, the stdout path and the boot arguments also needed to be set up specifically for the console device. In our initial implementation we passed through 8 additional devices. We then managed to remove the need for 7 of them by disabling them in the device tree. The remaining “gpc” device was needed by VirtIO Console, but at this stage it is not known why.</p>
<h2 id="timing-considerations"><a class="header" href="#timing-considerations">Timing Considerations</a></h2>
<p>If the two virtual machine PD's have a different priority then the highest priority VM will be loaded first and there will be a long wait (&gt;10 minutes) before control is relinquished to the lower priority VM. To resolve this issue, both of the Virtual machine PD's were made the same priority. Although it is not an issue, this results in the output being muddled together because both VM's output is shown simultaneously.</p>
<h2 id="links"><a class="header" href="#links">Links</a></h2>
<ul>
<li><a href="https://blogs.oracle.com/linux/post/introduction-to-virtio">virtio oracle webiste</a> - For more information on VirtIO</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dual-linux-guest-with-usb-routing"><a class="header" href="#dual-linux-guest-with-usb-routing">Dual Linux Guest with USB routing</a></h1>
<h2 id="introduction-5"><a class="header" href="#introduction-5">Introduction</a></h2>
<p>In this activity we explored different options for USB routing. Largely, the need for USB routing comes from virtualisation, where the physical hardware has the physical USB port, and there is a virtual system that we wish the USB port is routed into. In our case we are working towards routing a USB device into one of multiple virtual machines (VM).</p>
<h2 id="usb-ip"><a class="header" href="#usb-ip">USB IP</a></h2>
<p>USB/IP Project to develops a general USB device sharing system over an IP network. It uses TCP/IP payloads to transmit USB I/O messages between two different computers. We ran a preconfigured Linux natively on the Maaxboard, which included USB IP functionality. We then connected to another server running Linux and routed the USB keyboard traffic from the Maaxboard to server over IP.</p>
<p>The next goal was to load a virtual Linux guest on the Maaxboard and pass through USB data to the guest. We were unable to transfer the data from the guest to another server because because the ethernet pass-through was not working as expected. We have been notified that a newer version of Microkit may solve this issue. This exercise demonstrated the use of USB IP and helped us understand how to preconfigure a Linux kernel to include specific functionality.</p>
<h2 id="virtio-net"><a class="header" href="#virtio-net">VirtIO Net</a></h2>
<p>At the time of writing, the <a href="https://github.com/au-ts/libvmm">Libvmm</a> VirtIO Net contribution is still being developed. For our implementation we will rework the relevant parts of the example to work with our devkit setup using the Maaxboard. The Protection Domain (PD) structure will be similar to the VirtIO console implementation with specific net RX and TX queues and an Ethernet driver. In the console example the multiplexing is done in the driver code, but for this example a "vswitch" is implemented in its own PD to handle the switching between the different VM's. This “vswitch” code appears to be in the SDDF repository, so it will be important to make sure these projects are synced up correctly. Also, the TX and RX queues will be implemented with net specific functions from the <a href="https://github.com/au-ts/sddf">SDDF</a>.</p>
<p>The Ethernet device will need to be disabled in the device tree and an extra node for VirtIO Net will need to be added. Further investigation will need to be done to see if there are any other changes to the device tree that need to be made, such as changes to the boot arguments. Once VirtIO Net is available we will be able to extend our previous dual guest example such that the two VM's can communicate via IP. At this stage there would not be any USB routing, but it demonstrates a solution to communicate IP data between two VM's.</p>
<h2 id="notes"><a class="header" href="#notes">Notes</a></h2>
<p>The exploration into USB IP gave us understanding on how we could send USB data between two instances of Linux. In theory we should be able to plug a USB device to the Maaxboard and pass it through to 1 of the Linux guests. If only one VM was given pass-through to the USB device then this VM could act as the USB IP "server" and using VirtIO Net it could route the USB traffic to the other VM over IP.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="licensing"><a class="header" href="#licensing">Licensing</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
